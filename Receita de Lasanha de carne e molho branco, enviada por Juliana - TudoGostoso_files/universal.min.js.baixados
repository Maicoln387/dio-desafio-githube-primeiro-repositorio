"use strict";!function(w,d){w.Navegg=w.Navegg||function(t){w.Navegg.q.push([this,t])},w.Navegg.q=w.Navegg.q||[];var nvg=w.Navegg.prototype;nvg.say=function(t,e){switch(t){case"i":console.info(e);break;case"w":console.warn(e);break;case"e":console.error(e)}},nvg.getServerDomain=function(t){return"https://"+t+".navdmp.com"},nvg.__cleanConfigCache=function(){this.say("w","nvg"+this.acc+"config cache cleaned"),w.localStorage.removeItem("nvgcnfg"+this.acc)},nvg.include=function(t,e,i,s,n){""!==s&&void 0!==s||(s=!0);var a=d.createElement(e=""==e||null==e?"script":e);"script"==e&&(a.type="text/javascript"),(i=!t&&i?"try{"+i+"}catch(e){console.error(e);nvg"+this.acc+".__cleanConfigCache();}":i)?a.text=i:(a.src=t,"img"==e&&(a.style.display="none")),n&&(a.onerror=n.bind(this)),a.async=s;s=d.getElementsByTagName("script")[0];s.parentNode.insertBefore(a,s)},nvg.getTLD=function(){var t,e,i="",s="nvgTLD"+this.account,n=new Date,a=n.getTime(),r=w.localStorage.getItem("nvgTLD");if(r)return r;for(e=(t=w.location.hostname.split(".")).length-1;0<e;e--)if(i="."+t[e]+i,n.setTime(n.getTime()+5e3),document.cookie=s+"="+a+";expires="+n.toGMTString()+";domain="+i,this.getCookie(s)==a)return w.localStorage.setItem("nvgTLD",i),n=new Date,document.cookie=s+"="+a+";expires="+n.toGMTString()+";domain="+i,i;return"."+w.location.hostname},nvg.setCustom=function(t){var e={};e.acc=this.acc,this.usr&&(e.id=this.usr),e.cus=t,this.include(this.getServerDomain("cdn")+"/cus?"+this.serializeParams(e)),this.__setCustomFp(t)},nvg.setCustomTargeting=function(t,e){for(var i,s,n,a=0;a<t.length;a++){for(s=t[a],n=!1,i=0;i<s.length;i++)0<=window.location.href.search(s[i])&&(n=!0);if(!n)return!1}return this.setCustom(e),!0},nvg.getParameter=function(t){if(!this.qry){this.qry={};for(var e=w.location.search.substr(1).split("&"),i=0;i<e.length;i++){var s=e[i].split("=");this.qry[s[0]]=s[1]}}return this.qry[t]||""},nvg.getCookie=function(t){var e=d.cookie.indexOf(t+"="),i=e+t.length+1;if(!e&&t!=d.cookie.substring(0,t.length))return"";if(-1==e)return"";e=d.cookie.indexOf(";",i);return-1==e&&(e=d.cookie.length),unescape(d.cookie.substring(i,e))},nvg.setCookie=function(t,e,i){var s="";this.dom&&(s=";domain="+this.dom);var n=new Date;i==i&&i||(i=525600),n.setTime(n.getTime()+60*i*1e3);i=n.toGMTString();d.cookie=t+"="+e+";expires="+i+";path=/"+s},nvg.__loadCustomFp=function(){var t,e="nvgcus"+this.acc;if(i=w.localStorage.getItem(e)){var i=i.split("-"),s=this.getSegment("custom");for(""==(s=s.split("-"))[0]&&(s=Array()),t=0;t<i.length;t++)-1==s.indexOf(i[t])&&s.push(i[t]);this.persona.custom=s.join("-")}},nvg.__setCustomFp=function(t){var e="nvgcus"+this.acc,i=(i=window.localStorage.getItem(e))?(-1==(i=i.split("-")).indexOf(t.toString())&&i.push(t.toString()),i.join("-")):t;window.localStorage.setItem(e,i),-1==(i=this.persona.custom?this.persona.custom.split("-"):[]).indexOf(t.toString())&&i.push(t.toString()),this.persona.custom=i.join("-")},nvg.loadProfile=function(){var t=w.localStorage.getItem(this.ckn),e=w.localStorage.getItem("nvgpersona"+this.account);return(t=t||this.getCookie(this.ckn))&&e?(0<=(t=(e=t.split("_"))[0]).search(/\|/)&&(t=t.split("|"),this.syn=t[1],t=t[0]),this.usr=t,this.ctrl=e[1],e[2]&&this.parsePersona(e[2]),this.ctrl!=this.datestr()||this.debug?this.callUsr():void 0):this.callUsr()},nvg.callCallbacks=function(){function i(t){if("function"==typeof t)try{t()}catch(t){}}function t(t){if(void 0!==t&&t.length)for(var e=0;e<t.length;e++)i(t[e])}t.prototype.push=function(t){i(t)},w.naveggReady=new t(w.naveggReady)},nvg.parsePersona=function(t){for(var e,i=t.split(":{"),t=JSON.parse(`{${i[1]}`),s=i[0].split(":"),n=0;n<=this.seg.length;n++)1==(e="string"==typeof(e=s[n]||"")?e.split("-"):e).length?""!=e[0]&&void 0!==this.seg[n]&&(this.persona[this.seg[n]]=e[0]):this.persona[this.seg[n]]=e;this.persona.navegg_vision=t;try{this.persona.cluster&&!this.persona.everyone&&(this.persona.everyone=this.persona.cluster),this.persona.industry&&!this.persona.everybuyer&&(this.persona.everybuyer=this.persona.industry)}catch(t){}t&&(this.persona.interest=t.interest,this.persona.brands=t.brands,this.persona.product=t.product,this.persona.age=t.demographic.age,this.persona.education=t.demographic.education,this.persona.gender=t.demographic.gender,this.persona.income=t.demographic.income,this.persona.marital=t.demographic.marital,delete this.persona.navegg_vision),w.localStorage.setItem("nvgpersona"+this.account,JSON.stringify(this.persona))},nvg.doSync=function(t){var e=this.getCookie(this.ckn)||"";0<=(e=e.split("_"))[0].search(/\|/)&&(e[0]=e[0].split("|"),e[0]=e[0][0]),e[0]+="|"+t,e=e.join("_"),this.setCookie(this.ckn,e)},nvg.datestr=function(){var t=new Date,e=new Date(t.getFullYear(),0,0);return Math.ceil((t-e)/864e5).toString()},nvg.serializeParams=function(t){var e,i=[];for(e in t)i.push(e+"="+encodeURIComponent(t[e]));return i.join("&")},nvg.profile=function(t,e){var i=!1;this.usr||(i=!0),t&&(this.usr=t),d.cookie=this.ckn+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",this.setCookie(this.ckn,[this.usr+"|"+this.syn,this.datestr()].join("_")),w.localStorage.setItem(this.ckn,[this.usr+"|"+this.syn,this.datestr(),e].join("_")),this.parsePersona(e),i&&this.saveRequest(this.usr),this.__loadCustomFp()},nvg.callUsr=function(){var t={};t.v=this.version,t.acc=this.acc,t.u=1,this.usr?(t.id=this.usr,this.syn||(t.jds=1)):t.new=this.isnew=1,this.wst||(t.wst=0),this.wct&&(t.wct=1),this.wla&&(t.wla=1),this.abt&&(t.wat=1),this.dsy||(t.dsy=0),this.debug&&(t.rdn=parseInt(1e8*Math.random())),this.include(this.getServerDomain("usr")+"/usr?"+this.serializeParams(t),void 0,void 0,void 0,this.usrError)},nvg.OnePageViewInsight=async function(){try{var i=encodeURI("v="+this.version+"&url="+window.location.href+"&ua="+navigator.userAgent),s=this.getServerDomain("opi")+"?"+i;const r=await fetch(s),o=await r.json();for(const g in o)o[g]=o[g].map(t=>t.toString()),delete Object.assign(o,{[g.slice(4)]:o[g]})[g];var n=encodeURI("&url="+window.location.href),a=this.getServerDomain("opi")+"/watson?"+n;const c=await fetch(a);let e;this.uqt=this.uqt||5;try{e=await c.json()}catch(t){e={}}for(const l in e)e[l]="object"==typeof e[l]?e[l].map(t=>t.toString()):e[l],delete Object.assign(e,{[l.slice(4)]:e[l]})[l];this.onePageData={...e};for(const u in o)this.onePageData[u]?this.onePageData[u].push(...o[u]):this.onePageData[u]=o[u];const h=JSON.parse(window.localStorage.getItem("nvgopi"+this.acc));let t=[];if(h){for(const d in h)if(Object.keys(h[d]).includes(window.location.href))return;h.length>=this.uqt&&h.shift(),h.push({[window.location.href]:this.onePageData}),t=h}else t=[{[window.location.href]:this.onePageData}];window.localStorage.setItem("nvgopi"+this.acc,JSON.stringify(t))}catch(t){console.log(t)}},nvg.ReplacePersonaData=function(){if(this.abt&&-1!=this.abt.search(this.persona.abt)){this.onePageData=JSON.parse(window.localStorage.getItem("nvgopi"+this.acc));let t={};for(const i in this.onePageData)for(const s in this.onePageData[i])for(const n in this.onePageData[i][s])t[n]||(t[n]=[]),t[n].push(...this.onePageData[i][s][n]);let e=[];this.persona.page&&e.push(this.persona.page),e.push(this.persona.abt),this.persona.page=e;for(const a in t)this.seg.includes(a)&&(this.persona[a]=Array.from(new Set(t[a])))}window.localStorage.setItem("nvgpersona"+this.account,JSON.stringify(this.persona))},nvg.usrError=function(){this.say("w","error on usr acc"+this.acc),this.saveRequest()},nvg.getSegment=function(t){return"everybuyer"==t?t="industry":"everyone"==t&&(t="cluster"),(t="object"==typeof(t=this.persona[t])?t.join("-"):t)||""},nvg.getCollectionList=function(){var t=this.seg.slice();return(t=t.filter(function(t){return"industry"!=t&&"prolook"!=t&&""!=t}))[t.indexOf("cluster")]="everyone",t},nvg.getReqDefaultParms=function(){var t;this.reqParms.v=this.version,this.reqParms.id=this.usr+"|"+this.syn,this.reqParms.acc=this.acc,this.abt&&(this.reqParms.abt=this.abt),this.reqParms.tit=escape(this.title||d.title),window.location&&(this.reqParms.url=escape(window.location.href)),this.origin&&(this.reqParms.ori=escape(this.origin)),this.ctr&&this.ctr==this.datestr()||(this.reqParms.upd=1),this.isnew&&(this.reqParms.new=1),this.url&&(this.reqParms.url=escape(this.url)),d.referrer&&(this.reqParms.ref=escape(d.referrer)),(t=this.getCookie("__utmz"))&&(this.reqParms.utm=escape(t))},nvg.saveRequest=function(t){t&&(this.reqParms.id=t+"|"+this.syn),this.include(this.getServerDomain("cdn")+"/req?"+this.serializeParams(this.reqParms)),this.callCallbacks()},nvg.config=async function(data){for(var k in this.dsy=!0,w.localStorage.setItem("nvgcnfg"+this.acc,JSON.stringify({date:new Date,cnf:data})),data)this[k]=data[k];-1==w.location.hostname.search(this.dom)&&(this.dom=""),this.dom||(this.dom=this.getTLD()),this.syn=0,this.persona={},this.reqParms={},await this.checkTT(),this.loadProfile();try{await this.OnePageViewInsight()}catch(err){}if(this.ReplacePersonaData(),this.getReqDefaultParms(),this.__loadCustomFp(),this.ext)for(k=0;k<this.ext.length;k++)eval(this.ext[k]);if(this.tmc)for(k=0;k<this.tmc.length;k++)this.include("","script",this.tmc[k]);this.usr&&!this.debug&&this.saveRequest()},nvg.loadCnfg=function(){var t=w.localStorage.getItem("nvgcnfg"+this.acc),e=new Date;if(t&&!this.debug&&(t=JSON.parse(t)).date&&e-new Date(t.date)<=864e5)return this.config(t.cnf);this.include(this.getServerDomain("tag")+"/u/"+this.acc)},nvg.checkTT=async function(){if(null==document.hasTrustToken)return!1;var t="nvgtt"+this.acc;let e=window.localStorage.getItem(t);if("1"==e&&(window.localStorage.removeItem(t),e=null),null!=e&&(e=JSON.parse(e)),null==e)await this.issueTT();else if(1==e.state)await this.redemptionTT();else if(2==e.state){const i=new Date,s=new Date(e.ttl);null!=e.pub_metadata&&(this.reqParms.pub=e.pub_metadata),null!=e.pri_metadata&&(this.reqParms.priv=e.pri_metadata),i.getTime()>s.getTime()&&window.localStorage.removeItem(t)}},nvg.issueTT=async function(){var t="https://token.navegg.com",e=await document.hasTrustToken(t),i="nvgtt"+this.acc;if(e)window.localStorage.setItem(i,JSON.stringify({state:1}));else{e=this.getCookie("nvg"+this.acc);try{await fetch(`${t}/.well-known/trust-token/issuance?key=1&first_party_cookie=`+e,{method:"POST",trustToken:{type:"token-request",issuer:t}}),window.localStorage.setItem(i,JSON.stringify({state:1}))}catch(t){}}},nvg.redemptionTT=async function(){var e="https://token.navegg.com";try{await fetch(`${e}/.well-known/trust-token/redemption`,{method:"POST",trustToken:{type:"token-redemption",issuer:e,refreshPolicy:"none"}})}catch(t){}try{const s=await fetch(`${e}/.well-known/trust-token/send-rr`,{method:"POST",headers:new Headers({"Signed-Headers":"sec-redemption-record, sec-time"}),trustToken:{type:"send-redemption-record",issuers:[e],refreshPolicy:"none",includeTimestampHeader:!0,signRequestData:"include",additionalSigningData:"additional_signing_data"}}),n=await s.json(),a=new Date;n.ttl=a.getTime()+6048e5;var i="nvgtt"+this.acc;let t=JSON.parse(window.localStorage.getItem(i));t.state=2,t=Object.assign(t,n),window.localStorage.setItem(i,JSON.stringify(t))}catch(t){}},nvg.__init__=function(t){if(nvg.seg="gender age education marital income city region country connection brand product interest career cluster prolook custom industry everybuyer pgender page peducation pmarital pincome lookalike abt".split(" "),t[1]=t[1]||{},!("acc"in t[1]))return t[0].say("e","Navegg instance must have acc parameter");for(var e in w["nvg"+t[1].acc]||(w["nvg"+t[1].acc]=t[0]),t[1])t[0][e]=t[1][e];t[0].ckn="nvg"+t[1].acc,t[0].debug="1"==t[0].getParameter("navegg_debug"),t[0].loadCnfg()},w.Navegg.q.push=nvg.__init__;for(var x=0;x<Navegg.q.length;x++){var data=Navegg.q[x];data[0].__init__(data)}}(window,document);