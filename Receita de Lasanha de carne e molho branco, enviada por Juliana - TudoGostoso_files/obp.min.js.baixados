"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,i=arguments[t];for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function i(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(){var t=(_createClass(i,[{key:"setProtocol",value:function(){var e=window.location.protocol,t=void 0;for(t in this.preview.src)this.preview.src.hasOwnProperty(t)&&(this.preview.src[t]=this.preview.src[t].replace(/^/,e).replace(/\{port}/,"https:"===e?8084:8083));for(t in this.preview.assets)this.preview.assets.hasOwnProperty(t)&&(this.preview.assets[t]=this.preview.assets[t].replace(/^/,e).replace(/\{port}/,"https:"===e?8084:8083));for(t in this.dev.src)this.dev.src.hasOwnProperty(t)&&(this.dev.src[t]=this.dev.src[t].replace(/^/,e).replace(/\{port}/,"https:"===e?8084:8083));for(t in this.dev.assets)this.dev.assets.hasOwnProperty(t)&&(this.dev.assets[t]=this.dev.assets[t].replace(/^/,e).replace(/\{port}/,"https:"===e?8084:8083));for(t in this.staging.src)this.staging.src.hasOwnProperty(t)&&"audits"!==t&&(this.staging.src[t]=this.staging.src[t].replace(/^/,e));for(t in this.staging.assets)this.staging.assets.hasOwnProperty(t)&&(this.staging.assets[t]=this.staging.assets[t].replace(/^/,e));for(t in this.prod.src)this.prod.src.hasOwnProperty(t)&&(this.prod.src[t]=this.prod.src[t].replace(/^/,e));for(t in this.prod.assets)this.prod.assets.hasOwnProperty(t)&&(this.prod.assets[t]=this.prod.assets[t].replace(/^/,e))}}]),i);function i(e){_classCallCheck(this,i);var t="simulator"===e,a=e&&"latest"!==e&&"simulator"!==e?"versions/"+e:"staging",e=e&&"latest"!==e&&"simulator"!==e?"versions/"+e:"current";this.test={env:"test",src:{obpCss:"https://libs.sphere.com/video/outbrain-player/"+a+"/obp.css",obpAnimCss:"https://libs.sphere.com/video/outbrain-player/"+a+"/obp-slide-center.css",rmp:"https://cdn.radiantmediatechs.com/rmp/4.4.3/js/rmp.min.js",rmpCss:"https://cdn.radiantmediatechs.com/rmp/4.4.3/css/rmp-s1.min.css",omp:"https://libs.sphere.com/video/outbrain-player/"+a+"/omp.js",ompCss:"https://libs.sphere.com/video/outbrain-player/"+a+"/omp.css",vastParser:"https://libs.sphere.com/video/outbrain-player/lib/vast-client.js",vpaidBridge:"https://libs.sphere.com/video/outbrain-player/lib/VPAIDHTML5Client.js",polyfill:"https://libs.sphere.com/video/outbrain-player/lib/polyfill.min.js",obf:"https://libs.sphere.com/video/outbrain-player/"+a+"/obf.js",obfCss:"https://libs.sphere.com/video/outbrain-player/"+a+"/obf.css",frame:"https://vastcdn.outbrain.com/staging/frame",frameMobile:"https://vastcdn.outbrain.com/staging/frame-mobile",frameOrigin:"file://",audits:"https://videoevents.outbrain.com/events/recordjp"},assets:{logo:"https://widgets.outbrain.com/images/widgetIcons/ob_logo_67x12@2x.png",playIcon:"https://widgets.outbrain.com/images/widgetIcons/play_100x100.png",overlayBackground:"https://libs.sphere.com/video/outbrain-player/assets/overlay.jpg",closeButton:"https://libs.sphere.com/video/outbrain-player/assets/close-mobile-white.png",closeMobileButton:"https://libs.sphere.com/video/outbrain-player/assets/close-mobile.png",loader:"https://libs.sphere.com/video/outbrain-player/assets/loader.gif"}},this.dev={env:"dev",src:{obpCss:"//localhost:{port}/player/dev/obp.css",obpAnimCss:"//localhost:{port}/player/dev/obp-slide-center.css",rmp:"//cdn.radiantmediatechs.com/rmp/4.4.3/js/rmp.min.js",rmpCss:"//cdn.radiantmediatechs.com/rmp/4.4.3/css/rmp-s1.min.css",omp:"//localhost:{port}/outbrain-media-player/dev/omp.js",ompCss:"//localhost:{port}/outbrain-media-player/dev/omp.css",vastParser:"//libs.sphere.com/video/outbrain-player/lib/vast-client.js",vpaidBridge:"//libs.sphere.com/video/outbrain-player/lib/VPAIDHTML5Client.js",polyfill:"//libs.sphere.com/video/outbrain-player/lib/polyfill.min.js",obf:"//localhost:{port}/player/dev/obf.js",obfCss:"//localhost:{port}/player/dev/obf.css",frame:"//vastcdn.outbrain.com/frame",frameMobile:"//vastcdn.outbrain.com/frame-mobile",frameOrigin:"//vastcdn.outbrain.com",audits:"//videoevents.outbrain.com/events/recordjp",extraData:"//videoadextradata.outbrain.com/VideoAdExtraData/api/getFocusExtraData",serviceCalls:"//videoclientsservicescalls.outbrain.com/"},assets:{logo:"//widgets.outbrain.com/images/widgetIcons/ob_logo_67x12@2x.png",playIcon:"//widgets.outbrain.com/images/widgetIcons/play_100x100.png",overlayBackground:"//localhost:{port}/player/src/assets/overlay.jpg",closeButton:"//localhost:{port}/player/src/assets/close-mobile-white.png",closeMobileButton:"//localhost:{port}/player/src/assets/close-mobile-white.png",loader:"//localhost:{port}/player/src/assets/loader.gif"}},this.preview={env:"preview",src:{obpCss:"//libs.sphere.com/video/outbrain-player/"+e+"/obp.min.css",obpAnimCss:"//libs.sphere.com/video/outbrain-player/"+e+"/obp-slide-center.css",rmp:"//cdn.radiantmediatechs.com/rmp/4.4.3/js/rmp.min.js",rmpCss:"//cdn.radiantmediatechs.com/rmp/4.4.3/css/rmp-s1.min.css",omp:"//libs.sphere.com/video/outbrain-player/"+e+"/omp.min.js",ompCss:"//libs.sphere.com/video/outbrain-player/"+e+"/omp.min.css",vastParser:"//libs.sphere.com/video/outbrain-player/lib/vast-client.js",vpaidBridge:"//libs.sphere.com/video/outbrain-player/lib/VPAIDHTML5Client.js",polyfill:"//libs.sphere.com/video/outbrain-player/lib/polyfill.min.js",obf:"//libs.sphere.com/video/outbrain-player/"+e+"/obf.min.js",obfCss:"//libs.sphere.com/video/outbrain-player/"+e+"/obf.min.css",frame:"//vastcdn.outbrain.com/frame",frameMobile:"//vastcdn.outbrain.com/frame-mobile",frameOrigin:"//vastcdn.outbrain.com",previewFrameOrigin:"//"+window.location.host,audits:"https://sim-eventsrecorder.outbrain.com/EventsRecorder/api/events/recordjp",extraData:"//videoadextradata.outbrain.com/VideoAdExtraData/api/getFocusExtraData",serviceCalls:t?"//videoclientsservicescalls-sim.outbrain.com/VideoClientsServicesCalls/api/":"//videoclientsservicescalls.outbrain.com/"},assets:{logo:"//widgets.outbrain.com/images/widgetIcons/ob_logo_67x12@2x.png",playIcon:"//widgets.outbrain.com/images/widgetIcons/play_100x100.png",overlayBackground:"//libs.sphere.com/video/outbrain-player/assets/overlay.jpg",closeButton:"//libs.sphere.com/video/outbrain-player/assets/close-mobile-white.png",closeMobileButton:"//libs.sphere.com/video/outbrain-player/assets/close-mobile-white.png",loader:"//libs.sphere.com/video/outbrain-player/assets/loader.gif"}},this.staging={env:"staging",src:{obpCss:"//libs.sphere.com/video/outbrain-player/"+a+"/obp.css",obpAnimCss:"//libs.sphere.com/video/outbrain-player/"+a+"/obp-slide-center.css",rmp:"//cdn.radiantmediatechs.com/rmp/4.4.3/js/rmp.min.js",rmpCss:"//cdn.radiantmediatechs.com/rmp/4.4.3/css/rmp-s1.min.css",omp:"//libs.sphere.com/video/outbrain-player/"+a+"/omp.js",ompCss:"//libs.sphere.com/video/outbrain-player/"+a+"/omp.css",vastParser:"//libs.sphere.com/video/outbrain-player/lib/vast-client.js",vpaidBridge:"//libs.sphere.com/video/outbrain-player/lib/VPAIDHTML5Client.js",polyfill:"//libs.sphere.com/video/outbrain-player/lib/polyfill.min.js",obf:"//libs.sphere.com/video/outbrain-player/"+a+"/obf.js",obfCss:"//libs.sphere.com/video/outbrain-player/"+a+"/obf.css",frame:"//vastcdn.outbrain.com/staging/frame",frameMobile:"//vastcdn.outbrain.com/staging/frame-mobile",frameOrigin:"//vastcdn.outbrain.com",audits:"https://sim-eventsrecorder.outbrain.com/EventsRecorder/api/events/recordjp",extraData:"//videoadextradata.outbrain.com/VideoAdExtraData/api/getFocusExtraData",serviceCalls:"//videoclientsservicescalls.outbrain.com/"},assets:{logo:"//widgets.outbrain.com/images/widgetIcons/ob_logo_67x12@2x.png",playIcon:"//widgets.outbrain.com/images/widgetIcons/play_100x100.png",overlayBackground:"//libs.sphere.com/video/outbrain-player/assets/overlay.jpg",closeButton:"//libs.sphere.com/video/outbrain-player/assets/close-mobile-white.png",closeMobileButton:"//libs.sphere.com/video/outbrain-player/assets/close-mobile-white.png",loader:"//libs.sphere.com/video/outbrain-player/assets/loader.gif"}},this.prod={env:"prod",src:{obpCss:"//libs.sphere.com/video/outbrain-player/"+e+"/obp.min.css",obpAnimCss:"//libs.sphere.com/video/outbrain-player/"+e+"/obp-slide-center.css",rmp:"//cdn.radiantmediatechs.com/rmp/4.4.3/js/rmp.min.js",rmpCss:"//cdn.radiantmediatechs.com/rmp/4.4.3/css/rmp-s1.min.css",omp:"//libs.sphere.com/video/outbrain-player/"+e+"/omp.min.js",ompCss:"//libs.sphere.com/video/outbrain-player/"+e+"/omp.min.css",vastParser:"//libs.sphere.com/video/outbrain-player/lib/vast-client.js",vpaidBridge:"//libs.sphere.com/video/outbrain-player/lib/VPAIDHTML5Client.js",polyfill:"//libs.sphere.com/video/outbrain-player/lib/polyfill.min.js",obf:"//libs.sphere.com/video/outbrain-player/"+e+"/obf.min.js",obfCss:"//libs.sphere.com/video/outbrain-player/"+e+"/obf.min.css",frame:"//vastcdn.outbrain.com/frame",frameMobile:"//vastcdn.outbrain.com/frame-mobile",frameOrigin:"//vastcdn.outbrain.com",audits:"//videoevents.outbrain.com/events/recordjp",extraData:"//videoadextradata.outbrain.com/VideoAdExtraData/api/getFocusExtraData",serviceCalls:"//videoclientsservicescalls.outbrain.com/"},assets:{logo:"//widgets.outbrain.com/images/widgetIcons/ob_logo_67x12@2x.png",playIcon:"//widgets.outbrain.com/images/widgetIcons/play_100x100.png",overlayBackground:"//libs.sphere.com/video/outbrain-player/assets/overlay.jpg",closeButton:"//libs.sphere.com/video/outbrain-player/assets/close-mobile-white.png",closeMobileButton:"//libs.sphere.com/video/outbrain-player/assets/close-mobile-white.png",loader:"//libs.sphere.com/video/outbrain-player/assets/loader.gif"}},this.setProtocol()}var u=(_createClass(e,null,[{key:"waterfall",value:function(e,a){return e.reduce(function(e,t){return e.then(a?t.bind(a):t)},Promise.resolve())}},{key:"uuid",value:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return"ob"+e().substring(0,2)+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},{key:"ajax",value:function(e){var t=e.method,a=e.url,i=(e.data,e.success),s=e.fail,n=new XMLHttpRequest;n.open(t,a),n.onload=function(){200===n.status?"function"==typeof i&&i(n.responseText):"function"==typeof s&&s(n.status)},n.send()}},{key:"extend",value:function(t,a){return Object.keys(a).forEach(function(e){t[e]=a[e]}),t}},{key:"getElement",value:function(e,t){return function e(t,a){var i=Object.keys(a),s=null;if(0<=i.indexOf(t))return a[t];for(var n=i.length;n--;)if(a[i[n]]&&"object"===_typeof(a[i[n]])&&"elm"!==i[n]&&(s=e(t,a[i[n]])))return s;return s}(e,t)}},{key:"injectStyle",value:function(e,t){var a=document.getElementsByTagName("body")[0],i=document.createElement("style");t&&i.classList.add(t),i.innerHTML=e,a.appendChild(i)}},{key:"removeStyle",value:function(e){for(var t=e?document.getElementsByClassName(e):document.getElementsByTagName("style"),a=t.length;a--;)t[a].parentNode.removeChild(t[a])}},{key:"humanTime",value:function(e){var t=new Date(null);return t.setSeconds(e),t.toISOString().substr(14,5)}},{key:"truncateFromElement",value:function(e,t){var a=document.createElement("span"),i=e.length,s=[],n=0,r=e;a.style.visibility="hidden",t.appendChild(a);for(var l=t.offsetWidth;n<i;n++)if(s.push(e[n]),a.innerText=s.join(""),a.offsetWidth>=l-30){s.push(" ..."),r=s.join("");break}return t.removeChild(a),r}}]),e);function e(){_classCallCheck(this,e)}var n=(_createClass(s,[{key:"setSession",value:function(){this.sessionId=u.uuid()}},{key:"setBody",value:function(){var e=u.getElement("body",this.elements);if(e.elm=document.getElementsByTagName("body")[0],!e.elm)throw new Error("Cannot find document body. Aborting")}},{key:"setRec",value:function(){for(var e,t,a=u.getElement("widget",this.elements),i=document.getElementsByClassName(a.className),s=i.length,n=void 0,r=void 0,l=void 0;s--;)if((e=i[s].getAttribute(a.idxAttr))&&parseInt(e)===this.recData.widgetIdx&&(a.elm=i[s],(n=i[s].getElementsByClassName(a.rec.idxAttrPrefix+this.recData.pos)).length))for(l=n.length;l--;)if((r=n[l].getElementsByClassName(a.rec.link.className)).length&&r[0].getAttribute(a.rec.link.idAttr)&&(a.rec.elm=n[l],a.rec.link.elm=r[0],(t=n[l].getElementsByClassName(a.rec.thumbnail.className)).length))return a.rec.thumbnail.elm=t[0],!0;throw new Error("Cannot find video recommendation. Skipping")}},{key:"setRecNoWidget",value:function(){var e=u.getElement("nonWidgetRec",this.elements);if(this.recData.recId&&(e.elm=document.getElementById(this.recData.recId),e.elm))return this.elements.window.body.widget=void 0,e.thumbnail.elm=e.elm,!0;throw new Error("Could not find rec element")}},{key:"setPlayIcon",value:function(){var s=this;return new Promise(function(e){var t,a=u.getElement("rec",s.elements),i=a.elm.getElementsByClassName(a.playIcon.widgetClassName);i.length&&(a.playIcon.elm=i[0],(t=i[0].getElementsByTagName("img")).length&&(a.playIcon.img.src=t[0].src,s.iconSrc=t[0].src,a.playIcon.img.elm=t[0]),s.autoplayEnabled&&i.length&&(i[0].style.display="none")),e(!0)})}},{key:"showLoader",value:function(){if(this.runWithoutObWidget){var e=u.getElement("nonWidgetRec",this.elements);return e.loaderIcon.elm=document.createElement("span"),e.loaderIcon.elm.classList.add("ob-non-widget-rec","obp-loader"),e.thumbnail.elm.parentNode.appendChild(e.loaderIcon.elm),void(e.thumbnail.elm.firstChild.style&&(e.thumbnail.elm.firstChild.style.display="none"))}e=u.getElement("rec",this.elements);e.playIcon.img.elm?e.playIcon.img.elm.src=this.shared.config.assets.loader:e.playIcon.elm?e.playIcon.elm.style.backgroundImage="url("+this.shared.config.assets.loader+")":(e.loaderIcon.elm=document.createElement("span"),e.loaderIcon.elm.classList.add(e.playIcon.className),e.thumbnail.elm.parentNode.appendChild(e.loaderIcon.elm))}},{key:"hideLoader",value:function(){if(this.runWithoutObWidget){var e=u.getElement("nonWidgetRec",this.elements);return e.loaderIcon.elm.style.display="none",void(e.thumbnail.elm.firstChild.style&&(e.thumbnail.elm.firstChild.style.display="block"))}var t=u.getElement("rec",this.elements),e=t.playIcon.elm;t.playIcon.img.elm?t.playIcon.img.elm.src=t.playIcon.img.src:this.iconSrc?t.playIcon.elm.style.backgroundImage="url("+this.iconSrc+")":e&&(e.style.backgroundImage=null),t.loaderIcon.elm&&(t.loaderIcon.elm.style.backgroundImage=null)}},{key:"setWidgetDirection",value:function(){if("function"==typeof window.getComputedStyle){var e=u.getElement("widget",this.elements),e=e.elm.getElementsByClassName(e.items.className);if(e.length)for(var t,a=getComputedStyle(e[0]),i=a.length;i--;)if("direction"===(t=a[i])){this.widgetDirection=a.getPropertyValue(t);break}}}},{key:"overrideRecLink",value:function(){var e=u.getElement("link",this.elements);e.elm.href="#",e.elm.removeAttribute("onclick"),e.elm.removeAttribute("onmousedown"),e.elm.removeAttribute("target"),e.elm.addEventListener("click",function(e){e.preventDefault()})}},{key:"injectFrameStyle",value:function(){var e=this.runWithoutObWidget?u.getElement("nonWidgetRec",this.elements):u.getElement("rec",this.elements);e.position||(e.position=e.elm.getBoundingClientRect(),e.position.sy=e.position.y+window.scrollY,e.position.sx=e.position.x+window.scrollX),this.preventVideoOverlay&&(e.position.sy=this.preventVideoOverlayPositions.top,e.position.sx=this.preventVideoOverlayPositions.left);e="#"+this.id+"."+e.frame.onRecClassName+" { top: "+e.position.sy+"px; left: "+e.position.sx+"px; width: "+e.position.width+"px; height: "+e.position.height+"px; }";u.injectStyle(e,this.elements.window.body.style.frameClassName)}},{key:"insertFrame",value:function(){var a=this;"prod"!==this.shared.config.env&&console.log("Frame insertion: "+Date.now());var e=u.getElement("style",this.elements),i=this.runWithoutObWidget?u.getElement("nonWidgetRec",this.elements):u.getElement("rec",this.elements),t=u.getElement("src",this.shared.config),s=this.shared.mobile?t.frameMobile:t.frame,t=this.elements.window.body;this.preventVideoOverlay&&(t=this.elements.window.body.widget.rec,n=i.elm.getElementsByClassName("ob-rec-image-container")[0],this.preventVideoOverlayPositions.top=n?n.offsetTop:0,this.preventVideoOverlayPositions.left=n?n.offsetLeft:0);var n=this.animation.forceOverride?t:i,r=window.location.protocol+"//"+window.location.hostname;window.location.port&&(r+=":"+window.location.port),i.frame.elm=document.createElement("iframe"),i.frame.elm.id=this.id,"preview"===this.shared.config.env&&this.recData.vastXml?(i.frame.elm.src="about:blank",u.ajax({method:"GET",url:"https://libs.outbrain.com/video/outbrain-player/current/frame.html",success:function(e){var t=['"h=',encodeURIComponent(r),"&id=",encodeURIComponent(a.id),"&url=","",'"'];e=(e=e.replace("window.location.search.substring(1)",t.join(""))).replace("#VAST#",a.recData.vastXml.replace(/(\r\n|\n|\r)/gm," ").replace(/'/g,"\\'")),i.frame.elm.contentWindow.document.open("text/htmlreplace"),i.frame.elm.contentWindow.document.write(e),i.frame.elm.contentWindow.document.close()}})):(t="",this.recData.origUrl.includes("cache=no")&&(t=this.recData.origUrl.includes("?")?"&cache=no":"?cache=no"),this.recData.origUrl=this.replaceMacros(this.recData.origUrl),t=[s,"?h=",encodeURIComponent(r),"&id=",encodeURIComponent(this.id),"&url=",encodeURIComponent(this.recData.origUrl)+t],i.frame.elm.src=t.join("")),i.frame.elm.classList.add(e.hideClassName);e=this.preventVideoOverlay?"false":"true";i.frame.elm.setAttribute("allowfullscreen",e),i.frame.elm.setAttribute("webkitallowfullscreen",e),i.frame.elm.setAttribute("mozallowfullscreen",e),i.frame.elm.setAttribute("gesture","media"),i.frame.elm.setAttribute("scrolling","no"),i.frame.elm.setAttribute("width","100%"),this.animation.forceOverride&&i.frame.elm.classList.add(i.frame.onRecClassName),this.shared.isReelWidget&&(i.frame.elm.style.zIndex=1),n.elm.appendChild(i.frame.elm)}},{key:"replaceMacros",value:function(e){return decodeURIComponent(e).replace("{ivc_ad_id}",this.recData.adId).replace("{ivc_widget_name}",this.recData.widgetID).replace("{ivc_widget_id}",this.recData.widgetNumberId).replace("{ivc_ad_title}",this.recData.title).replace("{ivc_source_id}",this.recData.sourceId).replace("{ivc_req_id}",this.recData.reqId).replace("{ivc_campaign_id}",this.recData.campaignId).replace("{ivc_publisher_id}",this.recData.publisherId).replace("{ivc_publisher_name}",this.recData.publisherName).replace("{ivc_adv_name}",this.recData.sourceName).replace("{ivc_time_stamp}",this.recData.timestamp).replace("{ivc_doc_id}",this.recData.did).replace("{ivc_ext_ad_id}",this.recData.externalIds?this.recData.externalIds.adId:"").replace("{ivc_ext_source_id}",this.recData.externalIds?this.recData.externalIds.sourceId:"").replace("{ivc_ext_campaign_id}",this.recData.externalIds?this.recData.externalIds.campaignId:"").replace("{ivc_ext_publisher_id}",this.recData.externalIds?this.recData.externalIds.publisherId:"").replace("{ivc_ext_doc_id}",this.recData.externalIds?this.recData.externalIds.did:"").replace("{{ad_id}}",this.recData.adId).replace("{{widget_name}}",this.recData.widgetID).replace("{{widget_id}}",this.recData.widgetNumberId).replace("{{ad_title}}",this.recData.title).replace("{{section_id}}",this.recData.sourceId).replace("{{req_id}}",this.recData.reqId).replace("{{campaign_id}}",(this.recData.externalIds||this.recData).campaignId).replace("{{publisher_id}}",this.recData.publisherId).replace("{{publisher_name}}",this.recData.publisherName).replace("{{adv_name}}",this.recData.sourceName).replace("{{time_stamp}}",this.recData.timestamp).replace("{{doc_id}}",this.recData.did)}},{key:"setElementsStack",value:function(){var n=this;setTimeout(function(){if(n.recData.enforceElementsStack)for(var e,t,a,i=u.getElement("body",n.elements).elm.getElementsByTagName("*"),s=i.length;s--;)"iframe"===i[s].tagName.toLowerCase()&&i[s].id===n.id||(e=getComputedStyle(i[s]).getPropertyValue("z-index"),t=i[s].style.zIndex,a=void 0,e&&(a=parseInt(e)),2147483647<=(a=t?parseInt(t):a)&&n.elementsStack.push({elm:i[s],zIndex:a,origin:t?"style":"computed"}))},5e3)}},{key:"addVideoDuration",value:function(e){if(!this.autoplayEnabled){var t=u.getElement("rec",this.elements);if(!t.duration.elm){var a="rtl"===this.widgetDirection?t.duration.bottomLeftPosClassName:t.duration.bottomRightPosClassName;if(this.recData.videoDurationDisplayLocation){var i=this.recData.videoDurationDisplayLocation.trim();if("none"===i)return;switch(i){case"bottom_left":a=t.duration.bottomLeftPosClassName;break;case"top_right":a=t.duration.topRightPosClassName;break;case"top_left":a=t.duration.topLeftPosClassName}}t.duration.elm=document.createElement("span"),t.duration.elm.classList.add(t.duration.className),t.duration.elm.classList.add(a),t.duration.elm.appendChild(document.createTextNode(u.humanTime(e/1e3))),t.thumbnail.elm.parentNode.insertBefore(t.duration.elm,t.thumbnail.elm.parentNode.firstChild)}}}},{key:"setThumbnailPosition",value:function(){this.runWithoutObWidget?u.getElement("nonWidgetRec",this.elements):u.getElement("rec",this.elements);var e=u.getElement("thumbnail",this.elements),t=this.shared.window,a=e.elm.getBoundingClientRect(),i=e.elm.offsetHeight,s=e.elm.offsetWidth,n=t.height/2-i/2,r=t.width/2-s/2,l={width:640,height:360};this.shared.mobile||(d=this.mediaWidth&&this.mediaHeight?parseFloat((this.mediaWidth/this.mediaHeight).toString().match(/^-?\d+(?:\.\d{0,6})?/)[0]):void 0,l=this.getVideoMaxSize(d));var o=this.shared.mobile?0:(t.height-l.height)/2,d=this.shared.mobile?0:(t.width-l.width)/2;this.framePositions={x:a.left,y:a.top,offsetX:e.elm.offsetLeft,offsetY:e.elm.offsetTop,originalWidth:s,originalHeight:i,centerTop:n,centerLeft:r,maxTop:o,maxLeft:d,maxWidth:(this.shared.mobile?t:l).width,maxHeight:(this.shared.mobile?t:l).height}}},{key:"getVideoMaxSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1.77,t=this.shared.window,a=parseInt(t.width*this.partSize/100),i=parseInt(t.height*this.partSize/100),s=a,n=i,r=a/i;if(parseFloat(r.toString().match(/^-?\d+(?:\.\d{0,6})?/)[0])===e)return{width:a,height:i};if(1<=e){for(;0<s;s--)for(n=i;0<n;n--)if(r=s/n,parseFloat(r.toString().match(/^-?\d+(?:\.\d{0,6})?/)[0])===e)return{width:s,height:n}}else for(;0<n;n--)for(s=a;0<s;s--)if(r=s/n,parseFloat(r.toString().match(/^-?\d+(?:\.\d{0,6})?/)[0])===e)return{width:s,height:n};t=parseFloat(e.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]);return 1.77===t?{width:640,height:360}:1.6===t?{width:640,height:200}:1.33===t?{width:640,height:480}:1.66===t?{width:800,height:480}:1.25===t?{width:1280,height:1024}:1.91===t?{width:640,height:334}:{width:640,height:360}}},{key:"cssPlaceholders",value:function(){for(var e,t=u.getElement("style",this.elements),a=(this.runWithoutObWidget?u.getElement("nonWidgetRec",this.elements):u.getElement("rec",this.elements),this.shared.dynCSS);null!==(e=this.placeholdersRegExp.exec(a));)switch(e[1]){case"obpTransition":a=a.replace(e[0],this.animation.transition);break;case"obpSpeed":a=a.replace(e[0],this.animation.speed+"ms");break;case"obpWidth":a=a.replace(e[0],this.framePositions.originalWidth+"px");break;case"obpHeight":a=a.replace(e[0],this.framePositions.originalHeight+"px");break;case"obpTop":a=a.replace(e[0],this.framePositions.y+"px");break;case"obpLeft":a=a.replace(e[0],this.framePositions.x+"px");break;case"obpCenterTop":a=a.replace(e[0],this.framePositions.centerTop+"px");break;case"obpCenterLeft":a=a.replace(e[0],this.framePositions.centerLeft+"px");break;case"obpMaxTop":a=a.replace(e[0],this.framePositions.maxTop+"px");break;case"obpMaxLeft":a=a.replace(e[0],this.framePositions.maxLeft+"px");break;case"obpMaxWidth":a=a.replace(e[0],this.preventVideoOverlay?"":this.framePositions.maxWidth+"px");break;case"obpMaxHeight":a=a.replace(e[0],this.preventVideoOverlay?"":this.framePositions.maxHeight+"px");break;case"obpOverlyWidth":a=a.replace(e[0],this.preventVideoOverlay?"":"1px");break;case"obpOverlyMinWidth":a=a.replace(e[0],this.preventVideoOverlay?"":"100% !important");break;case"obpOverlyHeight":a=a.replace(e[0],this.preventVideoOverlay?"":"100%");break;case"obpOverlyTop":a=a.replace(e[0],this.preventVideoOverlay?this.preventVideoOverlayPositions.top+"px":"0");break;case"obpOverlyLeft":a=a.replace(e[0],this.preventVideoOverlay?this.preventVideoOverlayPositions.left+"px":"0");break;case"obpOverlyPosition":a=a.replace(e[0],this.preventVideoOverlay?"absolute":"")}this.animation.active&&this.removeFrameStyle(),u.injectStyle(a,t.className)}},{key:"hidePlayIcon",value:function(){var e=u.getElement("playIcon",this.elements),t=u.getElement("style",this.elements);e&&e.elm&&e.elm.classList.add(t.hideClassName)}},{key:"showPlayIcon",value:function(){var e=u.getElement("playIcon",this.elements),t=u.getElement("style",this.elements);e&&e.elm&&e.elm.classList.remove(t.hideClassName)}},{key:"animationReady",value:function(){var e=u.getElement("frame",this.elements);this.preventScroll(),this.lowerBodyElements(),this.shared.frameListener.sendToChild(e.elm,"ready",{maxWidth:this.framePositions.maxWidth,maxHeight:this.framePositions.maxHeight})}},{key:"startAnimation",value:function(e){var t=this,a=u.getElement("style",this.elements),i=u.getElement("frame",this.elements);"open"===e?(this.addHash(),this.shared.frameListener.sendToChild(i.elm,"animation-start",{mode:"open"}),this.animation.forceOverride&&i.elm.classList.remove(i.onRecClassName),i.elm.classList.add(i.inPlaceClassName),i.elm.classList.add(i.centerClassName),i.elm.classList.add(i.maxSizeClassName),setTimeout(function(){i.elm.classList.add(i.doneClassName),i.elm.classList.add(a.noTransitionClassName),t.shared.mobile&&i.elm.classList.add(i.mobileDoneClassName),t.shared.frameListener.sendToChild(i.elm,"animation-end",{mode:"open"})},this.animation.speed)):(this.removeHash(),this.shared.frameListener.sendToChild(i.elm,"animation-start",{mode:"close"}),i.elm.classList.remove(i.doneClassName),this.shared.mobile&&i.elm.classList.remove(i.mobileDoneClassName),setTimeout(function(){i.elm.classList.remove(a.noTransitionClassName),i.elm.classList.remove(i.maxSizeClassName),i.elm.classList.remove(i.centerClassName),setTimeout(function(){t.isGifThumb||t.showPlayIcon(),i.elm.classList.remove(i.inPlaceClassName),t.animation.forceOverride&&i.elm.classList.add(i.onRecClassName),t.shared.frameListener.sendToChild(i.elm,"animation-end",{mode:"close"}),setTimeout(function(){u.removeStyle(a.className),t.releaseScroll(),t.resetBodyElements()},t.animation.speed)},t.animation.speed)},100))}},{key:"resized",value:function(){var e=u.getElement("frame",this.elements);this.shared.frameListener.sendToChild(e.elm,"resize",{width:this.shared.window.width,height:this.shared.window.height,maxWidth:this.framePositions.maxWidth,maxHeight:this.framePositions.maxHeight})}},{key:"addHash",value:function(){this.hashTime=Date.now(),window.location.hash="ob-player",window.addEventListener("hashchange",this.events.hash,!1)}},{key:"removeHash",value:function(){history.pushState("",document.title,window.location.pathname+window.location.search),window.removeEventListener("hashchange",this.events.hash,!1)}},{key:"onHashChange",value:function(){var e=Date.now();"#ob-player"!==window.location.hash&&2e3<e-this.hashTime&&(e=u.getElement("frame",this.elements),this.shared.frameListener.sendToChild(e.elm,"close"))}},{key:"preventScroll",value:function(){this.preventVideoOverlay||(window.addEventListener("scroll",this.events.scrollListener,!1),window.addEventListener("DOMMouseScroll",this.events.scrollListener,!1),window.onwheel=this.events.scrollListener,window.onmousewheel=document.onmousewheel=this.events.scrollListener,window.ontouchmove=this.events.scrollListener,document.onkeydown=this.events.scrollKeyListener,this.scrollPosition.x=window.scrollX,this.scrollPosition.y=window.scrollY)}},{key:"releaseScroll",value:function(){this.preventVideoOverlay||(window.removeEventListener("scroll",this.events.scrollListener,!1),window.removeEventListener("DOMMouseScroll",this.events.scrollListener,!1),window.onwheel=null,window.onmousewheel=document.onmousewheel=null,window.ontouchmove=null,document.onkeydown=null)}},{key:"lowerBodyElements",value:function(){for(var e=this.elementsStack.length;e--;)this.elementsStack[e].elm.style.zIndex=2147483637}},{key:"resetBodyElements",value:function(){for(var e=this.elementsStack.length;e--;)"computed"===this.elementsStack[e].origin?this.elementsStack[e].elm.style.zIndex=null:this.elementsStack[e].elm.style.zIndex=this.elementsStack[e].zIndex}},{key:"removeFrameStyle",value:function(){for(var e=document.getElementsByClassName(this.elements.window.body.style.frameClassName),t=e.length;t--;)e[t].parentNode.removeChild(e[t])}},{key:"framePositionCheck",value:function(){function e(){var e,t,a,i;s.playing||(t=(e=s.runWithoutObWidget?u.getElement("nonWidgetRec",s.elements):u.getElement("rec",s.elements)).elm.getBoundingClientRect(),a=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,i=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,t.sy=t.y?t.y+i:t.top+i,t.sx=t.x?t.x+a:t.left+a,e.position.sy===t.sy&&e.position.sx===t.sx||(e.position=t,s.removeFrameStyle(),s.injectFrameStyle(),s.setThumbnailPosition()))}var s=this;e.call(this),this.positionCheckId=setInterval(e.bind(this),4e3)}},{key:"destroy",value:function(){var e=this.elements.window.body.style,t=u.getElement("frame",this.elements);this.positionCheckId&&clearInterval(this.positionCheckId),window.removeEventListener("hashchange",this.events.hash,!1),t.elm&&t.elm.parentNode&&t.elm.parentNode.removeChild(t.elm),u.removeStyle(e.className),u.removeStyle(e.frameClassName),this.releaseScroll()}},{key:"onRecInView",value:function(){var e=(this.runWithoutObWidget?u.getElement("nonWidgetRec",this.elements):u.getElement("rec",this.elements)).frame.elm;this.shared.frameListener.sendToChild(e,"rec-in-view")}},{key:"onScroll",value:function(e){return e.preventDefault(),e.returnValue=!1,window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),!1}},{key:"onKeyScroll",value:function(e){if({37:1,38:1,39:1,40:1}[e.keyCode])return e.preventDefault(),e.returnValue=!1,window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),!1}},{key:"onInit",value:function(){var e=u.getElement("style",this.elements),t=(this.runWithoutObWidget?u.getElement("nonWidgetRec",this.elements):u.getElement("rec",this.elements)).frame.elm,a={src:this.shared.config.src.obf};this.shared.ie&&(a.ie=this.shared.ie,a.poly=this.shared.config.src.polyfill),t.classList.remove(e.hideClassName),this.shared.frameListener.sendToChild(t,"init",a)}},{key:"onConfig",value:function(){var e=u.getElement("frame",this.elements);this.shared.frameListener.sendToChild(e.elm,"config",{config:this.shared.config,mobile:this.shared.mobile,ie:this.shared.ie,recData:this.recData,sessionId:this.sessionId,widgetDirection:this.widgetDirection,animation:this.animation,isIframe:this.shared.isIFrame,isTest:this.shared.isTest,isQA:this.shared.isQA,adExtraData:this.shared.adExtraData,featureFlags:this.shared.featureFlags,eventsCounter:this.shared.eventsCounter,window:{width:this.shared.window.width,height:this.shared.window.height},settingsFeatures:this.shared.settingsFeatures,isReelWidget:this.shared.isReelWidget})}},{key:"onLoad",value:function(e){this.playerReady||this.finalizeFrameDesign(e)}},{key:"onPlayerLoaded",value:function(e){this.playerReady=!0,this.finalizeFrameDesign(e)}},{key:"finalizeFrameDesign",value:function(e){this.hideLoader(),this.mediaHeight=e.mediaHeight,this.mediaWidth=e.mediaWidth,this.animation.duration&&this.addVideoDuration(e.duration),this.animation.forceOverride&&(this.removeFrameStyle(),this.injectFrameStyle(),this.framePositionCheck()),null!==this.isGifThumb&&this.isGifThumb&&this.hidePlayIcon(),this.autoplayEnabled&&(this.hidePlayIcon(),e=u.getElement("frame",this.elements),this.shared.frameListener.sendToChild(e.elm,"autoPlayReady"))}},{key:"onClick",value:function(){u.getElement("thumbnail",this.elements);var e=u.getElement("frame",this.elements);this.shared.isReelWidget&&(e.elm.style.zIndex=2147483647);var t=[this.setThumbnailPosition,this.cssPlaceholders,this.hidePlayIcon,this.animationReady];e.elm.classList.add(e.className),u.waterfall(t,this).catch(this.onError.bind(this))}},{key:"onReady",value:function(){this.startAnimation("open")}},{key:"onClose",value:function(){this.startAnimation("close"),this.shared.isReelWidget&&(u.getElement("frame",this.elements).elm.style.zIndex=1)}},{key:"onEsc",value:function(){var e=u.getElement("frame",this.elements);this.shared.frameListener.sendToChild(e.elm,"esc")}},{key:"onResize",value:function(e){u.getElement("frame",this.elements);this.shared.window.width=e.width,this.shared.window.height=e.height,this.playing?u.waterfall([this.setThumbnailPosition,this.cssPlaceholders,this.resized],this).catch(this.onError.bind(this)):this.resized()}},{key:"onIsPlaying",value:function(e){this.playing=e.playing}},{key:"onAutoPlay",value:function(){var e=u.getElement("frame",this.elements),t=[this.setThumbnailPosition,this.cssPlaceholders,this.animationReady];e.elm.classList.add(e.className),u.waterfall(t,this).catch(this.onError.bind(this))}},{key:"onError",value:function(e){this.shared.errorHandler(e)}}]),s);function s(e,t,a){_classCallCheck(this,s),this.id=e,this.recData=t,this.shared=a,this.sessionId=null,this.hashTime=0,this.elementsStack=[],this.framePositions={},this.scrollPosition={},this.positionCheckId=0,this.playing=!1,this.widgetDirection="ltr",this.placeholdersRegExp=/'<([\w\d]+)>'/,this.partSize=a.mobile?95:65,this.isGifThumb=null,this.animation={},this.playerReady=!1,this.iconSrc=null,this.mediaHeight=null,this.mediaWidth=null,this.recData.adExtraData&&("preview"===this.shared.config.env?this.extraData=this.recData.adExtraData[Object.keys(this.recData.adExtraData)[0]]:this.extraData=this.recData.adExtraData[this.recData.adId]||void 0),this.autoplayEnabled=this.extraData&&"true"===this.extraData.autoPlayEnabled,this.preventVideoOverlay=this.shared.featureFlags.allowPlayWithoutOverly&&!this.shared.mobile&&(!1===this.recData.nativeVideoOverlay||this.autoplayEnabled),this.preventVideoOverlayPositions={top:void 0,left:void 0},this.recData.hasOwnProperty("mediaPlayer")||(this.recData.mediaPlayer="omp"),this.animation.forceOverride=!0,this.animation.active=!1,this.animation.theme="theme-4",this.runWithoutObWidget="preview"===this.shared.config.env,this.animation.duration=!this.runWithoutObWidget,this.animation.assets={close:this.shared.mobile?this.shared.config.assets.closeMobileButton:this.shared.config.assets.closeButton},this.animation.speed=this.animation.active?550:0,this.animation.transition=this.animation.active?"top "+this.animation.speed+"ms, left "+this.animation.speed+"ms, width "+this.animation.speed+"ms, height "+this.animation.speed+"ms":"none",this.elements={window:{height:a.window.height,width:a.window.width,body:{elm:null,nonWidgetRec:{elm:null,frame:{elm:null,className:"obp",onRecClassName:"obp-rec",inPlaceClassName:"obp-in-place",centerClassName:"obp-center",maxSizeClassName:"obp-maxsize",doneClassName:"obp-done",mobileDoneClassName:"obp-mobile-done"},thumbnail:{elm:null},loaderIcon:{elm:null,className:"obp-loader"}},widget:{elm:null,className:"OUTBRAIN",idxAttr:"data-idx",items:{className:"ob-widget-items-container"},rec:{elm:null,idxAttrPrefix:"ob-recIdx-",position:null,thumbnail:{elm:null,className:"ob-rec-image"},link:{elm:null,className:"ob-dynamic-rec-link",idAttr:"data-video-id"},playIcon:{elm:null,widgetClassName:"ob-video-icon-container",className:"ob-player-icon",img:{elm:null,src:null}},loaderIcon:{elm:null,className:"obp-loader"},duration:{elm:null,className:"ob-video-duration",bottomRightPosClassName:"ob-bottom-right",topLeftPosClassName:"ob-top-left",topRightPosClassName:"ob-top-right",bottomLeftPosClassName:"ob-bottom-left"},frame:{elm:null,className:"obp",onRecClassName:"obp-rec",inPlaceClassName:"obp-in-place",centerClassName:"obp-center",maxSizeClassName:"obp-maxsize",doneClassName:"obp-done",mobileDoneClassName:"obp-mobile-done"}}},style:{className:"obp-style",frameClassName:u.uuid(),hideClassName:"obp-hidden",noTransitionClassName:"obp-no-transition"}}}},this.events={scrollListener:this.onScroll.bind(this),scrollKeyListener:this.onKeyScroll.bind(this),hash:this.onHashChange.bind(this)};a=void 0,a=this.runWithoutObWidget?[this.setSession,this.setBody,this.setRecNoWidget,this.showLoader,this.insertFrame,this.setElementsStack]:[this.setSession,this.setBody,this.setRec,this.setPlayIcon,this.showLoader,this.setWidgetDirection,this.overrideRecLink,this.insertFrame,this.setElementsStack];u.waterfall(a,this).catch(this.onError.bind(this))}var r=(_createClass(l,[{key:"insert",value:function(){var e=[];"embed"===this.type?(e.push(this.insertRMPCss),e.push(this.insertRMPScript)):"frame"===this.type?("rmp"===this.player?(e.push(this.insertRMPCss),e.push(this.insertRMPScript)):(e.push(this.onPlayerCssLoaded),e.push(this.insertOMPScript)),e.push(this.insertOBFCss)):e.push(this.insertOBPCss),e.push(this.loadWatch),u.waterfall(e,this).catch(this.onError.bind(this))}},{key:"insertRMPCss",value:function(){var e=document.createElement("link");e.href=this.config.src.rmpCss,e.id="rmp-dress-code",e.rel="stylesheet",e.type="text/css",e.onload=this.onPlayerCssLoaded.bind(this),this.headTag.appendChild(e)}},{key:"insertRMPScript",value:function(){var e=document.createElement("script");e.src=this.config.src.rmp,e.crossorigin="anonymous",e.onload=this.onPlayerScriptLoaded.bind(this),this.headTag.appendChild(e)}},{key:"insertOMPCss",value:function(){var e=document.createElement("link");e.href=this.config.src.ompCss,e.rel="stylesheet",e.type="text/css",e.onload=this.onPlayerCssLoaded.bind(this),this.headTag.appendChild(e)}},{key:"insertOMPScript",value:function(){var e=document.createElement("script");e.src=this.config.src.omp,e.crossorigin="anonymous",e.onload=this.onPlayerScriptLoaded.bind(this),this.headTag.appendChild(e)}},{key:"insertOBFCss",value:function(){var e=document.createElement("link");e.href=this.config.src.obfCss,e.rel="stylesheet",e.type="text/css",e.onload=this.onOBFCssLoaded.bind(this),this.headTag.appendChild(e)}},{key:"insertOBPCss",value:function(){var e=document.createElement("link");e.href=this.config.src.obpCss,e.rel="stylesheet",e.type="text/css",e.onload=this.onOBPCssLoaded.bind(this),this.headTag.appendChild(e)}},{key:"onPlayerCssLoaded",value:function(){this.playerCssTagLoaded=!0}},{key:"onPlayerScriptLoaded",value:function(){this.playerTagLoaded=!0}},{key:"onOBFCssLoaded",value:function(){this.obfCssTagLoaded=!0}},{key:"onOBPCssLoaded",value:function(){this.obpCssTagLoaded=!0}},{key:"loadWatch",value:function(){var t=this,a=0;this.loadInterval=setInterval(function(){var e;a+=500,("frame"===t.type?t.obfCssTagLoaded&&t.playerCssTagLoaded&&t.playerTagLoaded:"embed"===t.type?t.playerCssTagLoaded&&t.playerTagLoaded:t.obpCssTagLoaded)?(t.loadInterval&&clearInterval(t.loadInterval),"function"==typeof t.successCallback&&t.successCallback()):a>t.loadWatchTimer&&(t.loadInterval&&clearInterval(t.loadInterval),e=new Error,t.playerCssTagLoaded?t.playerTagLoaded?t.obpCssTagLoaded?e.message="Cannot load obf css file":e.message="Cannot load obp script file":e.message="Cannot load player script file":e.message="Cannot load player css file",t.onError(e))},500)}},{key:"onError",value:function(e){"function"==typeof this.errorCallback&&this.errorCallback(e)}}]),l);function l(e,t,a,i,s){_classCallCheck(this,l),this.config=e,this.type=t,this.player=a,this.successCallback=i,this.errorCallback=s,this.loadInterval=0,this.loadWatchTimer=5e3,this.playerCssTagLoaded=!1,this.playerTagLoaded=!1,this.obfCssTagLoaded=!1,this.obpCssTagLoaded=!1,this.headTag=document.getElementsByTagName("head")[0],this.headTag?this.insert():this.onError(new Error("Cannot find head element. Aborting"))}var a=(_createClass(o,[{key:"setCallbackInstance",value:function(e){this.callBackName=e+window.ServiceCallbackInstance,window[this.callBackName]=this.onServiceCall.bind(this)}},{key:"gjsonp",value:function(){return{get:function(e,t,a){var i=a.onSuccess,s=a.onTimeout,a=a.timeout,n=window.setTimeout(function(){window[t]=function(){},s()},1e3*a);window[t]=function(e){window.clearTimeout(n),i(e)};a=document.createElement("script");document.getElementsByTagName("head")[0].appendChild(a),a.setAttribute("src",e+"&callback="+t)}}}},{key:"getClickId",value:function(a){var i=this;return new Promise(function(t,e){i.gjsonp().get(a,"setObClickId",{onSuccess:function(e){t(e)},onTimeout:function(){e(new Error("Timeout"))},timeout:5})})}},{key:"onServiceCall",value:function(){}},{key:"getCtwData",value:function(s){var n=this;return new Promise(function(e,t){try{var a=[n.url,"getCtwData","?format=json","&adId=",s.adId,"&pubId=",s.publisherId,"&ids=",JSON.stringify(s.internalIds)].join(""),i=new XMLHttpRequest;i.open("GET",a),i.onload=function(){200===i.status?e(JSON.parse(i.responseText)):t("Request failed.  Returned status of "+i.status)},i.ontimeout=function(){t("Timeout - No response from server")},i.timeout=1e4,i.send()}catch(e){t(e)}})}}]),o);function o(e,t){_classCallCheck(this,o),window.ServiceCallbackInstance=void 0!==window.ServiceCallbackInstance?window.ServiceCallbackInstance+1:0,this.url=e.config.src.serviceCalls,this.setCallbackInstance(t)}var d=(_createClass(c,[{key:"listen",value:function(){var e=u.getElement("mp",this.parent.elements).elm;e.addEventListener("ready",this.onReady.bind(this)),e.addEventListener("playerReady",this.onPlayerReady.bind(this)),e.addEventListener("playererror",this.onPlayerError.bind(this)),e.addEventListener("adblockerdetected",this.onAdBlocker.bind(this)),e.addEventListener("admetadata",this.onMetadata.bind(this)),e.addEventListener("enterfullscreen",this.onFullScreen.bind(this)),e.addEventListener("exitfullscreen",this.onWindowScreen.bind(this)),e.addEventListener("aderror",this.onError.bind(this)),e.addEventListener("adstarted",this.onStart.bind(this)),e.addEventListener("adfirstquartile",this.onFirstQuartile.bind(this)),e.addEventListener("admidpoint",this.onSecondQuartile.bind(this)),e.addEventListener("adthirdquartile",this.onThirdQuartile.bind(this)),e.addEventListener("adcomplete",this.onComplete.bind(this)),e.addEventListener("adskipped",this.onSkip.bind(this)),e.addEventListener("aduserclose",this.onClose.bind(this)),e.addEventListener("adclick",this.onAdClick.bind(this)),e.addEventListener("iconClick",this.onIconClick.bind(this)),e.addEventListener("advolumechanged",this.onVolumeChange.bind(this)),e.addEventListener("adpaused",this.onPause.bind(this)),e.addEventListener("adresumed",this.onResume.bind(this)),e.addEventListener("destroycompleted",this.onDestroy.bind(this))}},{key:"audit",value:function(e,t){var a=void 0;try{var i=this.parent.player.getAdCurrentTime(),a=void 0!==i?Math.round(i/1e3):null}catch(e){a=null}t?t.videoProgress=a:t={videoProgress:a},this.parent.audit.send(e,t)}},{key:"playerFocus",value:function(){this.parentCall("playerFocus")}},{key:"insertTrafficFrame",value:function(){var e=this.parent.parent.recData,t=document.createElement("iframe");t.src=e.trafficUrl,t.style.display="none",t.height="1px",t.width="1px",document.getElementsByTagName("body")[0].appendChild(t)}},{key:"getClickId",value:function(){var t=this,e=this.parent.parent.recData.trafficUrl.replace("http://","https://")+"&noRedirect=true&ttid=3";this.clickIdInstance=new a(this.parent.parent.shared,"setObClickId"),this.audit("CPV_REACHED"),this.parentCall("onCpvReached"),this.cpvSent=!0,this.clickIdInstance.getClickId(e).then(function(e){t.clickId=e,t.onClickId()}).catch(function(e){t.audit("ERROR",{description:"Fail to get click id - "+e.message}),t.parentCall("onError",e)})}},{key:"parentCall",value:function(e){for(var t,a=arguments.length,i=Array(1<a?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];"function"==typeof this.parent[e]&&(t=this.parent)[e].apply(t,i)}},{key:"setConvEvent",value:function(){var e,t=this.parent.parent.recData;t.hasOwnProperty("convPixel")&&t.hasOwnProperty("convPerc")?(this.convPercent=parseInt(t.convPerc),this.convPixel=t.convPixel,(isNaN(this.convPercent)||this.convPercent<1)&&(e=new Error("Invalid conversion number: "+this.convPercent),this.audit("ERROR",{description:e.message}),this.parentCall("onError",e))):(t=new Error("Invalid conversion number: "+t.convPerc),this.audit("ERROR",{description:t.message}),this.parentCall("onError",t))}},{key:"onClickId",value:function(){this.parentCall("onUpdateClickIdParam"),this.parent.player.updateMacros({clickId:this.clickId})}},{key:"onPlayerReady",value:function(){this.parentCall("onPlayerReady")}},{key:"onReady",value:function(){this.setConvEvent(),this.parentCall("onReady")}},{key:"onAdBlocker",value:function(){this.parentCall("onAdBlocker")}},{key:"onMetadata",value:function(e){this.parentCall("onMetadata")}},{key:"onFullScreen",value:function(){this.audit("PLAYER_EXPANDED"),this.parentCall("onFullScreen")}},{key:"onWindowScreen",value:function(){this.audit("PLAYER_COLLAPSE"),this.parentCall("onWindowScreen")}},{key:"onError",value:function(){var e=this.parent.player.getAdErrorCode(),t=this.parent.player.getAdErrorMessage(),a=new Error;a.message=t,a.errno=e,this.audit("ERROR",{description:a.message}),this.parentCall("onError",a)}},{key:"onPlayerError",value:function(e){var t=e;e instanceof CustomEvent&&(t=e.detail),this.audit("ERROR",{description:t.message}),this.parentCall("onError",t)}},{key:"onStart",value:function(){try{this.audit("PLAY"),this.videoDuration=this.parent.player.getAdDuration()/1e3,this.intervalId=setInterval(this.onTick.bind(this),1e3),this.parentCall("onStart")}catch(e){this.audit("ERROR",{description:e.message}),this.parentCall("onError",e)}}},{key:"onTick",value:function(){var e=this.parent.parent.recData,t=this.parent.player.getAdCurrentTime();(!this.videoDuration||this.videoDuration<=0)&&(this.videoDuration=this.parent.player.getAdDuration()/1e3),this.cpvReached||this.autoplayEnabled||(1e3*parseInt(e.cpv)<=t||this.clickBeforeCpv)&&(this.cpvReached=!0,"prod"!==this.parent.parent.shared.config.env||this.parent.parent.shared.isTest||this.cpvSent||this.getClickId()),!this.convReached&&this.convPercent&&this.videoDuration&&0<this.videoDuration&&this.convPercent*(1e3*this.videoDuration)/100<=t&&(this.convReached=!0,"prod"!==this.parent.parent.shared.config.env||this.parent.parent.shared.isTest||((e=document.createElement("img")).src=this.convPixel+"&ob_click_id="+this.clickId,e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.width=0,e.style.height=0,document.getElementsByTagName("body")[0].appendChild(e)),this.audit("CONVERSION_REACHED"),this.parentCall("onConversionReached")),t-this.lastProgress>=this.progressTick&&(this.lastProgress=t,this.onProgress())}},{key:"onProgress",value:function(){this.parent.player.getAdPaused()||(this.audit("PROGRESS"),this.parentCall("onProgress"))}},{key:"onFirstQuartile",value:function(){this.audit("FIRST_QUARTILE"),this.parentCall("onFirstQuartile")}},{key:"onSecondQuartile",value:function(){this.audit("SECOND_QUARTILE"),this.parentCall("onSecondQuartile")}},{key:"onThirdQuartile",value:function(){this.audit("THIRD_QUARTILE"),this.parentCall("onThirdQuartile")}},{key:"onComplete",value:function(){this.stopInterval(),this.audit("COMPLETE"),this.parentCall("onComplete")}},{key:"onSkip",value:function(){this.stopInterval(),this.audit("SKIP"),this.parentCall("onSkip")}},{key:"onClose",value:function(e){this.stopInterval(),this.audit("CLOSE",{description:e?JSON.stringify({isTrusted:!1===e||e.isTrusted}):null}),this.parentCall("onClose")}},{key:"onAdClick",value:function(){this.clickBeforeCpv=!0,this.audit("CLICK",{description:"Click on video CTA"}),this.parentCall("onAdClick")}},{key:"onIconClick",value:function(){this.clickBeforeCpv=!0,this.audit("CLICK",{description:"Click on CTA"}),this.parentCall("onIconClick")}},{key:"onVolumeChange",value:function(){var e;this.parent.playing&&(e=this.parent.player.getVolume(),(e=this.parent.player.isMuted?this.parent.player.isMuted()?0:1:e)?this.playerMuted&&(this.playerMuted=!1,this.audit("UNMUTE")):(this.playerMuted=!0,this.audit("MUTE"))),this.parentCall("onVolumeChange")}},{key:"onPause",value:function(){this.audit("PAUSE"),this.parentCall("onPause")}},{key:"onResume",value:function(){this.playerFocus(),this.audit("RESUME"),this.parentCall("onResume")}},{key:"onDestroy",value:function(){this.parentCall("onDestroy")}},{key:"stopInterval",value:function(){this.intervalId&&clearInterval(this.intervalId)}}]),c);function c(e){_classCallCheck(this,c),this.parent=e,this.intervalId=0,this.videoDuration=0,this.playerMuted=!1,this.cpvReached=!1,this.cpvSent=!1,this.convPixel=null,this.convPercent=0,this.convReached=!1,this.lastProgress=0,this.progressTick=4800,this.clickId=null,this.clickBeforeCpv=!1,this.extraData=this.parent.parent.recData.adExtraData&&this.parent.parent.recData.adExtraData[this.parent.parent.recData.adId]?this.parent.parent.recData.adExtraData[this.parent.parent.recData.adId]:void 0,this.autoplayEnabled=this.extraData&&"true"===this.extraData.autoPlayEnabled,this.listen()}var h=(_createClass(m,[{key:"setInstanceAuditCallback",value:function(){window.obpAuditCallback=this.onAudit.bind(this)}},{key:"getParams",value:function(){var e=new Date,t=this.recData.player&&this.recData.player.length?this.recData.player:"Outbrain",a=this.parent.parent.shared.isIFrame||!1,i=this.parent.parent.shared.isQA||!1;try{var s=0,n=null,r=null,l=0;return this.parent.player.video&&(s=this.parent.player.getAdMediaHeight(),n=this.parent.player.getAdMediaUrl(),r=this.recData.origUrl,l=this.parent.player.getAdMediaWidth()),{eventType:"",prod:"prod"===this.config.env,sessionId:this.sessionId,sourceDocUrl:this.recData.pageUrl,sourcePvId:this.recData.pvId,sourceRequestId:this.recData.reqId,sourceWidgetId:this.recData.widgetID,videoClickUrl:"",videoDuration:this.videoDuration,videoHeight:s,videoId:this.recData.vidId,videoIsAutoPlay:this.recData.autoPlay,videoMediaUrl:n,videoPlayerId:t,videoPlayerVersion:this.playerVersion,videoPositionInWidget:this.recData.pos+"",videoVastUrl:r,videoViewablePixels:0,videoWidth:l,orientation:this.recData.orientation?this.recData.orientation.toUpperCase():null,screenResolution:[this.shared.window.width,"x",this.shared.window.height].join(""),abTestVal:this.recData.abTestVal||null,feedVersion:this.recData.feedVersion||null,videoProgress:-1,publisherId:this.recData.publisherId,sourceId:this.recData.sourceId,adId:this.recData.adId||null,docId:this.recData.did||null,adBlocker:this.parent.player.adBlocker,iframe:a,qa:i,playingType:"CLICK_TO_WATCH",playMode:"CLICK_TO_PLAY",localTime:e.toString(),timeSincePreviousEvent:null,timeSinceFirstEvent:null,gdpr:this.recData.gdpr,consentData:this.recData.cnsnt,obcnsnt:this.recData.obcnst,branded:!!this.recData.branded,trafficType:3,provider:"OUTBRAIN",featureFlag:"{}"!==JSON.stringify(this.shared.settingsFeatures)?this.stringifyJson(this.shared.settingsFeatures):null}}catch(e){return console.error(e),null}}},{key:"stringifyJson",value:function(e){try{return JSON.stringify(e)}catch(e){return""}}},{key:"gjsonp",value:function(e,t,a){"prod"!==this.config.env&&"staging"!==this.config.env||this.shared.isTest?console.log([a,":",e].join(" ")):(a=document.createElement("script"),document.getElementsByTagName("head")[0].appendChild(a),a.setAttribute("src",e+"&callback="+t))}},{key:"send",value:function(e,t){var a=this.checkDuplication(e,t),i=Date.now(),e=this.getParams();e&&""!==a.name&&(t=u.extend(e,a.params||{}),e=this.lastEventTime,t.eventType=a.name,this.firstEventTime||(this.firstEventTime=i),this.lastEventTime=i,t.timeSincePreviousEvent=e?i-e:0,t.timeSinceFirstEvent=i-this.firstEventTime,i=!this.recData.hasOwnProperty("cnsnt")||void 0===this.recData.cnsnt||this.recData.cnsnt,i=[this.auditUrl,"?json=",encodeURIComponent(JSON.stringify(t)),"&cnsnt=",i].join(""),this.gjsonp(i,"obpAuditCallback",a.name))}},{key:"onAudit",value:function(){}},{key:"checkDuplication",value:function(e,t){var a={name:e,params:t};switch(e){case"CLICK_TO_PLAY":0<this.parent.parent.shared.eventsCounter.click?this.parent.parent.shared.eventsCounter.click--:(this.parent.parent.shared.eventsCounter.duplicateFilter--,a.name="");break;case"PLAY":0<this.parent.parent.shared.eventsCounter.play?this.parent.parent.shared.eventsCounter.play--:(this.parent.parent.shared.eventsCounter.duplicateFilter--,a.name="");break;case"CLICK":0<this.parent.parent.shared.eventsCounter.redirection?this.parent.parent.shared.eventsCounter.redirection--:(this.parent.parent.shared.eventsCounter.duplicateFilter--,a.name="");break;case"ERROR":0<this.parent.parent.shared.eventsCounter.error?this.parent.parent.shared.eventsCounter.error--:(this.parent.parent.shared.eventsCounter.duplicateFilter--,a.name="")}return a}}]),m);function m(e){_classCallCheck(this,m),this.parent=e,this.playerVersion="6.60.0",this.firstEventTime=null,this.lastEventTime=null,this.shared=this.parent.parent.shared,this.recData=this.parent.parent.recData,this.config=this.shared.config,this.sessionId=this.parent.parent.sessionId,this.auditUrl=this.config.src.audits,this.adBlocker=!1,this.videoDuration=0,this.setInstanceAuditCallback(),console.log(this.playerVersion)}var p=(_createClass(y,[{key:"setElements",value:function(){var e=this.elements.body,t=u.getElement("content",this.elements),a=t.frameHeader,i=a.frameTitle,s=a.close,n=t.wrapper,r=n.playerContainer,l=n.thumbnailContainer,o=r.player,d=o.mp,c=o.title,h=o.logo,m=l.thumbnail;t.elm=document.getElementById(t.id),n.elm=document.getElementById(n.id),r.elm=document.getElementById(r.id),l.elm=document.getElementById(l.id),o.elm=document.getElementById(o.id),d.elm=document.getElementById(d.id),c.elm=document.getElementById(c.id),c.description.elm=c.elm.getElementsByTagName("div")[0],c.source.elm=c.elm.getElementsByTagName("div")[1],h.elm=document.getElementById(h.id),h.txt.elm=h.elm.getElementsByTagName("span")[0],h.img.elm=h.elm.getElementsByTagName("span")[1],m.elm=document.getElementById(m.id),a.elm=document.createElement("div"),a.elm.id="frame-header",a.elm.classList.add("obp-hidden");m=document.createElement("div");i.elm=document.createElement("div"),s.elm=document.createElement("div"),i.elm.id="frame-title",s.elm.id="close",s.elm.appendChild(document.createTextNode("")),m.appendChild(i.elm),m.appendChild(s.elm),a.elm.appendChild(m),t.elm.insertBefore(a.elm,t.wrapper.elm),this.extraData&&this.extraData.type&&this.extraData.type.includes("branded")&&!this.autoplayEnabled&&(this.parent.recData.branded=!0,this.branding.data=this.extraData),this.createBrandingElms(),e.elm.classList.add(this.parent.animation.theme),t.elm.classList.add(this.parent.widgetDirection),"omp"===this.parent.recData.mediaPlayer&&d.elm.classList.add(d.OMPClassName),t.elm.addEventListener("click",this.events.click,!1),t.elm.addEventListener("ready",this.events.ready,!1),s.elm.addEventListener("click",this.events.close)}},{key:"createBrandingElms",value:function(){var e=u.getElement("content",this.elements).wrapper.playerContainer,t=e.brandedElementsContainer,a=e.brandBg,i=e.brandCta,s=e.brandLogo,n=e.brandText;a.elm=document.createElement("div"),i.elm=document.createElement("div"),s.elm=document.createElement("div"),n.elm=document.createElement("div"),i.elm.classList.add(i.className),s.elm.classList.add(s.className),n.elm.classList.add(n.className),a.elm.id=a.id,i.elm.id=i.id,s.elm.id=s.id,n.elm.id=n.id,this.brandedPositions.brandCtaPosition=this.getBrandedElementPosition("brandCtaPosition"),this.brandedPositions.brandLogoPosition=this.getBrandedElementPosition("brandLogoPosition"),this.brandedPositions.brandTextPosition=this.getBrandedElementPosition("brandTextPosition"),t.elm=document.createElement("div"),t.elm.id=t.id;for(var r=0;r<3;r++){var l=t.brandedElementsRow;l.elm=document.createElement("div"),l.elm.classList.add(l.class),l.elm.id=l.id+(r+1);for(var o=0;o<3;o++){var d=l.brandedElementCell;d.elm=document.createElement("div");var c=3*r+(o+1);d.elm.id=d.id+c,d.elm.classList.add(d.class),[1,3,4,6,7,9].includes(c)&&d.elm.classList.add("branded-elements-dynamic-width"),[2,5,8].includes(c)&&d.elm.classList.add("branded-elements-player-width"),[4,5,6].includes(c)&&d.elm.classList.add("branded-elements-player-height"),this.brandedPositions.brandCtaPosition[0]===c&&d.elm.appendChild(i.elm),this.brandedPositions.brandLogoPosition[0]===c&&d.elm.appendChild(s.elm),this.brandedPositions.brandTextPosition[0]===c&&d.elm.appendChild(n.elm),l.elm.appendChild(d.elm)}t.elm.appendChild(l.elm)}e.elm.insertBefore(t.elm,e.player.elm),e.elm.insertBefore(a.elm,t.elm)}},{key:"getBrandedElementPosition",value:function(e){if(this.branding.data&&this.branding.data[e])switch(this.branding.data[e]){case"topLeft":return[1,1];case"edgeTopLeft":return[2,0];case"topCenter":return[2,1];case"edgeTopRight":return[2,2];case"topRight":return[3,1];case"middleLeftTop":return[4,3];case"middleLeft":return[4,1];case"middleLeftBottom":return[4,4];case"middleRightTop":return[6,3];case"middleRight":return[6,1];case"middleRightBottom":return[6,4];case"bottomLeft":return[7,1];case"edgeBottomLeft":return[8,0];case"bottomCenter":return[8,1];case"edgeBottomRight":return[8,2];case"bottomRight":return[9,1];default:return[0,0]}return[0,0]}},{key:"setPlayer",value:function(){var e=this.parent.recData,t=u.getElement("mp",this.elements);this.listeners=new d(this),this.player=new("omp"===e.mediaPlayer?OutbrainMP:RadiantMP)(t.id),this.player.init(this.getPlayerSettings())}},{key:"setThumbnail",value:function(){var e=this.parent.recData,t=u.getElement("thumbnail",this.elements);e.thumbnail&&(t.elm.style.backgroundImage="url("+e.thumbnail+")")}},{key:"setClose",value:function(){u.getElement("close",this.elements).elm.style.backgroundImage="url("+this.parent.shared.config.assets.closeButton+")"}},{key:"setKeyBoardListener",value:function(){window.addEventListener("keydown",this.events.key)}},{key:"setBranding",value:function(){var t=this;this.parent.recData.branded=this.extraData&&this.extraData.type&&this.extraData.type.includes("branded"),this.branding.data=this.extraData;var e=this,a=u.getElement("content",this.elements);a.elm=document.getElementById(a.id);var i,s,n,r,a=u.getElement("playerContainer",this.elements);this.branding.data&&(this.branding.data.brandBackgroundSource&&(i=a.brandBg,(s=new Image).onload=function(){e.branding.background.src=this.src,e.branding.background.width=this.width,e.branding.background.height=this.height,i.elm.style.backgroundImage="url("+this.src+")"},s.src=this.branding.data.brandBackgroundSource),this.branding.data.brandLogoSource&&((s=new Image).onload=function(){e.brandedLogoRatio=this.width/this.height},s.src=this.branding.data.brandLogoSource,n=u.getElement("brandLogo",this.elements),(s=document.createElement("img")).classList.add("brand-image"),s.src=this.branding.data.brandLogoSource,this.setBrandElementSizeAndPosition(n,this.branding.data.brandLogoSource,"brandLogoPosition"),n.elm.appendChild(s),this.branding.data.brandLogoTarget&&n.elm.addEventListener("click",function(e){e.preventDefault(),window.open(t.branding.data.brandLogoTarget,"_blank"),t.player.getAdPaused()||t.player.pause()})),this.branding.data.brandCtaSource&&((n=new Image).onload=function(){e.brandedCtaRatio=this.width/this.height},n.src=this.branding.data.brandCtaSource,r=u.getElement("brandCta",this.elements),(n=document.createElement("img")).classList.add("brand-image"),n.src=this.branding.data.brandCtaSource,this.setBrandElementSizeAndPosition(r,this.branding.data.brandCtaSource,"brandCtaPosition"),r.elm.appendChild(n),this.branding.data.brandCtaTarget&&r.elm.addEventListener("click",function(e){e.preventDefault();e=t.prepareMacrosUrl(t.branding.data.brandCtaTarget,t);t.listeners.clickBeforeCpv=!0,t.audit.send("CLICK",{description:"Click on branded CTA"}),window.open(e,"_blank"),t.player.getAdPaused()||t.player.pause()})),this.branding.data.brandText&&((r=a.brandText).elm.innerHTML=this.branding.data.brandText,this.setBrandElementSizeAndPosition(r,"brandTextPosition"),r.elm.classList.add(a.brandText.className)),this.branding.data.brandTextStyle&&((a=document.createElement("style")).innerHTML=""+this.branding.data.brandTextStyle,document.getElementsByTagName("head")[0].appendChild(a)))}},{key:"setBrandElementSizeAndPosition",value:function(e,t,a){a=this.getBrandedElementPosition(a);switch(a[0]){case 4:case 6:e.elm.classList.add("brand-image-width");break;default:e.elm.classList.add("brand-image-height")}switch(a[1]){case 0:e.elm.classList.add("brand-image-left");break;case 2:e.elm.classList.add("brand-image-right");break;case 3:e.elm.classList.add("brand-image-top");break;case 4:e.elm.classList.add("brand-image-bottom")}}},{key:"prepareMacrosUrl",value:function(e,t){return e.replace("{ivc_ad_id}",this.validateMacros(t.parent.recData.adId)).replace("{ivc_widget_name}",this.validateMacros(t.parent.recData.widgetID)).replace("{ivc_widget_id}",this.validateMacros(t.parent.recData.widgetNumberId)).replace("{ivc_ad_title}",this.validateMacros(t.parent.recData.title)).replace("{ivc_source_id}",this.validateMacros(t.parent.recData.sourceId)).replace("{ivc_req_id}",this.validateMacros(t.parent.recData.reqId)).replace("{ivc_campaign_id}",this.validateMacros(t.parent.recData.campaignId)).replace("{ivc_publisher_id}",this.validateMacros(t.parent.recData.publisherId)).replace("{ivc_publisher_name}",this.validateMacros(t.parent.recData.publisherName)).replace("{ivc_adv_name}",this.validateMacros(t.parent.recData.sourceName)).replace("{ivc_time_stamp}",this.validateMacros(t.parent.recData.timestamp)).replace("{ivc_doc_id}",this.validateMacros(t.parent.recData.did)).replace("{ivc_ext_ad_id}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.adId):"").replace("{ivc_ext_source_id}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.sourceId):"").replace("{ivc_ext_campaign_id}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.campaignId):"").replace("{ivc_ext_publisher_id}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.publisherId):"").replace("{ivc_ext_doc_id}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.did):"").replace("{{ad_id}}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.adId):"").replace("{{widget_name}}",this.validateMacros(t.parent.recData.widgetID)).replace("{{widget_id}}",this.validateMacros(t.parent.recData.widgetNumberId)).replace("{{ad_title}}",this.validateMacros(t.parent.recData.title)).replace("{{section_id}}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.sourceId):"").replace("{{req_id}}",this.validateMacros(t.parent.recData.reqId)).replace("{{campaign_id}}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.campaignId):"").replace("{{publisher_id}}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.publisherId):"").replace("{{publisher_name}}",this.validateMacros(t.parent.recData.publisherName)).replace("{{adv_name}}",this.validateMacros(t.parent.recData.sourceName)).replace("{{time_stamp}}",this.validateMacros(t.parent.recData.timestamp)).replace("{{doc_id}}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.did):"").replace("{ivc_ob_click_id}",this.validateMacros(t.parent.recData.obClickId)).replace("{{ob_click_id}}",this.validateMacros(t.parent.recData.obClickId)).replace("{{time_stamp}}",Date.now().toString())}},{key:"validateMacros",value:function(e){return e||""}},{key:"getPlayerSettings",value:function(){var e=void 0,t=this.parent.recData;return"rmp"===this.parent.recData.mediaPlayer?(e={licenseKey:"dml1bGR3ZGh2Y0AxNTAyMTk4",delayToFade:3e3,autoplay:!1,muted:!0,hideControls:!0,adVpaidControls:!0,hideCentralPlayButton:!1,ads:!0,adTagUrl:t.origUrl,adOutStream:!0,iframeMode:!0,preload:"metadata",skinBackgroundColor:"#000000",adBlockerDetection:!0,adShowRemainingTime:!0,adCountDown:!0,labels:{ads:{controlBarCustomMessage:" "}},poster:t.thumbnail||"",endOfVideoPoster:t.thumbnail||""},12<=this.parent.shared.ie&&(e.adVpaidMode="enabled")):e={adBlockerDetection:!0,adTagUrl:t.origUrl,mobile:!1,vastXML:window.vast,showClose:!1,vastParser:this.parent.shared.config.src.vastParser,vpaidBridge:this.parent.shared.config.src.vpaidBridge,twoStepsLoad:!0,muted:t.focusVideoSoundOff||this.autoplayEnabled,customControls:t.customControls,adData:t},e}},{key:"removePostCta",value:function(){var e=u.getElement("playerContainer",this.elements),t=e.player,a=t.mp;try{t.elm.removeChild(e.postCta.elm)}catch(e){}a.elm.classList.remove("post-cta-opacity"),a.elm.classList.remove("border"),this.branding&&this.branding.data&&this.branding.data.brandCtaSource&&(e.brandCta.elm.style.display="block"),this.postCtaVisible=!1}},{key:"setPostCta",value:function(){var t=this;if(this.extraData&&"true"!==!this.extraData.postCtaEnabled){var e=this,a=u.getElement("playerContainer",this.elements),i=a.player,s=a.companionAdsContainer,n=i.mp,r=a.postCta,l=this.extraData.postCtaForm&&1<this.extraData.postCtaForm.length?"iframe":"div";r.elm=document.createElement(l),r.elm.id=r.id,i.elm.appendChild(r.elm),this.postCtaVisible=!0,this.extraData.postCtaClickUrl&&(r.elm.style.cursor="pointer"),n.elm.classList.add("post-cta-opacity"),this.isCompanionAds&&(s.elm.style.width=s.elm.clientWidth+6+"px");var o,s=this.extraData.postCtaImgUrl&&1<this.extraData.postCtaImgUrl.length;if("false"===this.extraData.showLastFrame?(n.elm.style.visibility="hidden",s||(r.elm.style.background="rgba(0,0,0,1)")):s||(r.elm.style.background="rgba(0,0,0,0.35)"),this.branding&&this.branding.data&&this.branding.data.brandCtaSource&&(a.brandCta.elm.style.display="none"),this.extraData&&this.extraData.postCtaEnabled&&this.extraData.postCtaForm&&this.extraData.postCtaFormWidth&&this.extraData.postCtaFormHeight?(r.elm.src=this.extraData.postCtaForm,r.elm.classList.add("post-cta-form"),r.elm.style.width=this.extraData.postCtaFormWidth+"px",r.elm.style.height=this.extraData.postCtaFormHeight+"px",r.elm.style.transform="scaleX("+i.elm.clientWidth/r.elm.clientWidth+") scaleY("+i.elm.clientHeight/r.elm.clientHeight+")",r.elm.addEventListener("mouseover",function(){t.pausePostCtaCountdown=!0})):s?((o=new Image).onload=function(){e.post.image.src=this.src,e.post.image.width=this.width,e.post.image.height=this.height,r.elm.style.backgroundImage="url("+this.src+")",e.setPostCtaElementLocation()},o.src=this.extraData.postCtaImgUrl):(o=this.extraData.ctaType.split("_").join(" "),r.elm.innerHTML=this.extraData.postCtaText||o,r.elm.style.verticalAlign="middle",r.elm.style.color="white",r.elm.style.fontWeight="900",r.elm.style.padding="25px 25px",this.setPostCtaElementLocation()),this.extraData.postCtaClickUrl&&r.elm.addEventListener("click",function(e){e.preventDefault();e=t.prepareMacrosUrl(t.extraData.postCtaClickUrl,t);t.audit.send("CLICK",{description:"End-card",type:t.extraData.ctaType}),window.open(e,"_blank")}),"true"===this.extraData.postCtaBorderEnabled&&(r.elm.style.border="3px solid white",n.elm.classList.add("border")),this.extraData.postCtaStyle&&(r.elm.style.cssText+=this.extraData.postCtaStyle),this.extraData.ctaPixels&&!this.parent.shared.isTest)try{for(var d=this.extraData.ctaPixels.split(","),c=0;c<d.length;c++)(new Image).src=d[c]}catch(e){}this.audit.send("CARD_VISIBLE",{description:"End-card",type:this.extraData.ctaType})}}},{key:"setPostCtaElementLocation",value:function(){var e=u.getElement("playerContainer",this.elements),t=e.player,a=t.mp,i=e.postCta,s=1,s=this.extraData&&this.extraData.postCtaImgUrl&&1<this.extraData.postCtaImgUrl.length?this.post.image.width/this.post.image.height:2,e=a.elm.offsetHeight/4;this.extraData.postCtaImgUrl&&1<this.extraData.postCtaImgUrl.length?(i.elm.style.width=e*s+"px",i.elm.style.height=e+"px",i.elm.style.lineHeight=e+"px"):i.elm.style.fontSize=a.elm.offsetWidth/40+"px";var a=t.elm.offsetHeight,t=t.elm.offsetWidth,n=.03*t+"px",r="calc("+(t-i.elm.offsetWidth)+"px - "+n+")",l=.03*t+"px",o="calc("+(a-i.elm.offsetHeight)+"px - "+l+" - 40px)",d="translateY(-50%)",c="translateX(-50%)";switch(this.extraData.postCtaPosition){case"middleLeft":i.elm.style.transform=d,i.elm.style.left=n;break;case"middleRight":i.elm.style.transform=d,i.elm.style.left=r;break;case"topLeft":i.elm.style.transform="",i.elm.style.top=l,i.elm.style.left=n;break;case"topCenter":i.elm.style.top=l,i.elm.style.transform=c;break;case"topRight":i.elm.style.transform="",i.elm.style.top=l,i.elm.style.left=r;break;case"bottomLeft":i.elm.style.transform="",i.elm.style.top=o,i.elm.style.left=n;break;case"bottomCenter":i.elm.style.transform="",i.elm.style.top=o,i.elm.style.transform=c;break;case"bottomRight":i.elm.style.transform="",i.elm.style.top=o,i.elm.style.left=r;break;case"center":this.extraData.postCtaImgUrl&&1<this.extraData.postCtaImgUrl.length?i.elm.style.transform="translate(-50%, -50%)":this.autoplayEnabled?i.elm.style.transform="translate(-50%, -30%)":i.elm.style.transform="translate(-50%, 30%)",i.elm.style.top="",i.elm.style.left="";break;default:i.elm.style.transform="translate(-50%, -50%)",i.elm.style.top="",i.elm.style.left=""}}},{key:"setCompanionAds",value:function(){var e=this.player.getCompanionAds();if(e&&0!==e.length){this.isCompanionAds=!0;var t=u.getElement("playerContainer",this.elements),a=t.player,i=a.mp,s=a.logo,t=t.companionAdsContainer;t.elm=document.createElement("div"),t.elm.id=t.id,t.elm.classList.add(t.className),a.elm.appendChild(t.elm),i.elm.style.borderRadius="0px",s.elm.style.left="3%";for(var n=0;n<e.length;n++)this.setCompanionAd(e[n],n)}}},{key:"setCompanionAd",value:function(i,e){var s=this;if(i.staticResource&&i.title&&i.companionClickThroughURLTemplate){var t=u.getElement("playerContainer",this.elements).companionAdsContainer,a=t.companionAd;a.elm=document.createElement("div"),a.elm.id=a.id+e,a.elm.classList.add(a.className);var n=a.shoppableLink;n.elm=document.createElement("a"),n.elm.classList.add(n.className),n.elm.addEventListener("click",function(e){if(e.preventDefault(),i.companionClickTrackingURLTemplates&&0<i.companionClickTrackingURLTemplates.length)for(var t=0;t<i.companionClickTrackingURLTemplates.length;t++)try{var a=i.companionClickTrackingURLTemplates[t];(new Image).src=a}catch(e){}e=s.prepareMacrosUrl(i.companionClickThroughURLTemplate,s);s.audit.send("CLICK",{description:"clickOnShoppableAd:"+i.id}),window.open(e,"_blank"),s.player.getAdPaused()||s.player.pause()});var r,l,o=n.shoppableImgContainer;o.elm=document.createElement("div"),o.elm.id=o.id+e,o.elm.classList.add(o.className),o.elm.style.backgroundImage='url("'+i.staticResource+'")',n.elm.appendChild(o.elm),i.altText&&1<i.altText.length&&((r=o.alpha).elm=document.createElement("div"),r.elm.id=r.id+e,r.elm.classList.add(r.className),o.elm.appendChild(r.elm),(l=o.altText).elm=document.createElement("div"),l.elm.id=l.id+e,l.elm.classList.add(l.className),o.elm.appendChild(l.elm),l.elm.innerHTML=i.altText,o.elm.addEventListener("mouseover",function(){document.getElementById(l.id+e).classList.add("hover"),document.getElementById(r.id+e).classList.add("hover")}),o.elm.addEventListener("mouseout",function(){document.getElementById(l.id+e).classList.remove("hover"),document.getElementById(r.id+e).classList.remove("hover")}));o=n.shoppableTitle;if(o.elm=document.createElement("span"),o.elm.classList.add(o.className),o.elm.innerHTML=i.title,n.elm.appendChild(o.elm),i.price&&((o=n.shoppablePrice).elm=document.createElement("span"),o.elm.classList.add(o.className),o.elm.innerHTML=i.price,n.elm.appendChild(o.elm)),a.elm.appendChild(n.elm),t.elm.appendChild(a.elm),i.trackingEvents&&i.trackingEvents.start&&0<i.trackingEvents.start.length)for(var d=0;d<i.trackingEvents.start.length;d++)this.companionAdsImpressionTracking.push(i.trackingEvents.start[d])}}},{key:"onClick",value:function(e){if(e.preventDefault(),e.stopPropagation(),(e.isTrusted||this.parent.shared.isQA)&&(this.autoplayEnabled?(this.autoPlayClicked=!0,this.listeners.getClickId()):this.playing||(this.audit.send("CLICK_TO_PLAY"),this.parent.frameListener.sendToParent("click"),this.player.play()),0<this.companionAdsImpressionTracking.length))for(var t=0;t<this.companionAdsImpressionTracking.length;t++)try{var a=this.companionAdsImpressionTracking[t];(new Image).src=a}catch(e){}}},{key:"onAnimationReady",value:function(e){var t=this,a=u.getElement("thumbnailContainer",this.elements),i=u.getElement("playerContainer",this.elements).player,s=a.thumbnail;s.elm.style.maxHeight=e.maxHeight+"px",s.elm.style.maxWidth=e.maxWidth+"px",i.elm.style.maxHeight=e.maxHeight+"px",i.elm.style.maxWidth=e.maxWidth+"px",setTimeout(function(){t.setBrandedElementSize(e)},50),setTimeout(function(){t.setBrandedElementSize(e)},300),this.parent.animation.active&&a.elm.classList.remove(this.elements.style.transparentClassName),this.parent.frameListener.sendToParent("ready")}},{key:"setBrandedElementSize",value:function(e){var t=u.getElement("playerContainer",this.elements),a=t.player,i=t.companionAdsContainer,s=a.elm.style.maxHeight,n=a.elm.style.maxWidth;this.isCompanionAds&&(s=e.maxHeight+.3*e.maxHeight+"px",a.elm.style.margin=(this.parent.shared.window.height-(e.maxHeight+.3*e.maxHeight))/2+"px auto",i.elm.style.width=a.elm.clientWidth+"px");for(var r=document.getElementsByClassName("branded-elements-player-width"),l=0;l<r.length;l++)r[l].style.width=n;document.getElementById("branded-row-2").style.minHeight=s,0<this.brandedCtaRatio&&(s=t.brandCta,4===this.brandedPositions.brandCtaPosition[0]||6===this.brandedPositions.brandCtaPosition[0]?s.elm.style.height=s.elm.clientWidth/this.brandedCtaRatio+"px":s.elm.style.width=s.elm.clientHeight*this.brandedCtaRatio+"px"),0<this.brandedLogoRatio&&(t=t.brandLogo,4===this.brandedPositions.brandLogoPosition[0]||6===this.brandedPositions.brandLogoPosition[0]?t.elm.style.height=t.elm.clientWidth/this.brandedLogoRatio+"px":t.elm.style.width=t.elm.clientHeight*this.brandedLogoRatio+"px")}},{key:"onCloseClick",value:function(e){var t,a,i,s,n,r,l,o,d,c=this;e&&(e.preventDefault(),e.stopPropagation(),this.autoPlayDone=!0),this.playing&&(this.player.stopAds(),this.player.setVideoMute(!0),this.player.setControls(!1),t=this.parent.animation.active?this.parent.animation.speed:1e3,a=this.elements.body,i=u.getElement("thumbnailContainer",this.elements),s=u.getElement("playerContainer",this.elements),n=u.getElement("frameHeader",this.elements),r=s.player.logo,l=s.player.title,o=s.player,d=s.companionAdsContainer,s.postCta.elm&&this.removePostCta(),d.elm&&o.elm.removeChild(d.elm),a.elm.classList.remove(a.opaqueClassName),i.elm.classList.remove(this.elements.style.hideClassName),this.parent.animation.active&&i.elm.classList.remove(this.elements.style.transparentClassName),s.elm.classList.add(this.elements.style.transparentClassName),n.elm.classList.add(this.elements.style.hideClassName),r.elm.classList.add(this.elements.style.transparentClassName),l.elm.classList.add(this.elements.style.transparentClassName),this.listeners.onClose(e),setTimeout(function(){c.parent.frameListener.sendToParent("close")},t))}},{key:"onKeyPress",value:function(e){e=e||window.event;27===e.keyCode&&this.onCloseClick(),32===e.keyCode&&(this.player.getAdPaused()?this.player.resume():this.player.pause())}},{key:"OnRecInView",value:function(){this.parent.shared.featureFlags.loadBrandedOnRecView}},{key:"onAnimationStart",value:function(e){var t=u.getElement("thumbnailContainer",this.elements),a=u.getElement("playerContainer",this.elements),i=a.player.title,s=a.player.logo;"open"===e.mode?(this.playing=!0,t.elm.classList.add(t.readyClassName),a.elm.classList.add(a.readyClassName),s.txt.elm.appendChild(document.createTextNode(s.txt.value)),s.txt.elm.style.wordSpacing="0.3vh",s.img.elm.style.backgroundImage="url("+this.parent.shared.config.assets.logo+")"):(i.description.elm.innerHTML="",i.source.elm.innerHTML="",s.txt.elm.innerHTML="")}},{key:"onAnimationEnd",value:function(e){var t=this,a=this.elements.body,i=this.elements.style,s=u.getElement("content",this.elements),n=u.getElement("thumbnailContainer",this.elements),r=u.getElement("playerContainer",this.elements),l=this.elements.body.content.frameHeader,o=r.player.logo,d=r.player.title;"open"===e.mode?(d.description.elm.innerHTML="",d.source.elm.innerHTML="",setTimeout(function(){d.description.elm.appendChild(document.createTextNode(u.truncateFromElement(t.parent.recData.title,d.description.elm))),d.source.elm.appendChild(document.createTextNode(u.truncateFromElement(t.parent.recData.sourceName,d.source.elm)))},500),a.elm.classList.add(a.opaqueClassName),n.elm.classList.add(i.transparentClassName),r.elm.classList.remove(i.transparentClassName),l.elm.classList.remove(i.hideClassName),o.elm.classList.remove(i.transparentClassName),d.elm.classList.remove(i.transparentClassName),s.elm.style.cursor="default",this.branding.data&&(r.brandLogo.elm&&r.brandLogo.elm.classList.remove(i.hideClassName),r.brandCta.elm&&r.brandCta.elm.classList.remove(i.hideClassName)),this.player.resize(),this.parent.recData.focusVideoSoundOff||this.autoplayEnabled?this.player.setVideoMute(!0):this.player.setVideoMute(!1),setTimeout(function(){n.elm.classList.add(i.hideClassName)},this.parent.animation.speed)):(this.playing=!1,this.player.destroy(),n.elm.classList.remove(n.readyClassName),r.elm.classList.remove(r.readyClassName),n.elm.classList.add(i.transparentClassName),s.elm.style.cursor="pointer",this.parent.recData.allow_branded_video&&(r.brandLogo.elm&&r.brandLogo.elm.classList.add(i.hideClassName),r.brandCta.elm&&r.brandCta.elm.classList.add(i.hideClassName)))}},{key:"onEsc",value:function(){this.playing&&this.onCloseClick()}},{key:"onResize",value:function(e){var t,a,i;this.playing&&(i=u.getElement("thumbnailContainer",this.elements),t=u.getElement("title",this.elements),a=u.getElement("playerContainer",this.elements).player,(i=i.thumbnail).elm.style.maxHeight=e.maxHeight+"px",i.elm.style.maxWidth=e.maxWidth+"px",a.elm.style.maxHeight=e.maxHeight+"px",a.elm.style.maxWidth=e.maxWidth+"px",t.description.elm.innerHTML="",t.source.elm.innerHTML="",t.description.elm.appendChild(document.createTextNode(u.truncateFromElement(this.parent.recData.title,t.description.elm))),t.source.elm.appendChild(document.createTextNode(u.truncateFromElement(this.parent.recData.sourceName,t.source.elm))),this.setBrandedElementSize(e),this.postCtaVisible&&this.setPostCtaElementLocation(),this.player.resize())}},{key:"onAutoPlayReady",value:function(){var e,t=this;this.autoplayEnabled&&!this.autoPlayDone&&this.ready&&!this.playing&&(void 0===this.extraData.autoPlayReplays&&(this.extraData.autoPlayReplays=1),0===this.extraData.autoPlayReplays&&(this.extraData.autoPlayReplays=-1),0!==this.extraData.autoPlayReplays?(this.parent.frameListener.sendToParent("autoPlay"),this.player.play(),this.autoPlayDone=1===this.extraData.autoPlayReplays,this.extraData.autoPlayReplays--,"true"!==this.extraData.autoPlayHideControls||(e=document.getElementById("omp-footer"))&&e.style&&(e.style.visibility="hidden"),this.extraData.autoPlayDuration&&setTimeout(function(){t.autoPlayClicked||t.onCloseClick(!1)},1e3*this.extraData.autoPlayDuration)):this.autoPlayDone=!0)}},{key:"onPlayerReady",value:function(){this.ready=!0,this.parent.playerReady=!0,this.parent.frameListener.sendToParent("playerLoaded",{duration:this.player.getDuration(),mediaHeight:this.player.getVastHeight(),mediaWidth:this.player.getVastWidth()}),this.setCompanionAds()}},{key:"onReady",value:function(){this.ready=!0,this.parent.frameListener.sendToParent("load",{duration:this.player.getDuration(),mediaHeight:this.player.getVastHeight(),mediaWidth:this.player.getVastWidth()});var e=this.player.getAdMedias(),t=this.player.getAdUnit();if(e.length&&/innovid/.test(e[0].fileURL)){e={ivc_ad_id:this.parent.recData.adId,ivc_ad_title:this.parent.recData.title,ivc_source_id:this.parent.recData.sourceId,ivc_req_id:this.parent.recData.reqId,ivc_campaign_id:this.parent.recData.campaignId,ivc_publisher_id:this.parent.recData.publisherId,ivc_publisher_name:this.parent.recData.publisherName,ivc_adv_name:this.parent.recData.sourceName,ivc_time_stamp:this.parent.recData.timestamp,ivc_doc_id:this.parent.recData.did,ivc_widget_id:this.parent.recData.widgetNumberId,ivc_widget_name:this.parent.recData.widgetID,ivc_ext_ad_id:this.parent.recData.externalIds?this.parent.recData.externalIds.adId:"",ivc_ext_source_id:this.parent.recData.externalIds?this.parent.recData.externalIds.sourceId:"",ivc_ext_campaign_id:this.parent.recData.externalIds?this.parent.recData.externalIds.campaignId:"",ivc_ext_publisher_id:this.parent.recData.externalIds?this.parent.recData.externalIds.publisherId:"",ivc_ext_doc_id:this.parent.recData.externalIds?this.parent.recData.externalIds.did:""};try{t._creative.updateExternalMacros(e)}catch(e){console.log("OB DEBUG: try calling updateExternalMacros")}}}},{key:"onUpdateClickIdParam",value:function(){this.parent.recData.obClickId=this.listeners.clickId}},{key:"onUpdateInnovidDynamicParams",value:function(){var t=this.player.getAdMedias(),e=this.player.getAdUnit();if(t.length&&/innovid/.test(t[0].fileURL)){t={ivc_ob_click_id:this.listeners.clickId};try{e._creative.updateExternalMacros(t)}catch(e){console.log("OB DEBUG: try calling updateExternalMacros"),console.log(t)}}}},{key:"onAdBlocker",value:function(){this.audit.adBlocker=!0}},{key:"onMetadata",value:function(){}},{key:"onFullScreen",value:function(){}},{key:"onWindowScreen",value:function(){}},{key:"onStart",value:function(){this.audit.videoDuration=this.player.getAdDuration()}},{key:"onFirstQuartile",value:function(){}},{key:"onSecondQuartile",value:function(){}},{key:"onThirdQuartile",value:function(){}},{key:"onComplete",value:function(){var e,t=this;this.parent.shared.featureFlags.allowPostCta&&this.extraData&&"true"===this.extraData.postCtaEnabled?(this.setPostCta(),e=this.extraData.postCtaDuration||0,setTimeout(function(){t.pausePostCtaCountdown||(t.removePostCta(),t.onCloseClick(!1))},1e3*e)):this.onCloseClick(!1)}},{key:"onSkip",value:function(){}},{key:"onClose",value:function(){}},{key:"onAdClick",value:function(){}},{key:"onVolumeChange",value:function(){}},{key:"onPause",value:function(){this.autoplayEnabled&&(this.autoPlayClicked=!0)}},{key:"onResume",value:function(){this.autoplayEnabled&&(this.autoPlayClicked=!1)}},{key:"onDestroy",value:function(){var e=u.getElement("mp",this.elements),t=document.createElement("div");t.id=e.id,"omp"===this.parent.recData.mediaPlayer&&t.classList.add(e.OMPClassName),this.ready=!1,e.elm.parentNode.replaceChild(t,e.elm),e.elm=t,this.setPlayer()}},{key:"onError",value:function(e){this.parent.onError(e)}},{key:"checkExtraData",value:function(){return"preview"===this.parent.shared.config.env&&this.parent.recData.fakeExtraData?this.parent.recData.fakeExtraData:"preview"===this.parent.shared.config.env&&this.parent.recData.adExtraData&&this.parent.recData.adExtraData[Object.keys(this.parent.recData.adExtraData)[0]]?this.parent.recData.adExtraData[Object.keys(this.parent.recData.adExtraData)[0]]:this.parent.recData.adExtraData&&this.parent.recData.adExtraData[this.parent.recData.adId]?this.parent.recData.adExtraData[this.parent.recData.adId]:void 0}},{key:"playing",set:function(e){this._playing=e,this.parent.frameListener.sendToParent("isPlaying",{playing:e})},get:function(){return this._playing}}]),y);function y(e){_classCallCheck(this,y),this.parent=e,this.audit=new h(this),this.listeners=null,this.ready=!1,this.player=null,this._playing=!1,this.brand="",this.pausePostCtaCountdown=!1,this.branding={data:null,background:{src:null,width:0,height:0},logo:{src:null,width:0,height:0,originalSize:void 0},cta:{src:null,width:0,height:0,originalSize:void 0},text:{width:0,height:0},firstResize:!0},this.post={data:null,image:{src:null,width:0,height:0}},this.extraData=this.checkExtraData(),this.autoplayEnabled=this.extraData&&"true"===this.extraData.autoPlayEnabled,this.autoPlayDone=null,this.autoPlayClicked=!1,this.postCtaVisible=!1,this.brandedCtaRatio=0,this.brandedLogoRatio=0,this.brandedPositions={},this.isCompanionAds=!1,this.companionAdsImpressionTracking=[],this.elements={body:{elm:document.getElementsByTagName("body")[0],opaqueClassName:"opaque",brandingClassName:"branding",content:{elm:null,id:"content",frameHeader:{elm:null,id:"frame-header",activeClassName:"active",frameTitle:{elm:null,id:"frame-title"},close:{elm:null,id:"close"}},wrapper:{elm:null,id:"wrapper",playerContainer:{elm:null,id:"player-container",className:"container",readyClassName:"ready",player:{elm:null,id:"player",title:{elm:null,id:"title",description:{elm:null},source:{elm:null}},mp:{elm:null,id:"mp",OMPClassName:"omp"},logo:{elm:null,id:"logo",txt:{elm:null,value:"Recommended by"},img:{elm:null}}},postCta:{elm:null,id:"post-cta"},brandedElementsContainer:{elm:null,id:"branded-elements-container",brandedElementsRow:{elm:null,id:"branded-row-",class:"branded-elements-row",brandedElementCell:{elm:null,id:"branded-position-",class:"branded-elements-cell"}}},brandBg:{elm:null,id:"brand-bg"},brandLogo:{elm:null,id:"brand-logo",className:"brand"},brandCta:{elm:null,id:"brand-cta",className:"brand"},brandText:{elm:null,id:"brand-text",className:"brand"},companionAdsContainer:{elm:null,id:"shoppable-container",className:"shoppable",companionAd:{elm:null,id:"shoppable-ad-",className:"shoppable-ad",shoppableLink:{elm:null,className:"shoppable-ad-link",shoppableImgContainer:{elm:null,id:"shoppable-img-container-",className:"shoppable-ad-img-container",altText:{elm:null,id:"shoppable-alt-text-",className:"shoppable-ad-alt-text"},alpha:{elm:null,id:"shoppable-text-alpha-",className:"shoppable-alpha"}},shoppableTitle:{elm:null,className:"shoppable-ad-title"},shoppablePrice:{elm:null,className:"shoppable-ad-price"}}}}},thumbnailContainer:{elm:null,id:"thumbnail-container",className:"container",readyClassName:"ready",thumbnail:{elm:null,id:"thumbnail"}}}}},style:{hideClassName:"obp-hidden",transparentClassName:"obp-trans"}},this.events={click:this.onClick.bind(this),close:this.onCloseClick.bind(this),key:this.onKeyPress.bind(this)},u.waterfall([this.setElements,this.setPlayer,this.setThumbnail,this.setClose,this.setKeyBoardListener,this.setBranding],this).catch(this.onError.bind(this))}var g=(_createClass(v,[{key:"setElements",value:function(){var e=this.elements.body,t=u.getElement("content",this.elements),a=t.top,i=a.header,s=i.title,n=i.close,r=t.wrapper,l=r.playerContainer,o=r.thumbnailContainer,d=t.bottom,c=d.footer,h=c.logoWrapper,m=l.player,p=m.mp;t.elm=document.getElementById(t.id),a.elm=document.getElementById(a.id),i.elm=document.getElementById(i.id),a.topContent.elm=document.getElementById(a.topContent.id),s.elm=document.getElementById(s.id),s.description.elm=document.getElementById(s.description.id),s.source.elm=document.getElementById(s.source.id),n.elm=document.getElementById(n.id),r.elm=document.getElementById(r.id),l.elm=document.getElementById(l.id),l.player.elm=document.getElementById(l.player.id),l.player.mp.elm=document.getElementById(l.player.mp.id),o.elm=document.getElementById(o.id),o.thumbnail.elm=document.getElementById(o.thumbnail.id),d.elm=document.getElementById(d.id),d.bottomContent.elm=document.getElementById(d.bottomContent.id),c.elm=document.getElementById(c.id),h.elm=document.getElementById(h.id),h.textLogo.elm=document.getElementById(h.textLogo.id),h.logo.elm=document.getElementById(h.logo.id),m.elm=document.getElementById(m.id),p.elm=document.getElementById(p.id),e.elm.classList.add(this.parent.animation.theme),t.elm.classList.add(this.parent.widgetDirection),"omp"===this.parent.recData.mediaPlayer&&l.player.mp.elm.classList.add(l.player.mp.OMPClassName),t.elm.addEventListener("click",this.events.click,!1),n.elm.addEventListener("click",this.events.close,!1),a.topContent.elm.addEventListener("click",this.events.controls,!1),d.bottomContent.elm.addEventListener("click",this.events.controls,!1),this.setPlayerSize()}},{key:"setPlayerSize",value:function(){var e=u.getElement("content",this.elements).wrapper.playerContainer;e.elm=document.getElementById(e.id),e.player.elm=document.getElementById(e.player.id);var t=void 0,a=void 0;a=this.player?(t=this.player.getVastWidth(),this.player.getVastHeight()):(r=(new window.DOMParser).parseFromString(window.vast,"text/xml"),t=parseInt(r.getElementsByTagName("MediaFile").item(0).getAttribute("width")),parseInt(r.getElementsByTagName("MediaFile").item(0).getAttribute("height")));var i=t/a,s=this.parent.shared.window,n=s.width*(this.maxScreenWidth/100),r=s.height*(this.maxScreenHeight/100),t=void 0,a=void 0;r<n?a=(t=n<(s=(a=r)*i)?n:s)/i:t=(a=r<(n=(t=n)/i)?r:n)*i,e.player.elm.style.maxWidth=t+"px",e.player.elm.style.maxHeight=a+"px",e.player.elm.style.position="relative",e.player.elm.style.margin="auto"}},{key:"setPlayer",value:function(){var e=this.parent.recData,t=u.getElement("mp",this.elements);this.listeners=new d(this),this.player="omp"===e.mediaPlayer?new OutbrainMP(t.id,!0):new RadiantMP(t.id),this.player.init(this.getPlayerSettings())}},{key:"setThumbnail",value:function(){var e=this.parent.recData,t=u.getElement("thumbnail",this.elements);e.thumbnail&&(t.elm.style.backgroundImage="url("+e.thumbnail+")")}},{key:"setClose",value:function(){var e=u.getElement("close",this.elements),t=this.parent.animation.assets.close;e.elm.style.backgroundImage="url("+t+")"}},{key:"setCloseBtnSize",value:function(){var e=u.getElement("close",this.elements),t=e.elm.offsetWidth;e.elm.style.backgroundSize=t<40?"40px":39<t&&t<60?"80px":59<t&&t<80?"60px":79<t&&t<100?"50px":"40px"}},{key:"toLandscape",value:function(){var e,t,a=u.getElement("playerContainer",this.elements);this.orientation="landscape",this.setPlayerSize(),this.setCloseBtnSize(),a&&a.postCta.elm&&this.setPostCtaElementLocation(),"omp"===this.parent.recData.mediaPlayer&&(e=u.getElement("mp",this.elements),t=u.getElement("header",this.player.video.elements),a=u.getElement("footer",this.player.video.elements),e.elm.appendChild(t.elm),e.elm.appendChild(a.elm),t.elm.removeAttribute("style"),a.elm.removeAttribute("style"))}},{key:"toPortrait",value:function(){var e,t,a=u.getElement("playerContainer",this.elements),i=u.getElement("title",this.elements);this.orientation="portrait",this.setPlayerSize(),this.setCloseBtnSize(),a&&a.postCta.elm&&this.setPostCtaElementLocation(),i.description.elm.innerHTML="",i.source.elm.innerHTML="",i.description.elm.appendChild(document.createTextNode(u.truncateFromElement(this.parent.recData.title,i.description.elm))),i.source.elm.appendChild(document.createTextNode(u.truncateFromElement(this.parent.recData.sourceName,i.source.elm))),"omp"===this.parent.recData.mediaPlayer&&(e=u.getElement("header",this.player.video.elements),t=u.getElement("footer",this.player.video.elements),a=u.getElement("top",this.elements),i=u.getElement("bottom",this.elements),a.topContent.elm.appendChild(e.elm),i.bottomContent.elm.appendChild(t.elm),e.elm.style.top=a.header.elm.offsetHeight+5+"px",t.elm.style.bottom=i.footer.elm.offsetHeight+5+"px",t.elm.style.width="100%",t.elm.style.paddingBottom="15px")}},{key:"fixImaFrame",value:function(e){var t=u.getElement("mp",this.elements),a=t.adContainer,i=a.adWrapper,s=i.iframe;a.elm||(a.elm=t.elm.getElementsByClassName(a.className)[0],a.elm&&(i.elm=a.elm.getElementsByTagName("div")[0],i.elm&&(s.elm=i.elm.getElementsByTagName("iframe")[0]))),i.elm&&s.elm&&(i.elm.style.height=e.height+"px",i.elm.style.width=e.width+"px",s.elm.style.height=e.height+"px",s.elm.style.width=e.width+"px",s.height=e.height,s.width=e.width),this.player.resize()}},{key:"getPlayerSettings",value:function(){var e=void 0,t=this.parent.recData;return"rmp"===this.parent.recData.mediaPlayer?(e={licenseKey:"dml1bGR3ZGh2Y0AxNTAyMTk4",delayToFade:3e3,autoplay:!1,muted:!0,hideControls:!0,adVpaidControls:!0,hideCentralPlayButton:!0,ads:!0,adTagUrl:t.origUrl,adOutStream:!0,iframeMode:!0,preload:"metadata",skinBackgroundColor:"#000000",adBlockerDetection:!0,adShowRemainingTime:!0,adCountDown:!0,labels:{ads:{controlBarCustomMessage:" "}},poster:t.thumbnail||"",endOfVideoPoster:t.thumbnail||""},12<=this.parent.shared.ie&&(e.adVpaidMode="enabled")):e={adBlockerDetection:!0,adTagUrl:t.origUrl,mobile:!0,vastXML:window.vast,showClose:!1,vastParser:this.parent.shared.config.src.vastParser,vpaidBridge:this.parent.shared.config.src.vpaidBridge,twoStepsLoad:!0,muted:t.focusVideoSoundOff,customControls:t.customControls,adData:t},e}},{key:"onClick",value:function(e){e.preventDefault(),e.stopPropagation(),(e.isTrusted||this.parent.shared.isQA)&&(this.playing||(this.audit.send("CLICK_TO_PLAY"),this.parent.frameListener.sendToParent("click"),this.player.play()))}},{key:"onAnimationReady",value:function(){var e=u.getElement("thumbnailContainer",this.elements);u.getElement("player",this.elements);this.parent.animation.active&&e.elm.classList.remove(this.elements.style.transparentClassName),this.parent.frameListener.sendToParent("ready")}},{key:"onAnimationStart",value:function(e){var t=this.elements.body,a=u.getElement("thumbnailContainer",this.elements),i=u.getElement("playerContainer",this.elements),s=u.getElement("title",this.elements),n=u.getElement("logoWrapper",this.elements);"open"===e.mode?(this.playing=!0,t.elm.classList.add(t.opaqueClassName),a.elm.classList.add(a.readyClassName),i.elm.classList.add(i.readyClassName),n.textLogo.elm.appendChild(document.createTextNode(n.textLogo.value)),n.logo.elm.style.backgroundImage="url("+this.parent.shared.config.assets.logo+")"):(s.description.elm.innerHTML="",s.source.elm.innerHTML="",n.textLogo.elm.innerHTML="")}},{key:"onAnimationEnd",value:function(e){var t=this,a=this.elements.style,i=u.getElement("content",this.elements),s=u.getElement("title",this.elements),n=i.wrapper,r=n.thumbnailContainer,l=n.playerContainer,o=i.top,i=i.bottom;"open"===e.mode?(n.elm.classList.add(n.readyClassName),s.description.elm.innerHTML="",s.source.elm.innerHTML="",r.elm.classList.add(a.transparentClassName),l.elm.classList.remove(a.transparentClassName),o.elm.classList.remove(a.hideClassName),i.elm.classList.remove(a.hideClassName),this.parent.shared.window.width>this.parent.shared.window.height?this.toLandscape(!0):this.toPortrait(),this.player.resize(),this.parent.recData.focusVideoSoundOff?this.player.setVideoMute(!0):this.player.setVideoMute(!1),this.player.setControls(!0),this.setCloseBtnSize(),setTimeout(function(){r.elm.classList.add(t.elements.style.hideClassName)},500)):(this.playing=!1,this.player.destroy(),r.elm.classList.remove(r.readyClassName),l.elm.classList.remove(l.readyClassName),r.elm.classList.add(a.transparentClassName),o.elm.classList.add(a.hideClassName),i.elm.classList.add(a.hideClassName))}},{key:"onCloseClick",value:function(e){var t,a,i,s,n,r,l,o=this;e&&(e.preventDefault(),e.stopPropagation()),this.playing&&(this.player.stopAds(),this.player.setVideoMute(!0),this.player.setControls(!1),this.extraData&&"true"===this.extraData.postCtaEnabled&&this.removePostCta(),t=this.elements.style,a=this.elements.body,s=(i=(l=u.getElement("content",this.elements)).wrapper).thumbnailContainer,n=i.playerContainer,r=l.top,l=l.bottom,n.elm.classList.add(t.transparentClassName),a.elm.classList.remove(a.opaqueClassName),i.elm.classList.remove(i.readyClassName),r.elm.classList.add(t.hideClassName),l.elm.classList.add(t.hideClassName),s.elm.classList.remove(this.elements.style.hideClassName),this.parent.animation.active&&s.elm.classList.remove(t.transparentClassName),this.listeners.onClose(e),setTimeout(function(){o.parent.frameListener.sendToParent("close")},200))}},{key:"onShowControls",value:function(e){e.preventDefault(),this.player.setControls(!0)}},{key:"onResize",value:function(e){this.playing&&(e.width>e.height?this.toLandscape():this.toPortrait(),"rmp"===this.parent.recData.mediaPlayer?this.fixImaFrame(e):this.player.resize())}},{key:"onPlayerReady",value:function(){this.parent.playerReady=!0,this.parent.frameListener.sendToParent("playerLoaded",{duration:this.player.getDuration()})}},{key:"onReady",value:function(){this.ready=!0,this.parent.frameListener.sendToParent("load",{duration:this.player.getDuration()});var t=this.player.getAdMedias(),e=this.player.getAdUnit();if(t.length&&/innovid/.test(t[0].fileURL)){t={ivc_ad_id:this.parent.recData.adId,ivc_ad_title:this.parent.recData.title,ivc_source_id:this.parent.recData.sourceId,ivc_req_id:this.parent.recData.reqId,ivc_campaign_id:this.parent.recData.campaignId,ivc_publisher_id:this.parent.recData.publisherId,ivc_publisher_name:this.parent.recData.publisherName,ivc_adv_name:this.parent.recData.sourceName,ivc_time_stamp:this.parent.recData.timestamp,ivc_doc_id:this.parent.recData.did,ivc_widget_id:this.parent.recData.widgetNumberId,ivc_widget_name:this.parent.recData.widgetID,ivc_ext_ad_id:this.parent.recData.externalIds?this.parent.recData.externalIds.adId:"",ivc_ext_source_id:this.parent.recData.externalIds?this.parent.recData.externalIds.sourceId:"",ivc_ext_campaign_id:this.parent.recData.externalIds?this.parent.recData.externalIds.campaignId:"",ivc_ext_publisher_id:this.parent.recData.externalIds?this.parent.recData.externalIds.publisherId:"",ivc_ext_doc_id:this.parent.recData.externalIds?this.parent.recData.externalIds.did:""};try{e._creative.updateExternalMacros(t)}catch(e){console.log("OB DEBUG: try calling updateExternalMacros"),console.log(t)}}}},{key:"onUpdateClickIdParam",value:function(){this.parent.recData.obClickId=this.listeners.clickId}},{key:"onUpdateInnovidDynamicParams",value:function(){var t=this.player.getAdMedias(),e=this.player.getAdUnit();if(t.length&&/innovid/.test(t[0].fileURL)){t={ivc_ob_click_id:this.listeners.clickId};try{e._creative.updateExternalMacros(t)}catch(e){console.log("OB DEBUG: try calling updateExternalMacros"),console.log(t)}}}},{key:"onAdBlocker",value:function(){this.audit.adBlocker=!0}},{key:"onMetadata",value:function(){}},{key:"onFullScreen",value:function(){}},{key:"onWindowScreen",value:function(){this.setPlayerSize()}},{key:"onStart",value:function(){this.audit.videoDuration=this.player.getAdDuration()}},{key:"onFirstQuartile",value:function(){}},{key:"onSecondQuartile",value:function(){}},{key:"onThirdQuartile",value:function(){}},{key:"removePostCta",value:function(){var e=u.getElement("playerContainer",this.elements),t=e.postCta,a=e.player;try{t&&t.elm&&t.elm.parentNode==e.elm&&e.elm.removeChild(e.postCta.elm)}catch(e){}a&&a.elm&&(a.elm.style.transition="",a.elm.style.opacity="",a.elm.style.border="")}},{key:"prepareMacrosUrl",value:function(e,t){return e.replace("{ivc_ad_id}",this.validateMacros(t.parent.recData.adId)).replace("{ivc_widget_name}",this.validateMacros(t.parent.recData.widgetID)).replace("{ivc_widget_id}",this.validateMacros(t.parent.recData.widgetNumberId)).replace("{ivc_ad_title}",this.validateMacros(t.parent.recData.title)).replace("{ivc_source_id}",this.validateMacros(t.parent.recData.sourceId)).replace("{ivc_req_id}",this.validateMacros(t.parent.recData.reqId)).replace("{ivc_campaign_id}",this.validateMacros(t.parent.recData.campaignId)).replace("{ivc_publisher_id}",this.validateMacros(t.parent.recData.publisherId)).replace("{ivc_publisher_name}",this.validateMacros(t.parent.recData.publisherName)).replace("{ivc_adv_name}",this.validateMacros(t.parent.recData.sourceName)).replace("{ivc_time_stamp}",this.validateMacros(t.parent.recData.timestamp)).replace("{ivc_doc_id}",this.validateMacros(t.parent.recData.did)).replace("{ivc_ext_ad_id}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.adId):"").replace("{ivc_ext_source_id}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.sourceId):"").replace("{ivc_ext_campaign_id}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.campaignId):"").replace("{ivc_ext_publisher_id}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.publisherId):"").replace("{ivc_ext_doc_id}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.did):"").replace("{{ad_id}}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.adId):"").replace("{{widget_name}}",this.validateMacros(t.parent.recData.widgetID)).replace("{{widget_id}}",this.validateMacros(t.parent.recData.widgetNumberId)).replace("{{ad_title}}",this.validateMacros(t.parent.recData.title)).replace("{{section_id}}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.sourceId):"").replace("{{req_id}}",this.validateMacros(t.parent.recData.reqId)).replace("{{campaign_id}}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.campaignId):"").replace("{{publisher_id}}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.publisherId):"").replace("{{publisher_name}}",this.validateMacros(t.parent.recData.publisherName)).replace("{{adv_name}}",this.validateMacros(t.parent.recData.sourceName)).replace("{{time_stamp}}",this.validateMacros(t.parent.recData.timestamp)).replace("{{doc_id}}",t.parent.recData.externalIds?this.validateMacros(t.parent.recData.externalIds.did):"").replace("{ivc_ob_click_id}",this.validateMacros(t.parent.recData.obClickId)).replace("{{ob_click_id}}",this.validateMacros(t.parent.recData.obClickId)).replace("{{time_stamp}}",Date.now().toString())}},{key:"validateMacros",value:function(e){return e||""}},{key:"setPostCta",value:function(){var t=this;if(this.extraData&&"true"===this.extraData.postCtaEnabled){var a=this,e=u.getElement("playerContainer",this.elements),i=e.player,s=i.mp,n=e.postCta,e=this.extraData.postCtaForm&&1<this.extraData.postCtaForm.length?"iframe":"div";n.elm=document.createElement(e),n.elm.id=n.id,s.elm.appendChild(n.elm),i.elm.style.transition="opacity 0.5s linear, border-width 0.5s linear",n.elm.style.position="absolute";var r,e=this.extraData.postCtaImgUrl&&1<this.extraData.postCtaImgUrl.length;if("false"===this.extraData.showLastFrame?(s.elm.querySelector("video")&&(s.elm.querySelector("video").style.visibility="hidden"),s.elm.style.backgroundColor="rgba(0,0,0,0.5)",e||(n.elm.style.background="rgba(0,0,0,0.20)")):(s.elm.style.backgroundColor="transparent",s.elm.querySelector("video")&&(s.elm.querySelector("video").style.opacity="0.5"),e||(n.elm.style.background="rgba(0,0,0,0.35)")),this.extraData&&this.extraData.postCtaEnabled&&this.extraData.postCtaForm&&this.extraData.postCtaFormWidth&&this.extraData.postCtaFormHeight?(n.elm.src=this.extraData.postCtaForm,n.elm.classList.add("post-cta-form"),n.elm.style.width=this.extraData.postCtaFormWidth+"px",n.elm.style.height=this.extraData.postCtaFormHeight+"px",n.elm.style.transform="scaleX("+i.elm.clientWidth/n.elm.clientWidth+") scaleY("+i.elm.clientHeight/n.elm.clientHeight+")",n.elm.addEventListener("mouseover",function(){t.pausePostCtaCountdown=!0})):e?((r=new Image).onload=function(){var e=this.width/this.height;a.post.image.src=this.src,a.post.image.width=this.width>.7*window.innerWidth?.7*window.innerWidth:this.width,a.post.image.height=this.width>.7*window.innerWidth?.7*window.innerWidth/e:this.height,n.elm.style.backgroundImage="url("+this.src+")",n.elm.style.backgroundSize="cover",a.setPostCtaElementLocation()},r.src=this.extraData.postCtaImgUrl):(r=this.extraData.ctaType.split("_").join(" "),n.elm.innerHTML=this.extraData.postCtaText&&1<this.extraData.postCtaText.length?this.extraData.postCtaText:r,n.elm.style.color="white",n.elm.style.fontWeight="900",n.elm.style.padding="10px",n.elm.style.maxWidth="70%",this.setPostCtaElementLocation()),this.extraData.postCtaClickUrl&&n.elm.addEventListener("click",function(e){e.preventDefault();e=t.prepareMacrosUrl(t.extraData.postCtaClickUrl,t);t.audit.send("CLICK",{description:"End-card",type:t.extraData.ctaType}),window.open(e,"_blank")}),"true"===this.extraData.postCtaBorderEnabled&&(n.elm.style.border="3px solid white"),this.extraData.postCtaStyle&&(n.elm.style.cssText+=this.extraData.postCtaStyle),this.extraData.ctaPixels&&!this.parent.shared.isTest)try{for(var l=this.extraData.ctaPixels.split(","),o=0;o<l.length;o++)(new Image).src=l[o]}catch(e){}this.audit.send("CARD_VISIBLE",{description:"End-card",type:this.extraData.ctaType})}}},{key:"setPostCtaElementLocation",value:function(){var e=u.getElement("playerContainer",this.elements),t=e.player.mp,a=e.postCta,i=t.elm.querySelector("video"),e=i.offsetWidth/i.offsetHeight,t=i.videoWidth/i.videoHeight,s=e<=t?i.offsetWidth:i.offsetHeight*t,n=s/t,r=n<i.offsetHeight||Math.abs(t-e)<.02&&"portrait"===this.orientation,t=void 0,t=this.extraData.postCtaImgUrl&&1<this.extraData.postCtaImgUrl.length?this.post.image.width/this.post.image.height:2,e=.4*s,t=e/Number(t);switch(this.extraData.postCtaImgUrl&&1<this.extraData.postCtaImgUrl.length?(a.elm.style.width=e+"px",a.elm.style.height=t+"px",a.elm.style.lineHeight=t+"px"):a.elm.style.fontSize=s/18+"px",this.extraData.postCtaPosition){case"middleLeft":a.elm.style.transform="translateY(-50%)",a.elm.style.top="50%",a.elm.style.left=20+(i.offsetWidth-s)/2+"px";break;case"middleRight":a.elm.style.transform="translateY(-50%)",a.elm.style.top="50%",a.elm.style.right=20+(i.offsetWidth-s)/2+"px";break;case"topLeft":a.elm.style.transform="",a.elm.style.top=20+(i.offsetHeight-n)/2+"px",a.elm.style.left=20+(i.offsetWidth-s)/2+"px";break;case"topCenter":a.elm.style.transform="translateX(-50%)",a.elm.style.top=20+(i.offsetHeight-n)/2+"px",a.elm.style.left="50%";break;case"topRight":a.elm.style.transform="",a.elm.style.top=20+(i.offsetHeight-n)/2+"px",a.elm.style.right=20+(i.offsetWidth-s)/2+"px";break;case"bottomLeft":a.elm.style.transform="",a.elm.style.bottom=(r?20:60)+(i.offsetHeight-n)/2+"px",a.elm.style.left=20+(i.offsetWidth-s)/2+"px";break;case"bottomCenter":a.elm.style.transform="translateX(-50%)",a.elm.style.bottom=(r?20:60)+(i.offsetHeight-n)/2+"px",a.elm.style.left="50%";break;case"bottomRight":a.elm.style.transform="",a.elm.style.bottom=(r?20:60)+(i.offsetHeight-n)/2+"px",a.elm.style.right=20+(i.offsetWidth-s)/2+"px";break;case"center":a.elm.style.transform="translate(-50%, -50%)",a.elm.style.top="50%",a.elm.style.left="50%";break;default:a.elm.style.transform="translate(-50%, -50%)",a.elm.style.top="50%",a.elm.style.left="50%"}}},{key:"onComplete",value:function(){var e,t=this;this.parent.shared.featureFlags.allowPostCta&&this.extraData&&"true"===this.extraData.postCtaEnabled?(this.setPostCta(),e=this.extraData.postCtaDuration||0,setTimeout(function(){t.pausePostCtaCountdown||(t.removePostCta(),t.onCloseClick(!1))},1e3*e)):this.onCloseClick(!1)}},{key:"onSkip",value:function(){}},{key:"onClose",value:function(){}},{key:"onAdClick",value:function(){}},{key:"onVolumeChange",value:function(){}},{key:"onPause",value:function(){}},{key:"onResume",value:function(){}},{key:"onDestroy",value:function(){var e=u.getElement("mp",this.elements),t=u.getElement("top",this.elements),a=u.getElement("bottom",this.elements),i=document.createElement("div");t.topContent.elm.innerHTML="",a.bottomContent.elm.innerHTML="",i.id=e.id,"omp"===this.parent.recData.mediaPlayer&&i.classList.add(e.OMPClassName),this.ready=!1,e.elm.parentNode.replaceChild(i,e.elm),e.elm=i,this.setPlayer()}},{key:"onError",value:function(e){this.parent.onError(e)}},{key:"playing",set:function(e){this._playing=e,this.parent.frameListener.sendToParent("isPlaying",{playing:e})},get:function(){return this._playing}}]),v);function v(e){_classCallCheck(this,v),this.parent=e,this.audit=new h(this),this.listeners=null,this.ready=!1,this.player=null,this.pausePostCtaCountdown=!1,this._playing=!1,this.orientation="portrait",this.maxScreenWidth=92,this.maxScreenHeight=85,this.extraData=this.parent.recData.adExtraData&&this.parent.recData.adExtraData[this.parent.recData.adId]?this.parent.recData.adExtraData[this.parent.recData.adId]:void 0,this.elements={body:{elm:document.getElementsByTagName("body")[0],opaqueClassName:"opaque",content:{elm:null,id:"content",top:{elm:null,id:"top",header:{elm:null,id:"header",title:{elm:null,id:"title",description:{elm:null,id:"description"},source:{elm:null,id:"source"}},close:{elm:null,id:"close",img:{elm:null}}},topContent:{elm:null,id:"top-content"}},wrapper:{elm:null,id:"wrapper",readyClassName:"ready",playerContainer:{elm:null,id:"player-container",readyClassName:"ready",postCta:{elm:null,id:"post-cta"},player:{elm:null,id:"player",mp:{elm:null,id:"mp",OMPClassName:"omp",adContainer:{elm:null,className:"rmp-ad-container",adWrapper:{elm:null,iframe:{elm:null}}}}}},thumbnailContainer:{elm:null,id:"thumbnail-container",readyClassName:"ready",thumbnail:{elm:null,id:"thumbnail"}}},bottom:{elm:null,id:"bottom",bottomContent:{elm:null,id:"bottom-content"},footer:{elm:null,id:"footer",logoWrapper:{elm:null,id:"logo-wrapper",textLogo:{elm:null,id:"text-logo",value:"Recommended by"},logo:{elm:null,id:"logo"}}}}}},style:{hideClassName:"obp-hidden",transparentClassName:"obp-trans"}},this.post={data:null,image:{src:null,width:0,height:0}},this.events={click:this.onClick.bind(this),close:this.onCloseClick.bind(this),controls:this.onShowControls.bind(this)},u.waterfall([this.setElements,this.setPlayer,this.setThumbnail,this.setClose],this).catch(this.onError.bind(this))}var f=(_createClass(b,[{key:"config",get:function(){return this._config},set:function(e){this._config=e}},{key:"mobile",get:function(){return this._mobile},set:function(e){this._mobile=e}},{key:"ie",get:function(){return this._ie},set:function(e){this._ie=e}},{key:"dynCSS",get:function(){return this._dynCSS},set:function(e){this._dynCSS=e}},{key:"window",get:function(){return this._window},set:function(e){this._window=e}},{key:"parentWindow",get:function(){return this._parentWindow},set:function(e){this._parentWindow=e}},{key:"frameListener",get:function(){return this._frameListener},set:function(e){this._frameListener=e}},{key:"errorHandler",get:function(){return this._errorHandler},set:function(e){this._errorHandler=e}},{key:"isIFrame",get:function(){return this._isIFrame},set:function(e){this._isIFrame=e}},{key:"isTest",get:function(){return this._isTest},set:function(e){this._isTest=e}},{key:"isQA",get:function(){return this._isQA},set:function(e){this._isQA=e}},{key:"featureFlags",get:function(){return this._featureFlags},set:function(e){this._featureFlags=e}},{key:"adExtraData",get:function(){return this._adExtraData},set:function(e){this._adExtraData=e}},{key:"eventsCounter",get:function(){return this._eventsCounter},set:function(e){this._eventsCounter=e}},{key:"settingsFeatures",get:function(){return this._settingsFeatures},set:function(e){this._settingsFeatures=e}},{key:"isReelWidget",get:function(){return this._isReelWidget},set:function(e){this._isReelWidget=e}}]),b);function b(e){_classCallCheck(this,b),this._config=e.config,this._mobile=e.mobile,this._ie=e.ie,this._dynCSS=e.dynCSS,this._window=e.window,this._parentWindow=e.parentWindow,this._frameListener=e.frameListener,this._errorHandler=e.errorHandler,this._isIFrame=e.isIframe,this._isTest=e.isTest,this._isQA=e.isQA,this._featureFlags=e.featureFlags,this._adExtraData=e.adExtraData,this._eventsCounter=e.eventsCounter,this._settingsFeatures=e.settingsFeatures,this._isReelWidget=e.isReelWidget}var C=(_createClass(w,[{key:"init",value:function(){u.waterfall([this.cleanNamespace,this.getConfig],this).catch(this.onError.bind(this))}},{key:"cleanNamespace",value:function(){window.obpHost=void 0,window.frameId=void 0,window.removeEventListener("message",window.onOBPMessage),window.onOBPMessage=void 0}},{key:"getConfig",value:function(){this.frameListener.sendToParent("config")}},{key:"onClose",value:function(){this.child.onCloseClick()}},{key:"onConfig",value:function(e){this.shared=new f(e),this.recData=e.recData,this.sessionId=e.sessionId,this.widgetDirection=e.widgetDirection,this.animation=e.animation,"prod"!==this.shared.config.env&&console.log("Frame inserted. ExtFiles loading: "+Date.now()),new r(this.shared.config,"frame",this.recData.mediaPlayer,this.onLoaded.bind(this),this.onError.bind(this))}},{key:"onLoaded",value:function(){"prod"!==this.shared.config.env&&console.log("Frame extFiles loaded: "+Date.now()),document.getElementsByTagName("body")[0].classList.add("omp"),this.child=new(this.shared.mobile?g:p)(this)}},{key:"onAnimationReady",value:function(e){this.child.onAnimationReady(e)}},{key:"onAnimationStart",value:function(e){this.child.onAnimationStart(e)}},{key:"onAnimationEnd",value:function(e){this.child.onAnimationEnd(e)}},{key:"onEsc",value:function(e){this.child.onEsc(e)}},{key:"onResize",value:function(e){this.child&&(this.shared.window.width=e.width,this.shared.window.height=e.height,this.child.onResize(e))}},{key:"onIsPlaying",value:function(){this.frameListener.sendToParent("isPlaying",{playing:this.child.playing})}},{key:"onRecInView",value:function(){var e=this,t=10;this.chiledExistInterval=window.setInterval(function(){e.child&&(window.clearInterval(e.chiledExistInterval),e.child.OnRecInView()),0===t&&window.clearInterval(e.chiledExistInterval),t--},500)}},{key:"onAutoPlayReady",value:function(){this.child.onAutoPlayReady()}},{key:"onError",value:function(e){this.frameListener.sendToParent("error",{err:e})}}]),w);function w(){_classCallCheck(this,w),this.parentHost=obpHost,this.id=frameId,this.frameListener=new k(this,obpHost,this.onError.bind(this)),this.shared=null,this.recData=null,this.sessionId=null,this.widgetDirection=null,this.animation=null,this.child=null,this.playerReady=!1,this.init()}var k=(_createClass(E,[{key:"onChildMessage",value:function(e){if(e.origin===this.origin&&"object"===_typeof(e.data)&&e.data.hasOwnProperty("obpMessage"))return e.data.hasOwnProperty("status")?e.data.hasOwnProperty("id")?this.entity.hasOwnProperty(e.data.id)?"error"===e.data.status?this.onError(e.data.err):"init"===e.data.status?this.entity[e.data.id].onInit(e.data):"config"===e.data.status?this.entity[e.data.id].onConfig(e.data):"load"===e.data.status?this.entity[e.data.id].onLoad(e.data):"playerLoaded"===e.data.status?this.entity[e.data.id].onPlayerLoaded(e.data):"click"===e.data.status?this.entity[e.data.id].onClick(e.data):"ready"===e.data.status?this.entity[e.data.id].onReady(e.data):"close"===e.data.status?this.entity[e.data.id].onClose(e.data):"isPlaying"===e.data.status?this.entity[e.data.id].onIsPlaying(e.data):"autoPlay"===e.data.status?this.entity[e.data.id].onAutoPlay(e.data):void 0:this.onError(new Error("Unknown frame id "+e.data.id)):this.onError(new Error("Frame message must contain an id key")):this.onError(new Error("Frame message must contain a status key"))}},{key:"onParentMessage",value:function(e){if(e.origin===this.origin&&"object"===_typeof(e.data)&&e.data.hasOwnProperty("obpMessage"))return e.data.hasOwnProperty("status")?"error"===e.data.status?this.onError(e.data.err):"init"===e.data.status?this.entity.onInit(e.data):"config"===e.data.status?this.entity.onConfig(e.data):"ready"===e.data.status?this.entity.onAnimationReady(e.data):"animation-start"===e.data.status?this.entity.onAnimationStart(e.data):"animation-end"===e.data.status?this.entity.onAnimationEnd(e.data):"esc"===e.data.status?this.entity.onEsc(e.data):"resize"===e.data.status?this.entity.onResize(e.data):"isPlaying"===e.data.status?this.entity.onIsPlaying(e.data):"close"===e.data.status?this.entity.onClose(e.data):"rec-in-view"===e.data.status?this.entity.onRecInView(e.data):"autoPlayReady"===e.data.status?this.entity.onAutoPlayReady(e.data):void 0:this.onError(new Error("Frame message must contain a status key"))}},{key:"sendToChild",value:function(t,a,e){a={obpMessage:!0,status:a};if((a=e?_extends(a,e):a).err&&(a.err=e.err.message),t)try{t.contentWindow.postMessage(a,this.origin)}catch(e){a=JSON.parse(JSON.stringify(a));t.contentWindow.postMessage(a,this.origin)}}},{key:"sendToParent",value:function(e,t){e={obpMessage:!0,id:this.entity.id,status:e,widgetID:this.entity.recData?this.entity.recData.widgetID:void 0,widgetIdx:this.entity.recData?this.entity.recData.widgetIdx:void 0};(e=t?_extends(e,t):e).err&&(e.err=t.err.message),parent.postMessage(e,this.origin)}},{key:"destroy",value:function(){window.removeEventListener("message",this.msgHandler,!1)}},{key:"onError",value:function(e){this.errorHandler(e)}}]),E);function E(e,t,a){_classCallCheck(this,E),this.entity=e,this.origin=t,this.msgHandler=(e instanceof C?this.onParentMessage:this.onChildMessage).bind(this),this.errorHandler=a,window.addEventListener("message",this.msgHandler,!1)}var D=(_createClass(x,[{key:"addRec",value:function(e){this.initialized||(this.initialized=!0,this.init(e)),this.ready?this.initRec(e):this.recsQueue.push(e)}},{key:"init",value:function(e){this.version=e.obpVersion||"latest",this.env=e.obPlayerEnv||"prod",this.mobile=e.platform&&"mobile"===e.platform;e=[this.isIE,this.setConfig,this.importCSS,this.getDynCSS,this.setFrameListener,this.setKeyListener,this.setResizeListener,this.isReady,this.dequeue];u.waterfall(e,this).catch(this.onError.bind(this))}},{key:"isIframe",value:function(){try{return window.self!==window.top}catch(e){return console.error(e),!0}}},{key:"isTest",value:function(){var e=window.location.search.substring(1),e=this.parseQueryString(e);return e.hasOwnProperty("obvpTest")&&("true"===e.obvpTest.toLowerCase()||"1"===e.obvpTest)}},{key:"isQA",value:function(){var e=window.location.search.substring(1),e=this.parseQueryString(e);return e.hasOwnProperty("obqa")&&("true"===e.obqa.toLowerCase()||"1"===e.obqa)}},{key:"isIE",value:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),a=e.indexOf("Trident/"),i=e.indexOf("Edge/");0<t&&(this.ie=parseInt(e.substring(t+5,e.indexOf(".",t)),10)),0<a&&(a=e.indexOf("rv:"),this.ie=parseInt(e.substring(a+3,e.indexOf(".",a)),10)),0<i&&(this.ie=parseInt(e.substring(i+5,e.indexOf(".",i)),10))}},{key:"setConfig",value:function(){var e=new t(this.version);this.config=e[this.env]}},{key:"importCSS",value:function(){var a=this;return new Promise(function(e,t){new r(a.config,"main",null,e,t)})}},{key:"getDynCSS",value:function(){var i=this;return new Promise(function(t,a){u.ajax({method:"GET",url:i.config.src.obpAnimCss,success:function(e){e?t(i.dynCSS=e):a(new Error("Cannot retrieve dynamic CSS."))},fail:a})})}},{key:"parseQueryString",value:function(e){for(var t=e.split("&"),a={},i=0;i<t.length;i++){var s=t[i].split("=");void 0===a[s[0]]?a[s[0]]=decodeURIComponent(s[1]):"string"==typeof a[s[0]]?a[s[0]]=[a[s[0]],decodeURIComponent(s[1])]:a[s[0]].push(decodeURIComponent(s[1]))}return a}},{key:"setFrameListener",value:function(){"preview"===this.env&&this.recsQueue[0]&&this.recsQueue[0].vastXml?this.frameListener=new k(this.players,this.config.src.previewFrameOrigin,this.onError.bind(this)):this.frameListener=new k(this.players,this.config.src.frameOrigin,this.onError.bind(this))}},{key:"setKeyListener",value:function(){window.addEventListener("keydown",this.events.key)}},{key:"setResizeListener",value:function(){var t=this;window.addEventListener("resize",this.events.window),this.fullscreenEvts.forEach(function(e){document.addEventListener(e,t.events.window)})}},{key:"isReady",value:function(){this.ready=!0}},{key:"dequeue",value:function(){for(var e=this.recsQueue.length,t=0;t<e;t++)this.initRec(this.recsQueue.pop())}},{key:"getCtwData",value:function(e){return this.serviceCallBack=new a(this,"OB_CtwClientCalls"),this.serviceCallBack.getCtwData(e)}},{key:"getSettingsFeatures",value:function(e){try{return e.videoFeatureFlags?JSON.parse(e.videoFeatureFlags):{}}catch(e){return{}}}},{key:"initRec",value:function(t){var a=this;this.playersInstance++,t.pageUrl=window.location.href;var i=u.uuid(),e={config:this.config,mobile:this.mobile,isIframe:this.isIframe(),isTest:this.isTest(),isQA:this.isQA(),ie:this.ie,dynCSS:this.dynCSS,window:{width:(document.body.clientWidth<document.documentElement.clientWidth?document.body:document.documentElement).clientWidth,height:(document.body.clientHeight<document.documentElement.clientHeight?document.body:document.documentElement).clientHeight},frameListener:this.frameListener,errorHandler:this.onError.bind(this),featureFlags:this.featureFlags,adExtraData:void 0,eventsCounter:this.eventsCounter,externalIds:{},settingsFeatures:this.getSettingsFeatures(t),isReelWidget:/odb_dynamic_reel/gi.test(t.widgetRecMode)};t.internalIds={adId:t.adId,sourceId:t.sourceId,campaignId:t.campaignId,publisherId:t.publisherId,did:t.did};var s=new f(e);"preview"===s.config.env&&t.fakeExtraData?(t.adExtraData=t.fakeExtraData,this.players[i]=new n(i,t,s)):this.getCtwData(t).then(function(e){if(!(e instanceof Error))try{t.adExtraData=e.adExtraData,t.publisherName=e.publisherName,t.externalIds=e.externalIds}catch(e){console.log(e)}a.players[i]=new n(i,t,s)}).catch(function(e){t.externalIds=t.internalIds,a.players[i]=new n(i,t,s)})}},{key:"broadcast",value:function(e){for(var t,a=void 0,i=arguments.length,s=Array(1<i?i-1:0),n=1;n<i;n++)s[n-1]=arguments[n];for(a in this.players)this.players.hasOwnProperty(a)&&"function"==typeof this.players[a][e]&&(t=this.players[a])[e].apply(t,s)}},{key:"destroy",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,a=document.getElementsByTagName("head")[0],i=a.getElementsByTagName("script"),s=a.getElementsByTagName("link");this.broadcast("destroy"),window.removeEventListener("keydown",this.events.key),window.removeEventListener("resize",this.events.window),this.fullscreenEvts.forEach(function(e){document.removeEventListener(e,t.events.window)}),this.frameListener.destroy();for(var n=i.length;n--;)/obp|obf|omp/.test(i[n].src)&&a.removeChild(i[n]);for(n=s.length;n--;)/obp|obf|omp/.test(s[n].href)&&a.removeChild(s[n]);"preview"==e&&(this.initialized=!1,this.ready=!1)}},{key:"onKeyPress",value:function(e){27===(e||window.event).keyCode&&this.broadcast("onEsc")}},{key:"onResize",value:function(a){var i=this;this.resizeId&&clearTimeout(this.resizeId);var s=this;this.resizeId=setTimeout(function(){var e,t;(s.documentSizes.width!==document.body.clientWidth||s.documentSizes.height!==document.body.clientHeight||0<=i.fullscreenEvts.indexOf(a.type))&&(e=(document.body.clientWidth<document.documentElement.clientWidth?document.body:document.documentElement).clientWidth,t=(document.body.clientHeight<document.documentElement.clientHeight?document.body:document.documentElement).clientHeight,i.documentSizes.width=e,i.documentSizes.height=t,i.broadcast("onResize",{width:e,height:t}))},50)}},{key:"onError",value:function(e){throw e=!(e instanceof Error)?new Error(e):e}}]),x);function x(){_classCallCheck(this,x),this.initialized=!1,this.mobile=!1,this.ie=0,this.version="latest",this.env="prod",this.config=null,this.dynCSS=null,this.ready=!1,this.frameListener=null,this.recsQueue=[],this.playersInstance=0,this.resizeId=0,this.fullscreenEvts=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],this.documentSizes={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight},this.players={},this.events={key:this.onKeyPress.bind(this),window:this.onResize.bind(this)},this.featureFlags={allowPlayWithoutOverly:!0,loadBrandedOnRecView:!0,allowPostCta:!0},this.adExtraData=null,this.eventsCounter={error:2,click:2,play:2,redirection:2,duplicateFilter:5},this.settingsFeatures={}}OBR&&(OBR.outbrainPlayer=D)}();