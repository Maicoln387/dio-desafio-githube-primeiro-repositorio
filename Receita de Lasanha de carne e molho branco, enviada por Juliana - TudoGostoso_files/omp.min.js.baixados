"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(){var d=(_createClass(e,null,[{key:"waterfall",value:function(e,i){return e.reduce(function(e,t){return e.then(i?t.bind(i):t)},Promise.resolve())}},{key:"uuid",value:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return"ob"+e().substring(0,2)+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},{key:"ajax",value:function(e){var t=e.method,i=e.url,s=(e.data,e.success),n=e.fail,a=new XMLHttpRequest;a.open(t,i),a.onload=function(){200===a.status?"function"==typeof s&&s(a.responseText):"function"==typeof n&&n(a.status)},a.send()}},{key:"extend",value:function(t,i){return Object.keys(i).forEach(function(e){t[e]=i[e]}),t}},{key:"getElement",value:function(e,t){return function e(t,i){var s=Object.keys(i),n=null;if(0<=s.indexOf(t))return i[t];for(var a=s.length;a--;)if(i[s[a]]&&"object"===_typeof(i[s[a]])&&"elm"!==s[a]&&(n=e(t,i[s[a]])))return n;return n}(e,t)}},{key:"injectStyle",value:function(e,t){var i=document.getElementsByTagName("body")[0],s=document.createElement("style");t&&s.classList.add(t),s.innerHTML=e,i.appendChild(s)}},{key:"removeStyle",value:function(e){for(var t=e?document.getElementsByClassName(e):document.getElementsByTagName("style"),i=t.length;i--;)t[i].parentNode.removeChild(t[i])}},{key:"humanTime",value:function(e){var t=new Date(null);return t.setSeconds(e),t.toISOString().substr(14,5)}},{key:"truncateFromElement",value:function(e,t){var i=document.createElement("span"),s=e.length,n=[],a=0,r=e;i.style.visibility="hidden",t.appendChild(i);for(var o=t.offsetWidth;a<s;a++)if(n.push(e[a]),i.innerText=n.join(""),i.offsetWidth>=o-30){n.push(" ..."),r=n.join("");break}return t.removeChild(i),r}}]),e);function e(){_classCallCheck(this,e)}var a="//libs.sphere.com/video/outbrain-player/lib/ads.js",i="//libs.sphere.com/video/outbrain-player/current/omp.css";function t(){}t.xhr=function(){var e=new window.XMLHttpRequest;if("withCredentials"in e)return e},t.supported=function(){return!!this.xhr()},t.get=function(e,t,i){var s;if("https:"===window.location.protocol&&0===e.indexOf("http://"))return i(new Error("XHRURLHandler: Cannot go from HTTPS to HTTP."));try{return(s=this.xhr()).open("GET",e),s.timeout=t.timeout||0,s.withCredentials=t.withCredentials||!1,s.overrideMimeType&&s.overrideMimeType("text/xml"),s.onreadystatechange=function(){if(4===s.readyState)return 200===s.status?i(null,s.responseXML):i(new Error("XHRURLHandler: "+s.status))},s.send()}catch(e){return i(new Error("XHRURLHandler: Unexpected error"))}};var n=t;function s(){}s.xdr=function(){var e;return e=window.XDomainRequest?new XDomainRequest:e},s.supported=function(){return!!this.xdr()},s.get=function(e,t,i){var s,n;return(n="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0)?(n.async=!1,(s=this.xdr()).open("GET",e),s.timeout=t.timeout||0,s.withCredentials=t.withCredentials||!1,s.send(),s.onprogress=function(){},s.onload=function(){return n.loadXML(s.responseText),i(null,n)}):i(new Error("FlashURLHandler: Microsoft.XMLDOM format not supported"))};var r=s;function o(){}o.get=function(e,t,i){var s;return i||("function"==typeof t&&(i=t),t={}),null!=t.response?(s=t.response,delete t.response,i(null,s)):null!=(s=t.urlhandler)&&s.supported()?t.urlhandler.get(e,t,i):"undefined"==typeof window||null===window?require("./urlhandlers/node").get(e,t,i):n.supported()?n.get(e,t,i):r.supported()?r.get(e,t,i):i(new Error("Current context is not supported by any of the default URLHandlers. Please provide a custom URLHandler"))};var l=o,g=function(){this.ads=[],this.errorURLTemplates=[]},y=function(){this.id=null,this.sequence=null,this.system=null,this.title=null,this.description=null,this.advertiser=null,this.pricing=null,this.survey=null,this.errorURLTemplates=[],this.impressionURLTemplates=[],this.viewableImpressionURLTemplates={viewable:[],notViewable:[],viewUndetermined:[]},this.creatives=[],this.extensions=[],this.adVerifications=[]},E=function(){this.attributes={},this.children=[]},w=function(){this.name=null,this.value=null,this.attributes={}};function c(){}c.track=function(e,t){for(var i,s,n=this.resolveURLTemplates(e,t),a=[],r=0,o=n.length;r<o;r++)i=n[r],"undefined"!=typeof window&&null!==window&&(s=new Image,a.push(s.src=i));return a},c.resolveURLTemplates=function(e,t){var i,s,n,a,r,o,l=[];for(null!=(t=null==t?{}:t).ASSETURI&&(t.ASSETURI=this.encodeURIComponentRFC3986(t.ASSETURI)),null!=t.CONTENTPLAYHEAD&&(t.CONTENTPLAYHEAD=this.encodeURIComponentRFC3986(t.CONTENTPLAYHEAD)),null==t.ERRORCODE||/^[0-9]{3}$/.test(t.ERRORCODE)||(t.ERRORCODE=900),t.CACHEBUSTING=this.leftpad(Math.round(1e8*Math.random()).toString()),t.TIMESTAMP=this.encodeURIComponentRFC3986((new Date).toISOString()),t.RANDOM=t.random=t.CACHEBUSTING,i=0,n=e.length;i<n;i++)if(r=e[i]){for(s in t)o=t[s],a="%%"+s+"%%",r=(r=r.replace("["+s+"]",o)).replace(a,o);l.push(r)}return l},c.encodeURIComponentRFC3986=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16)})},c.leftpad=function(s){return s.length<8?function(){for(var e=[],t=0,i=8-s.length;0<=i?t<i:i<t;0<=i?t++:t--)e.push("0");return e}().join("")+s:s},c.storage=function(){var i,t;try{t="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(e){t=null}return null!=t&&!function(e){var t;try{if(t="__VASTUtil__",e.setItem(t,t),e.getItem(t)!==t)return!0}catch(e){return!0}return!1}(t)||(i={},t={length:0,getItem:function(e){return i[e]},setItem:function(e,t){i[e]=t,this.length=Object.keys(i).length},removeItem:function(e){delete i[e],this.length=Object.keys(i).length},clear:function(){i={},this.length=0}}),t}(),c.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function u(e,t){for(var i in t)h.call(t,i)&&(e[i]=t[i]);function s(){this.constructor=e}return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e}var te,V,f=c,h={}.hasOwnProperty;function m(){m.__super__.constructor.apply(this,arguments),this.type="linear",this.duration=0,this.skipDelay=null,this.mediaFiles=[],this.videoClickThroughURLTemplate=null,this.videoClickTrackingURLTemplates=[],this.videoCustomClickURLTemplates=[],this.adParameters=null,this.icons=[]}function p(){p.__super__.constructor.apply(this,arguments),this.type="nonlinear",this.variations=[]}function v(){v.__super__.constructor.apply(this,arguments),this.type="companion",this.variations=[]}u(m,L=function(e){this.id=(e=null==e?{}:e).id||null,this.adId=e.adId||null,this.sequence=e.sequence||null,this.apiFramework=e.apiFramework||null,this.trackingEvents={}}),te=m,u(p,L),V=p,u(v,L);var k,P=v,ie=function(){this.id=null,this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null},se=function(){this.program=null,this.height=0,this.width=0,this.xPosition=0,this.yPosition=0,this.apiFramework=null,this.offset=null,this.duration=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.iconClickThroughURLTemplate=null,this.iconClickTrackingURLTemplates=[],this.iconViewTrackingURLTemplate=null},F=function(){this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.altText=null,this.companionClickThroughURLTemplate=null,this.companionClickTrackingURLTemplates=[],this.trackingEvents={}},S=function(){this.id=null,this.width=0,this.height=0,this.expandedWidth=0,this.expandedHeight=0,this.scalable=!0,this.maintainAspectRatio=!0,this.minSuggestedDuration=0,this.apiFramework="static",this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.nonlinearClickThroughURLTemplate=null,this.nonlinearClickTrackingURLTemplates=[],this.adParameters=null},b=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function C(){}k=[],C.addURLTemplateFilter=function(e){"function"==typeof e&&k.push(e)},C.removeURLTemplateFilter=function(){return k.pop()},C.countURLTemplateFilters=function(){return k.length},C.clearUrlTemplateFilters=function(){return k=[]},C.parse=function(e,t,i){return i||("function"==typeof t&&(i=t),t={}),this._parse(e,null,t,function(e,t){return i(t,e)})},C.load=function(e,t,i){return i||("function"==typeof t&&(i=t),t={}),this.parseXmlDocument(null,[],t,e,i)},C._parse=function(i,s,n,a){var e,t,r,o;for(a||("function"==typeof n&&(a=n),n={}),t=0,r=k.length;t<r;t++)e=k[t],i=e(i);return(s=null==s?[]:s).push(i),l.get(i,n,(o=this,function(e,t){return null!=e?a(e):o.parseXmlDocument(i,s,n,t,a)}))},C.parseXmlDocument=function(t,i,s,e,r){var o,d,n,a,l,c,u,h,m,p,v=new g;if(null==(null!=e?e.documentElement:void 0)||"VAST"!==e.documentElement.nodeName)return r(new Error("Invalid VAST XMLDocument"));for(n=0,l=(m=e.documentElement.childNodes).length;n<l;n++)"Error"===(h=m[n]).nodeName&&v.errorURLTemplates.push(C.parseNodeText(h));for(a=0,c=(p=e.documentElement.childNodes).length;a<c;a++)"Ad"===(h=p[a]).nodeName&&(null!=(o=C.parseAdElement(h))?v.ads.push(o):f.track(v.errorURLTemplates,{ERRORCODE:101}));for(d=function(e,t){var i,s,n,a;if(null==e&&(e=null),null==t&&(t=!1),v){for(n=!0,i=0,s=(a=v.ads).length;i<s;i++){if(null!=(o=a[i]).nextWrapperURL)return;0<o.creatives.length&&(n=!1)}return n&&(t||f.track(v.errorURLTemplates,{ERRORCODE:303})),0===v.ads.length&&(v=null),r(e,v)}},u=v.ads.length;u--;)null!=(o=v.ads[u]).nextWrapperURL&&function(l){var e;i.length>(null!==s.wrapperLimit?s.wrapperLimit:9)||(e=l.nextWrapperURL,0<=b.call(i,e))?(f.track(l.errorURLTemplates,{ERRORCODE:302}),v.ads.splice(v.ads.indexOf(l),1),d(new Error("Wrapper limit reached, as defined by the video player"))):(null!=t&&(l.nextWrapperURL=C.resolveVastAdTagURI(l.nextWrapperURL,t)),C._parse(l.nextWrapperURL,i,s,function(e,t){var i,s,n,a,r,o=!1;if(null!=e)f.track(l.errorURLTemplates,{ERRORCODE:301}),v.ads.splice(v.ads.indexOf(l),1),o=!0;else if(null==t)f.track(l.errorURLTemplates,{ERRORCODE:303}),v.ads.splice(v.ads.indexOf(l),1),o=!0;else for(v.errorURLTemplates=v.errorURLTemplates.concat(t.errorURLTemplates),i=v.ads.indexOf(l),v.ads.splice(i,1),s=0,n=(a=t.ads).length;s<n;s++)r=a[s],C.mergeWrapperAdData(r,l),v.ads.splice(++i,0,r);return delete l.nextWrapperURL,d(e,o)}))}(o);return d()},C.resolveVastAdTagURI=function(e,t){return 0===e.indexOf("//")?""+location.protocol+e:-1===e.indexOf("://")?t.slice(0,t.lastIndexOf("/"))+"/"+e:e},C.mergeWrapperAdData=function(e,t){var i,s,n,a,r,o,l,d,c,u,h,m,p,v,g,y,f,k,b,E;for(e.errorURLTemplates=t.errorURLTemplates.concat(e.errorURLTemplates),e.impressionURLTemplates=t.impressionURLTemplates.concat(e.impressionURLTemplates),e.extensions=t.extensions.concat(e.extensions),a=0,d=(m=e.creatives).length;a<d;a++)if(s=m[a],null!=(null!=(p=t.trackingEvents)?p[s.type]:void 0))for(n in v=t.trackingEvents[s.type])E=v[n],(i=s.trackingEvents)[n]||(i[n]=[]),s.trackingEvents[n]=s.trackingEvents[n].concat(E);if(null!=(y=t.videoClickTrackingURLTemplates)&&y.length)for(r=0,c=(g=e.creatives).length;r<c;r++)"linear"===(s=g[r]).type&&(s.videoClickTrackingURLTemplates=s.videoClickTrackingURLTemplates.concat(t.videoClickTrackingURLTemplates));if(null!=(y=t.videoCustomClickURLTemplates)&&y.length)for(o=0,u=(f=e.creatives).length;o<u;o++)"linear"===(s=f[o]).type&&(s.videoCustomClickURLTemplates=s.videoCustomClickURLTemplates.concat(t.videoCustomClickURLTemplates));if(t.viewableImpressionURLTemplates&&(e.viewableImpressionURLTemplates||(e.viewableImpressionURLTemplates={viewable:[],notViewable:[],viewUndetermined:[]}),t.viewableImpressionURLTemplates.viewable&&(e.viewableImpressionURLTemplates.viewable=t.viewableImpressionURLTemplates.viewable.concat(e.viewableImpressionURLTemplates.viewable)),t.viewableImpressionURLTemplates.notViewable&&(e.viewableImpressionURLTemplates.notViewable=t.viewableImpressionURLTemplates.notViewable.concat(e.viewableImpressionURLTemplates.notViewable)),t.viewableImpressionURLTemplates.viewUndetermined&&(e.viewableImpressionURLTemplates.viewUndetermined=t.viewableImpressionURLTemplates.viewUndetermined.concat(e.viewableImpressionURLTemplates.viewUndetermined))),null!=t.videoClickThroughURLTemplate){for(b=[],l=0,h=(k=e.creatives).length;l<h;l++)"linear"===(s=k[l]).type&&null==s.videoClickThroughURLTemplate?b.push(s.videoClickThroughURLTemplate=t.videoClickThroughURLTemplate):b.push(void 0);return b}},C.childByName=function(e,t){for(var i,s=e.childNodes,n=0,a=s.length;n<a;n++)if((i=s[n]).nodeName===t)return i},C.childsByName=function(e,t){for(var i,s=[],n=e.childNodes,a=0,r=n.length;a<r;a++)(i=n[a]).nodeName===t&&s.push(i);return s},C.parseAdElement=function(e){for(var t,i,s=e.childNodes,n=0,a=s.length;n<a;n++)if("Wrapper"===(i=(t=s[n]).nodeName)||"InLine"===i){if(this.copyNodeAttribute("id",e,t),this.copyNodeAttribute("sequence",e,t),"Wrapper"===t.nodeName)return this.parseWrapperElement(t);if("InLine"===t.nodeName)return this.parseInLineElement(t)}},C.parseWrapperElement=function(e){var t,i,s,n,a,r,o,l,d,c,u,h,m,p,v,g,y,f,k,b,E=this.parseInLineElement(e),w=this.childByName(e,"VASTAdTagURI");for(null!=w?E.nextWrapperURL=this.parseNodeText(w):null!=(w=this.childByName(e,"VASTAdTagURL"))&&(E.nextWrapperURL=this.parseNodeText(this.childByName(w,"URL"))),n=0,d=(m=E.creatives).length;n<d;n++)if("linear"===(p=(b=m[n]).type)||"nonlinear"===p){if(null!=b.trackingEvents)for(s in E.trackingEvents||(E.trackingEvents={}),(t=E.trackingEvents)[p=b.type]||(t[p]={}),v=b.trackingEvents)for(k=v[s],(i=E.trackingEvents[b.type])[s]||(i[s]=[]),r=0,c=k.length;r<c;r++)f=k[r],E.trackingEvents[b.type][s].push(f);if(null!=b.videoClickTrackingURLTemplates)for(E.videoClickTrackingURLTemplates||(E.videoClickTrackingURLTemplates=[]),o=0,u=(g=b.videoClickTrackingURLTemplates).length;o<u;o++)a=g[o],E.videoClickTrackingURLTemplates.push(a);if(null!=b.videoClickThroughURLTemplate&&(E.videoClickThroughURLTemplate=b.videoClickThroughURLTemplate),null!=b.videoCustomClickURLTemplates)for(E.videoCustomClickURLTemplates||(E.videoCustomClickURLTemplates=[]),l=0,h=(y=b.videoCustomClickURLTemplates).length;l<h;l++)a=y[l],E.videoCustomClickURLTemplates.push(a)}if(null!=E.nextWrapperURL)return E},C.parseInLineElement=function(e){var t,i,s,n,a,r,o,l,d,c,u,h,m,p,v,g=new y;for(g.id=e.getAttribute("id")||null,g.sequence=e.getAttribute("sequence")||null,r=0,d=(m=e.childNodes).length;r<d;r++)switch((h=m[r]).nodeName){case"Error":g.errorURLTemplates.push(this.parseNodeText(h));break;case"Impression":g.impressionURLTemplates.push(this.parseNodeText(h));break;case"ViewableImpression":(a=C.parseViewableImpressions(h)).viewable&&(g.viewableImpressionURLTemplates.viewable=g.viewableImpressionURLTemplates.viewable.concat(a.viewable)),a.notViewable&&(g.viewableImpressionURLTemplates.notViewable=g.viewableImpressionURLTemplates.notViewable.concat(a.notViewable)),a.viewUndetermined&&(g.viewableImpressionURLTemplates.viewUndetermined=g.viewableImpressionURLTemplates.viewUndetermined.concat(a.viewUndetermined));break;case"Creatives":for(o=0,c=(p=this.childsByName(h,"Creative")).length;o<c;o++)for(i={id:(s=p[o]).getAttribute("id")||null,adId:this.parseCreativeAdIdAttribute(s),sequence:s.getAttribute("sequence")||null,apiFramework:s.getAttribute("apiFramework")||null},l=0,u=(v=s.childNodes).length;l<u;l++)switch((n=v[l]).nodeName){case"Linear":(t=this.parseCreativeLinearElement(n,i))&&g.creatives.push(t);break;case"NonLinearAds":(t=this.parseNonLinear(n,i))&&g.creatives.push(t);break;case"CompanionAds":(t=this.parseCompanionAd(n,i))&&g.creatives.push(t)}break;case"Extensions":this.parseExtension(g.extensions,this.childsByName(h,"Extension"));break;case"AdSystem":g.system={value:this.parseNodeText(h),version:h.getAttribute("version")||null};break;case"AdTitle":g.title=this.parseNodeText(h);break;case"Description":g.description=this.parseNodeText(h);break;case"Advertiser":g.advertiser=this.parseNodeText(h);break;case"Pricing":g.pricing={value:this.parseNodeText(h),model:h.getAttribute("model")||null,currency:h.getAttribute("currency")||null};break;case"Survey":g.survey=this.parseNodeText(h)}return g},C.parseExtension=function(e,t){for(var i,s,n,a,r,o,l,d,c,u,h,m,p,v,g,y,f=[],k=0,b=t.length;k<b;k++){if(r=t[k],s=new E,r.attributes)for(l=0,u=(p=r.attributes).length;l<u;l++)o=p[l],s.attributes[o.nodeName]=o.nodeValue;for(d=0,h=(v=r.childNodes).length;d<h;d++)if(i=v[d],y=this.parseNodeText(i),"#comment"!==i.nodeName&&""!==y){if((n=new w).name=i.nodeName,n.value=y,i.attributes)for(c=0,m=(g=i.attributes).length;c<m;c++)a=g[c],n.attributes[a.nodeName]=a.nodeValue;s.children.push(n)}f.push(e.push(s))}return f},C.parseCreativeLinearElement=function(e,t){var i,s,n,a,r,o,l,d,c,u,h,m,p,v,g,y,f,k,b,E,w,C,T,I,A,L,N,x,M,R,U,D,_,V,S,B,P,F,O,H,j,W,q,z,X,Q,J,G,Y,K,$,Z,ee=new te(t);if(ee.duration=this.parseDuration(this.parseNodeText(this.childByName(e,"Duration"))),-1===ee.duration&&"Wrapper"!==e.parentNode.parentNode.parentNode.nodeName)return null;if(null==(Z=e.getAttribute("skipoffset"))?ee.skipDelay=null:"%"===Z.charAt(Z.length-1)?(t=parseInt(Z,10),ee.skipDelay=ee.duration*(t/100)):ee.skipDelay=this.parseDuration(Z),null!=(Z=this.childByName(e,"VideoClicks"))){for(ee.videoClickThroughURLTemplate=this.parseNodeText(this.childByName(Z,"ClickThrough")),r=0,v=(S=this.childsByName(Z,"ClickTracking")).length;r<v;r++)i=S[r],ee.videoClickTrackingURLTemplates.push(this.parseNodeText(i));for(h=0,g=(B=this.childsByName(Z,"CustomClick")).length;h<g;h++)s=B[h],ee.videoCustomClickURLTemplates.push(this.parseNodeText(s))}for(null!=(Z=this.childByName(e,"AdParameters"))&&(ee.adParameters=this.parseNodeText(Z)),m=0,f=(F=this.childsByName(e,"TrackingEvents")).length;m<f;m++)for(K=F[m],p=0,k=(O=this.childsByName(K,"Tracking")).length;p<k;p++)if(n=(Y=O[p]).getAttribute("event"),$=this.parseNodeText(Y),null!=n&&null!=$){if("progress"===n){if(!(U=Y.getAttribute("offset")))continue;n="%"===U.charAt(U.length-1)?"progress-"+U:"progress-"+Math.round(this.parseDuration(U))}null==(U=ee.trackingEvents)[n]&&(U[n]=[]),ee.trackingEvents[n].push($)}for(A=0,b=(H=this.childsByName(e,"MediaFiles")).length;A<b;A++)for(x=H[A],M=0,E=(j=this.childsByName(x,"MediaFile")).length;M<E;M++)N=j[M],(L=new ie).id=N.getAttribute("id"),L.fileURL=this.parseNodeText(N),L.deliveryType=N.getAttribute("delivery"),L.codec=N.getAttribute("codec"),L.mimeType=N.getAttribute("type"),L.apiFramework=N.getAttribute("apiFramework"),L.bitrate=parseInt(N.getAttribute("bitrate")||0),L.minBitrate=parseInt(N.getAttribute("minBitrate")||0),L.maxBitrate=parseInt(N.getAttribute("maxBitrate")||0),L.width=parseInt(N.getAttribute("width")||0),L.height=parseInt(N.getAttribute("height")||0),(J=N.getAttribute("scalable"))&&"string"==typeof J&&("true"===(J=J.toLowerCase())?L.scalable=!0:"false"===J&&(L.scalable=!1)),(N=N.getAttribute("maintainAspectRatio"))&&"string"==typeof N&&("true"===(N=N.toLowerCase())?L.maintainAspectRatio=!0:"false"===N&&(L.maintainAspectRatio=!1)),ee.mediaFiles.push(L);if(null!=(e=this.childByName(e,"Icons")))for(R=0,w=(W=this.childsByName(e,"Icon")).length;R<w;R++){for(c=W[R],(o=new se).program=c.getAttribute("program"),o.height=parseInt(c.getAttribute("height")||0),o.width=parseInt(c.getAttribute("width")||0),o.xPosition=this.parseXPosition(c.getAttribute("xPosition")),o.yPosition=this.parseYPosition(c.getAttribute("yPosition")),o.apiFramework=c.getAttribute("apiFramework"),o.offset=this.parseDuration(c.getAttribute("offset")),o.duration=this.parseDuration(c.getAttribute("duration")),D=0,C=(q=this.childsByName(c,"HTMLResource")).length;D<C;D++)a=q[D],o.type=a.getAttribute("creativeType")||"text/html",o.htmlResource=this.parseNodeText(a);for(_=0,T=(z=this.childsByName(c,"IFrameResource")).length;_<T;_++)u=z[_],o.type=u.getAttribute("creativeType")||0,o.iframeResource=this.parseNodeText(u);for(V=0,I=(X=this.childsByName(c,"StaticResource")).length;V<I;V++)G=X[V],o.type=G.getAttribute("creativeType")||0,o.staticResource=this.parseNodeText(G);if(null!=(d=this.childByName(c,"IconClicks")))for(o.iconClickThroughURLTemplate=this.parseNodeText(this.childByName(d,"IconClickThrough")),Q=0,y=(P=this.childsByName(d,"IconClickTracking")).length;Q<y;Q++)l=P[Q],o.iconClickTrackingURLTemplates.push(this.parseNodeText(l));o.iconViewTrackingURLTemplate=this.parseNodeText(this.childByName(c,"IconViewTracking")),ee.icons.push(o)}return ee},C.parseNonLinear=function(e,t){for(var i,s,n,a,r,o,l,d,c,u,h,m,p,v,g,y,f,k,b,E,w,C,T,I,A,L,N,x,M,R=new V(t),U=this.childsByName(e,"TrackingEvents"),D=0,_=U.length;D<_;D++)for(x=U[D],o=0,c=(E=this.childsByName(x,"Tracking")).length;o<c;o++)n=(N=E[o]).getAttribute("event"),M=this.parseNodeText(N),null!=n&&null!=M&&(null==(N=R.trackingEvents)[n]&&(N[n]=[]),R.trackingEvents[n].push(M));for(l=0,u=(w=this.childsByName(e,"NonLinear")).length;l<u;l++){for(k=w[l],(f=new S).id=k.getAttribute("id")||null,f.width=k.getAttribute("width"),f.height=k.getAttribute("height"),f.expandedWidth=k.getAttribute("expandedWidth"),f.expandedHeight=k.getAttribute("expandedHeight"),f.scalable=this.parseBoolean(k.getAttribute("scalable")),f.maintainAspectRatio=this.parseBoolean(k.getAttribute("maintainAspectRatio")),f.minSuggestedDuration=this.parseDuration(k.getAttribute("minSuggestedDuration")),f.apiFramework=k.getAttribute("apiFramework"),d=0,h=(C=this.childsByName(k,"HTMLResource")).length;d<h;d++)a=C[d],f.type=a.getAttribute("creativeType")||"text/html",f.htmlResource=this.parseNodeText(a);for(g=0,m=(T=this.childsByName(k,"IFrameResource")).length;g<m;g++)r=T[g],f.type=r.getAttribute("creativeType")||0,f.iframeResource=this.parseNodeText(r);for(y=0,p=(I=this.childsByName(k,"StaticResource")).length;y<p;y++)L=I[y],f.type=L.getAttribute("creativeType")||0,f.staticResource=this.parseNodeText(L);for(null!=(i=this.childByName(k,"AdParameters"))&&(f.adParameters=this.parseNodeText(i)),f.nonlinearClickThroughURLTemplate=this.parseNodeText(this.childByName(k,"NonLinearClickThrough")),b=0,v=(A=this.childsByName(k,"NonLinearClickTracking")).length;b<v;b++)s=A[b],f.nonlinearClickTrackingURLTemplates.push(this.parseNodeText(s));R.variations.push(f)}return R},C.parseCompanionAd=function(e,t){for(var i,s,n,a,r,o,l,d,c,u,h,m,p,v,g,y,f,k,b,E,w,C,T,I,A,L,N,x,M,R,U,D,_=new P(t),V=this.childsByName(e,"Companion"),S=0,B=V.length;S<B;S++){for(a=V[S],(n=new F).id=a.getAttribute("id")||null,n.width=a.getAttribute("width"),n.height=a.getAttribute("height"),n.title=a.getAttribute("title"),n.price=a.getAttribute("price"),n.companionClickTrackingURLTemplates=[],d=0,h=(C=this.childsByName(a,"HTMLResource")).length;d<h;d++)o=C[d],n.type=o.getAttribute("creativeType")||"text/html",n.htmlResource=this.parseNodeText(o);for(c=0,m=(T=this.childsByName(a,"IFrameResource")).length;c<m;c++)l=T[c],n.type=l.getAttribute("creativeType")||0,n.iframeResource=this.parseNodeText(l);for(u=0,p=(I=this.childsByName(a,"StaticResource")).length;u<p;u++){for(M=I[u],n.type=M.getAttribute("creativeType")||0,k=0,v=(A=this.childsByName(a,"AltText")).length;k<v;k++)i=A[k],n.altText=this.parseNodeText(i);n.staticResource=this.parseNodeText(M)}for(b=0,g=(L=this.childsByName(a,"TrackingEvents")).length;b<g;b++)for(U=L[b],E=0,y=(N=this.childsByName(U,"Tracking")).length;E<y;E++)r=(R=N[E]).getAttribute("event"),D=this.parseNodeText(R),null!=r&&null!=D&&(null==(R=n.trackingEvents)[r]&&(R[r]=[]),n.trackingEvents[r].push(D));for(w=0,f=(x=this.childsByName(a,"CompanionClickTracking")).length;w<f;w++)s=x[w],n.companionClickTrackingURLTemplates.push(this.parseNodeText(s));n.companionClickThroughURLTemplate=this.parseNodeText(this.childByName(a,"CompanionClickThrough")),n.companionClickTrackingURLTemplate=this.parseNodeText(this.childByName(a,"CompanionClickTracking")),_.variations.push(n)}return _},C.parseDuration=function(e){var t,i;return null==e?-1:f.isNumeric(e)?parseInt(e):3!==(t=e.split(":")).length?-1:(i=t[2].split("."),e=parseInt(i[0]),2===i.length&&(e+=parseFloat("0."+i[1])),i=parseInt(60*t[1]),t=parseInt(60*t[0]*60),60<e&&(i+=Math.floor(e/60),e%=60),isNaN(t)||isNaN(i)||isNaN(e)||3600<i||60<e?-1:t+i+e)},C.parseXPosition=function(e){return"left"===e||"right"===e||"center"===e?e:parseInt(e||0)},C.parseYPosition=function(e){return"top"===e||"bottom"===e||"middle"===e?e:parseInt(e||0)},C.parseBoolean=function(e){return"true"===e||"TRUE"===e||"1"===e},C.parseNodeText=function(e){return e&&(e.textContent||e.text||"").trim()},C.copyNodeAttribute=function(e,t,i){t=t.getAttribute(e);if(t)return i.setAttribute(e,t)},C.parseCreativeAdIdAttribute=function(e){return e.getAttribute("AdID")||e.getAttribute("adID")||e.getAttribute("adId")||null},C.parseViewableImpressions=function(e){for(var t,i={viewable:[],notViewable:[],viewUndetermined:[]},s=void 0,n=void 0,n=0,a=(s=e.childNodes).length;n<a;n++)switch((t=s[n]).nodeName){case"Viewable":i.viewable.push(this.parseNodeText(t));break;case"NotViewable":i.notViewable.push(this.parseNodeText(t));break;case"ViewUndetermined":i.viewUndetermined.push(this.parseNodeText(t))}return i},C.parseAdVerifications=function(e){for(var t,i,s,n,a={},r=void 0,o=void 0,l=void 0,o=0,d=(r=e.childNodes).length;o<d;o++)if("Verification"===(s=r[o]).nodeName)for(l=0,i=(t=s.childNodes).length;l<i;l++)switch((n=t[l]).nodeName){case"JavaScriptResource":a.adVerifications.push(this.parseNodeText(n));break;case"ViewableImpression":a.viewableImpressions=C.parseViewableImpressions(e)}return a};var T=C,I=(_createClass(A,[{key:"read",value:function(){var t=this,n=this;return new Promise(function(i,s){var e;t.vastXML?(e=(new DOMParser).parseFromString(t.vastXML,"text/xml"),T.load(e,function(e,t){e?s(e):(n.vast=t,i(t))})):s(new Error(n.parseError.join("")))})}},{key:"setAdsMedias",value:function(){var w=this;return new Promise(function(e,t){for(var i=0,s=w.vast.ads,n=s.length,a=0;a<n;a++){var r=s[a].creatives||w.parseError.push("No Creatives for ad "+(a+1));if(r&&0!==r.length){i++;var o,l=r.length,d=0,c=[],u=void 0;for(s[a].system&&s[a].system.value?u=s[a].system.value:c.push("AdSystem "),s[a].title?s[a].title:c.push("AdTitle "),0===s[a].impressionURLTemplates.length&&c.push("Impression "),1<c.length&&((o=["Missing tags at ad "+(a+1)+":"]).push(c.join(",")),w.parseError.push(o.join("")));d<l;d++){var h=void 0;if(r[d].duration?h=r[d].duration:"companion"!==r[d].type&&w.parseError.push("Duration tag is missing at creative "+i+"."),h||"companion"===r[d].type){if(r[d].mediaFiles)for(var m=r[d].mediaFiles,p=m.length,v=0;v<p;v++){var g,y={duration:h,adParameters:r[d].adParameters,trackingEvents:r[d].trackingEvents,videoClickThroughURLTemplate:r[d].videoClickThroughURLTemplate,videoClickTrackingURLTemplates:r[d].videoClickTrackingURLTemplates,impressions:s[a].impressionURLTemplates.concat(w.pixels),jsTrackers:w.jsTrackers,error:s[a].errorURLTemplates,system:u,viewableImpressions:s[a].viewableImpressionURLTemplates,adVerifications:s[a].adVerifications};for(g in w.medias.push(y),m[v])m[v].hasOwnProperty(g)&&(w.medias[w.medias.length-1][g]=m[v][g])}if("companion"===r[d].type)for(var f=r[d].variations,k=f.length,b=0;b<k;b++){var E={required:f[b].required,id:f[b].id,width:f[b].width,height:f[b].height,assetWidth:f[b].assetWidth,assetHeight:f[b].assetHeight,expandedWidth:f[b].expandedWidth,expandedHeight:f[b].expandedHeight,apiFramework:f[b].apiFramework,adslotID:f[b].adslotID,pxratio:f[b].pxratio,altText:f[b].altText,type:f[b].type,staticResource:f[b].staticResource,htmlResource:f[b].htmlResource,iframeResource:f[b].iframeResource,companionClickThroughURLTemplate:f[b].companionClickThroughURLTemplate,companionClickTrackingURLTemplates:f[b].companionClickTrackingURLTemplates,trackingEvents:f[b].trackingEvents,title:f[b].title,price:f[b].price};w.companionAds.push(E)}}}}}0===i?(w.parseError.push("No valid creatives found - check duration tag"),t(new Error(w.parseError.join("")))):0===w.medias.length?(w.parseError.push("No valid medias found"),t(new Error(w.parseError.join("")))):1<w.parseError.length?(w.parseError.unshift(new String("Warning - ")),e(new Error(w.parseError.join("")))):e()})}}]),A);function A(e,t,i){_classCallCheck(this,A),this.vastXML=e,this.pixels=t,this.jsTrackers=i,this.vast=null,this.medias=[],this.companionAds=[],this.parseError=["Vast validator - "]}var L=["handshakeVersion","initAd","startAd","stopAd","skipAd","resizeAd","pauseAd","resumeAd","expandAd","collapseAd","subscribe","unsubscribe"];function N(e,t,i){}N.prototype.handshakeVersion=function(e,t){},N.prototype.initAd=function(e,t,i,s,n,a,r){},N.prototype.startAd=function(e){},N.prototype.stopAd=function(e){},N.prototype.skipAd=function(e){},N.prototype.resizeAd=function(e,t,i,s){},N.prototype.pauseAd=function(e){},N.prototype.resumeAd=function(e){},N.prototype.expandAd=function(e){},N.prototype.collapseAd=function(e){},N.prototype.subscribe=function(e,t,i){},N.prototype.unsubscribe=function(e,t){},N.prototype.getAdLinear=function(e){},N.prototype.getAdWidth=function(e){},N.prototype.getAdHeight=function(e){},N.prototype.getAdExpanded=function(e){},N.prototype.getAdSkippableState=function(e){},N.prototype.getAdRemainingTime=function(e){},N.prototype.getAdDuration=function(e){},N.prototype.getAdVolume=function(e){},N.prototype.getAdCompanions=function(e){},N.prototype.getAdIcons=function(e){},N.prototype.setAdVolume=function(e,t){},M(N,"METHODS",L),M(N,"GETTERS",["getAdLinear","getAdWidth","getAdHeight","getAdExpanded","getAdSkippableState","getAdRemainingTime","getAdDuration","getAdVolume","getAdCompanions","getAdIcons"]),M(N,"SETTERS",["setAdVolume"]),M(N,"EVENTS",["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"]);var x=L.filter(function(e){return-1===["skipAd"].indexOf(e)});function M(e,t,i){Object.defineProperty(e,t,{writable:!1,configurable:!1,value:i})}function R(){this._subscribers={}}function U(){}function D(e,t){return e?null:new Error(t)}function _(e,t,i){var s,n,e=function(e,t,i){var s=document.createElement("iframe");s.src=t||"about:blank",s.marginWidth="0",s.marginHeight="0",s.frameBorder="0",s.width="100%",s.height="100%",B(s),i&&(s.style.zIndex=i);return s.setAttribute("SCROLLING","NO"),e.innerHTML="",e.appendChild(s),s}(e,null,i.zIndex);if(function(e,t){e=e.contentWindow&&e.contentWindow.document;return!!e&&(e.write(t),!0)}(e,(s=t,n=i,Object.keys(n).forEach(function(e){var t="object"===(void 0===t?"undefined":_typeof(t))?JSON.stringify(n[e]):n[e];s=s.replace(new RegExp("{{"+e+"}}","g"),t)}),s)))return e}function B(e){e&&(e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.margin="0px",e.style.padding="0px",e.style.border="none",e.style.width="100%",e.style.height="100%")}function O(t,i){return Object.keys(i).forEach(function(e){t[e]=i[e]}),t}M(N,"checkVPAIDInterface",function(t){return x.every(function(e){return"function"==typeof t[e]})}),R.prototype.subscribe=function(e,t,i){this.isHandlerAttached(e,t)||this.get(t).push({handler:e,context:i,eventName:t})},R.prototype.unsubscribe=function(t,e){this._subscribers[e]=this.get(e).filter(function(e){return t!==e.handler})},R.prototype.unsubscribeAll=function(){this._subscribers={}},R.prototype.trigger=function(e,t){var i=this;this.get(e).concat(this.get("*")).forEach(function(e){setTimeout(function(){i.isHandlerAttached(e.handler,e.eventName)&&e.handler.call(e.context,t)},0)})},R.prototype.triggerSync=function(e,t){this.get(e).concat(this.get("*")).forEach(function(e){e.handler.call(e.context,t)})},R.prototype.get=function(e){return this._subscribers[e]||(this._subscribers[e]=[]),this._subscribers[e]},R.prototype.isHandlerAttached=function(t,e){return this.get(e).some(function(e){return t===e.handler})};var H=N.checkVPAIDInterface,j="AdClickThru",W=N.EVENTS.filter(function(e){return e!=j});function q(e,t,i,s){this._isValid=H(e),this._isValid&&(this._creative=e,this._el=t,this._videoEl=i,this._iframe=s,this._subscribers=new R,B(t),function(){{var t,i;W.forEach(function(e){this._creative.subscribe(function(e){this._subscribers.trigger(e,Array.prototype.slice(arguments,1))}.bind(this,e),e)}.bind(this)),this._creative.subscribe(function(e,t,i){this._subscribers.triggerSync(j,{url:e,id:t,playerHandles:i})}.bind(this),j),this._videoEl&&(t=this._iframe.contentDocument.documentElement,i=this._videoEl,t.addEventListener("click",function(e){e.target===t&&i.click()}))}}.call(this))}function z(e,t,i,s){e?e(i,s):i&&t.trigger("AdError",i)}(q.prototype=Object.create(N.prototype)).isValidVPAIDAd=function(){return this._isValid},N.METHODS.forEach(function(n){-1===["subscribe","unsubscribe","initAd"].indexOf(n)&&(q.prototype[n]=function(){var e=N.prototype[n].length,i=Array.prototype.slice.call(arguments),s=e===i.length?i.pop():void 0;setTimeout(function(){var e,t=null;try{e=this._creative[n].apply(this._creative,i)}catch(e){t=e}z(s,this._subscribers,t,e)}.bind(this),0)})}),q.prototype.initAd=function(e,i,s,n,a,r,o){a=a||{},r=O({slot:this._el,videoSlot:this._videoEl},r||{}),setTimeout(function(){var t;try{this._creative.initAd(e,i,s,n,a,r)}catch(e){t=e}z(o,this._subscribers,t)}.bind(this),0)},q.prototype.subscribe=function(e,t,i){this._subscribers.subscribe(t,e,i)},q.prototype.unsubscribe=function(e,t){this._subscribers.unsubscribe(t,e)},q.prototype.on=q.prototype.subscribe,q.prototype.off=q.prototype.unsubscribe,N.GETTERS.forEach(function(s){q.prototype[s]=function(i){setTimeout(function(){var e,t=null;try{e=this._creative[s]()}catch(e){t=e}z(i,this._subscribers,t,e)}.bind(this),0)}}),q.prototype.setAdVolume=function(s,n){setTimeout(function(){var e,t=this,i=null;try{this._creative.setAdVolume(s),e=this._creative.getAdVolume()}catch(e){i=e}setTimeout(function(){i=i||D(e===s,"failed to apply volume: "+s),z(n,t._subscribers,i,e)},200)}.bind(this),0)},q.prototype._destroy=function(){this.stopAd(),this._subscribers.unsubscribeAll()};var X,Q,J=(X="vpaidIframe",Q=-1,function(){return X+"_"+ ++Q});function G(e,t,i,s){var n,a;i=i||{},this._id=J(),this._destroyed=!1,this._frameContainer=(n=e,e="div",e=document.createElement(e),a&&(e.id=a),n.appendChild(e),e),this._videoEl=t,this._vpaidOptions=s||{timeout:1e4},this._templateConfig={template:i.template||'<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"></head><body style="margin:0;padding:0"><div class="ad-element"></div><script type="text/javascript" src="{{iframeURL_JS}}"><\/script><script type="text/javascript">window.parent.postMessage(\'{"event": "ready", "id": "{{iframeID}}"}\', \'{{origin}}\');<\/script></body></html>',extraOptions:i.extraOptions||{}}}function Y(){K.call(this),function(){this._adUnit&&(this._adUnit.stopAd(),delete this._adUnit)}.call(this)}function K(){!function(e){var t=this[e];t&&t.parentNode&&(t.parentNode.removeChild(t),delete this[e])}.call(this,"_frame"),$.call(this)}function $(){this._onLoad&&(window.removeEventListener("message",this._onLoad),delete this._onLoad)}function Z(){return window.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}G.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,Y.call(this))},G.prototype.isDestroyed=function(){return this._destroyed},G.prototype.loadAdUnit=function(e,n){var a,t,i,s;this._onLoad||(function(){if(this._destroyed)throw new Error("VPAIDHTML5Client already destroyed!")}.call(this),Y.call(this),e=_((a=this)._frameContainer,this._templateConfig.template,O({iframeURL_JS:e,iframeID:this.getID(),origin:Z()},this._templateConfig.extraOptions)),this._frame=e,this._onLoad=(e=this._vpaidOptions.timeout,t=function(e){var t,i,s;if(e.origin===Z()&&JSON.parse(e.data).id===a.getID()){if(a._frame.contentWindow){if(i=a._frame.contentWindow.getVPAIDAd,t=D("function"==typeof i,"the ad didn't return a function to create an ad"))return}else t="the iframe is not anymore in the DOM tree";return t||(s=a._frame.contentWindow.document.querySelector(".ad-element"),(s=new q(i(),s,a._videoEl,a._frame)).subscribe("AdStopped",function(){K.call(this),delete this._adUnit}.bind(a)),t=D(s.isValidVPAIDAd(),"the ad is not fully compliant with VPAID specification")),a._adUnit=s,$.call(a),n(t,t?null:s),!0}}.bind(this),i=function(){}.bind(this),s=setTimeout(function(){t=U,i()},e),function(){t.apply(this,arguments)&&clearTimeout(s)}),window.addEventListener("message",this._onLoad))},G.prototype.unloadAdUnit=function(){Y.call(this)},G.prototype.getID=function(){return this._id};var ee=(_createClass(ne,[{key:"init",value:function(){var n=this;return this.initializing=!0,new Promise(function(e,t){var i=n.videoContainer,s='<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"></head><body style="margin:0;padding:0"><div class="ad-element"></div><script type="text/javascript" src="{{iframeURL_JS}}"><\/script><script type="text/javascript">window.parent.postMessage(\'{"event": "ready", "id": "{{iframeID}}"}\', \''+(window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""))+"');<\/script></body></html>";i.content.elm.classList.add(n.style.vpaidClass),i.video.elm.setAttribute("playsinline","true"),n.bridge=new G(i.content.elm,i.video.elm,{template:s}),n.bridge.loadAdUnit(n.media.fileURL,n.onload.bind(n,e,t))})}},{key:"onload",value:function(e,t,i,s){var n=this;i?t(i):((this.adUnit=s)._videoEl.addEventListener("progress",this.onProgress.bind(this)),s.subscribe("AdLoaded",this.onInit.bind(this)),s.subscribe("AdError",this.onError.bind(this)),s.subscribe("AdStarted",this.onEvent.bind(this,"adstarted")),s.subscribe("AdStopped",this.onEvent.bind(this,"adstopped")),s.subscribe("AdPaused",this.onEvent.bind(this,"adpaused")),s.subscribe("AdPlaying",this.onEvent.bind(this,"adresumed")),s.subscribe("AdSkipped",this.onEvent.bind(this,"adskipped")),s.subscribe("AdVideoComplete",this.onEvent.bind(this,"adcomplete")),s.subscribe("AdVolumeChange",this.onEvent.bind(this,"advolumechanged")),s.subscribe("AdClickThru",this.onClickThru.bind(this)),s.subscribe("Overlay.click",this.onCtaClick.bind(this)),s.subscribe("AdUserClose",this.onCtaClick.bind(this)),s.subscribe("AdVideoFirstQuartile",this.onEvent.bind(this,"adfirstquartile")),s.subscribe("AdVideoMidpoint",this.onEvent.bind(this,"admidpoint")),s.subscribe("AdVideoThirdQuartile",this.onEvent.bind(this,"adthirdquartile")),s.subscribe("AdUserAcceptInvitation",this.onEvent.bind(this,"aduseracceptinvitation")),["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"].forEach(function(e){document.addEventListener(e,n.onFullscreen.bind(n))}),["fullscreenerror","webkitfullscreenerror","mozfullscreenerror","MSFullscreenError"].forEach(function(e){document.addEventListener(e,n.onFullscreenError.bind(n))}),s.handshakeVersion("2.0",this.onHandShake.bind(this)),this.shouldTrackMoat&&this.prepareMoatTracking(),e(!0))}},{key:"onHandShake",value:function(e){e?this.onError(e):this.adUnit.initAd(window.innerWidth,window.innerHeight,"normal",-1,{AdParameters:this.media.adParameters},{})}},{key:"onInit",value:function(){for(var e in this.initializing=!1,this.delayedEvents)if(this.delayedEvents.hasOwnProperty(e)){var t=this.delayedEvents[e];if(this.delayedEvents[e])switch(e){case"resize":null!==t.w&&null!==t.h&&(this.resize(t.w,t.h),t.w=0,t.h=0);break;case"mute":this.mute(),this.delayedEvents[e]=!1;break;case"unmute":this.unmute(),this.delayedEvents[e]=!1;break;case"volume":null!==t.val&&(this.volume(t.val),t.val=null);break;case"seek":null!==t.val&&(this.seek(t.val),t.val=null);break;case"stop":this.stop(),this.delayedEvents[e]=!1;break;case"pause":this.pause(),this.delayedEvents[e]=!1;break;case"resume":this.resume(),this.delayedEvents[e]=!1}}this.media&&this.media.jsTrackers&&this.jsTrackingEvent(this.media.jsTrackers),this.onEvent("ready")}},{key:"onError",value:function(e){this.error=e;e=new CustomEvent("aderror",{detail:e.message,bubbles:!1,cancelable:!0});this.videoContainer.elm.dispatchEvent(e)}},{key:"onProgress",value:function(e){var t=e.srcElement.buffered;t.length&&this.broadcast("progress",{start:e.srcElement.buffered.start(t.length-1),end:e.srcElement.buffered.end(t.length-1)})}},{key:"onEvent",value:function(e){if("adstarted"===e){try{var t=this.videoContainer.video.elm;this.options.muted&&!t.muted&&this.forceMuteAfterPlay()}catch(e){}this.started=!0,this.videoStartedPlaying=!0,this.sendMoatEvent("AdVideoStart"),this.media.impressions&&this.trackingEvents(this.media.impressions),this.media.trackingEvents.start&&this.trackingEvents(this.media.trackingEvents.start)}"aduserclose"===e&&(this.playing=!1,this.media.trackingEvents.close&&this.trackingEvents(this.media.trackingEvents.close)),"adstopped"===e&&this.sendMoatEvent("AdStopped"),"adpaused"===e&&(this.playing=!1,this.sendMoatEvent("AdPaused")),"adresumed"===e&&(this.playing=!0,this.sendMoatEvent("AdPlaying")),"adcomplete"===e&&(this.playing=!1,this.started=!1,this.media.trackingEvents.complete&&this.trackingEvents(this.media.trackingEvents.complete),this.sendMoatEvent("AdVideoComplete")),"adfirstquartile"===e&&(this.playing=!0,this.media.trackingEvents.firstQuartile&&this.trackingEvents(this.media.trackingEvents.firstQuartile),this.sendMoatEvent("AdVideoFirstQuartile")),"admidpoint"===e&&(this.playing=!0,this.media.trackingEvents.midpoint&&this.trackingEvents(this.media.trackingEvents.midpoint),this.sendMoatEvent("AdVideoMidpoint")),"adthirdquartile"===e&&(this.playing=!0,this.media.trackingEvents.thirdQuartile&&this.trackingEvents(this.media.trackingEvents.thirdQuartile),this.sendMoatEvent("AdVideoThirdQuartile")),"aduseracceptinvitation"===e&&this.media.trackingEvents.acceptInvitation&&this.trackingEvents(this.media.trackingEvents.acceptInvitation);t=new CustomEvent(e,{bubbles:!1,cancelable:!0});this.videoContainer.elm.dispatchEvent(t),this.broadcast(e)}},{key:"onClickThru",value:function(e){var t=new CustomEvent("adclick",{bubbles:!1,cancelable:!0});this.videoContainer.elm.dispatchEvent(t),e.playerHandles&&(this.media.videoClickTrackingURLTemplates&&this.trackingEvents(this.media.videoClickTrackingURLTemplates),window.open(e.url,"_blank"))}},{key:"sendMoatEvent",value:function(e){this.moatTracker&&(e={type:e,adVolume:this.getVolume()},this.moatTracker.dispatchEvent(e))}},{key:"onCtaClick",value:function(){}},{key:"onFullscreen",value:function(e){var t;e.target.id===this.id&&((t=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen)?this.videoContainer.elm.classList.add("omp-expanded"):this.videoContainer.elm.classList.remove("omp-expanded"),e=t?"enterfullscreen":"exitfullscreen",t&&this.media.trackingEvents.fullscreen&&this.trackingEvents(this.media.trackingEvents.fullscreen),this.onEvent(e))}},{key:"onFullscreenError",value:function(e){e=new CustomEvent("playererror",{detail:e,bubbles:!1,cancelable:!0});this.videoContainer.elm.dispatchEvent(e),this.broadcast("fullscreenerrror")}},{key:"onPlayingMediaError",value:function(e){e=new CustomEvent("playererror",{detail:e,bubbles:!1,cancelable:!0});this.videoContainer.elm.dispatchEvent(e),this.broadcast("playererror")}},{key:"hasFullscreen",value:function(){var e=this.videoContainer.elm;return e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen}},{key:"subscribe",value:function(e,t){this.subscriptions.hasOwnProperty(e)&&this.subscriptions[e].push(t)}},{key:"broadcast",value:function(e){if(this.subscriptions.hasOwnProperty(e)){for(var t,i=this.subscriptions[e].length,s=0,n=arguments.length,a=Array(1<n?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];for(;s<i;s++)(t=this.subscriptions[e])[s].apply(t,[e].concat(a))}}},{key:"replaceMacros",value:function(e){return e.replace("{ivc_ad_id}",this.validateMacros(this.recData.adId)).replace("{ivc_widget_name}",this.validateMacros(this.recData.widgetID)).replace("{ivc_widget_id}",this.validateMacros(this.recData.widgetNumberId)).replace("{ivc_ad_title}",this.validateMacros(this.recData.title)).replace("{ivc_source_id}",this.validateMacros(this.recData.sourceId)).replace("{ivc_req_id}",this.validateMacros(this.recData.reqId)).replace("{ivc_campaign_id}",this.validateMacros(this.recData.campaignId)).replace("{ivc_publisher_id}",this.validateMacros(this.recData.publisherId)).replace("{ivc_publisher_name}",this.validateMacros(this.recData.publisherName)).replace("{ivc_adv_name}",this.validateMacros(this.recData.sourceName)).replace("{ivc_time_stamp}",this.validateMacros(this.recData.timestamp)).replace("{ivc_doc_id}",this.validateMacros(this.recData.did)).replace("{ivc_ext_ad_id}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.adId):"").replace("{ivc_ext_source_id}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.sourceId):"").replace("{ivc_ext_campaign_id}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.campaignId):"").replace("{ivc_ext_publisher_id}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.publisherId):"").replace("{ivc_ext_doc_id}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.did):"").replace("{{ad_id}}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.adId):"").replace("{{widget_name}}",this.validateMacros(this.recData.widgetID)).replace("{{widget_id}}",this.validateMacros(this.recData.widgetNumberId)).replace("{{ad_title}}",this.validateMacros(this.recData.title)).replace("{{section_id}}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.sourceId):"").replace("{{req_id}}",this.validateMacros(this.recData.reqId)).replace("{{campaign_id}}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.campaignId):"").replace("{{publisher_id}}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.publisherId):"").replace("{{publisher_name}}",this.validateMacros(this.recData.publisherName)).replace("{{adv_name}}",this.validateMacros(this.recData.sourceName)).replace("{{time_stamp}}",this.validateMacros(this.recData.timestamp)).replace("{{doc_id}}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.did):"").replace("{ivc_ob_click_id}",this.validateMacros(this.recData.obClickId)).replace("{{ob_click_id}}",this.validateMacros(this.recData.obClickId)).replace("{{time_stamp}}",Date.now().toString())}},{key:"validateMacros",value:function(e){return e||""}},{key:"prepareMoatTracking",value:function(){var e=this.videoContainer.elm,t={level1:this.options.publisherId,level2:this.options.publisherName,level3:this.options.widgetId,level4:this.options.domain,slicer1:this.options.partnerId,slicer2:this.options.marketerName},i=this.getAdDuration();this.moatTracker=this.initMoatTracking(e,t,i,"zemantajsvideo256634828520")}},{key:"initMoatTracking",value:function(e,t,i,s,n,a){var r,o,l=document.createElement("script"),d=[],c={vidIntType:"3",vidIntVersion:"1.0",adData:{ids:t,duration:i,url:n},dispatchEvent:function(e){c.sendEvent?(d&&(d.push(e),e=d,d=!1),c.sendEvent(e)):d&&d.push(e)},clientCallback:a};t="_moatApi"+Math.floor(1e8*Math.random());try{o=(r=e.ownerDocument).defaultView||r.parentWindow}catch(e){r=document,o=window}return o[t]=c,l.type="text/javascript",e&&e.insertBefore(l,e.childNodes[0]||null),l.src="https://z.moatads.com/"+s+"/moatvideo.js#"+t,c}},{key:"trackingEvents",value:function(e){for(var t=0;t<e.length;t++){var i=this.recData?this.replaceMacros(e[t]):e[t];(new Image).src=i;i=new CustomEvent("pixelfired",{detail:i,bubbles:!1,cancelable:!0});this.videoContainer.elm.dispatchEvent(i),this.broadcast("pixelfired")}}},{key:"jsTrackingEvent",value:function(e){for(var t=this.videoContainer.video.elm.parentElement,i=0;i<e.length;i++){var s=document.createElement("script");s.setAttribute("type","text/javascript"),s.src=e[i],t.appendChild(s);s=new CustomEvent("jsTrackerAdded",{detail:e[i],bubbles:!1,cancelable:!0});this.videoContainer.elm.dispatchEvent(s),this.broadcast("jsTrackerAdded")}}},{key:"play",value:function(){this.adUnit.startAd(),this.playing=!0}},{key:"stop",value:function(){try{this.adUnit._videoEl.pause(),this.adUnit.stopAd(),this.playing=!1}catch(e){return this.onPlayingMediaError(new Error("No video element in VPAID"))}}},{key:"pause",value:function(){this.adUnit.pauseAd(),this.playing=!1,this.media.trackingEvents.pause&&this.trackingEvents(this.media.trackingEvents.pause)}},{key:"resume",value:function(){this.adUnit.resumeAd(),this.playing=!0,this.media.trackingEvents.resume&&this.trackingEvents(this.media.trackingEvents.resume)}},{key:"mute",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.adUnit._videoEl.muted=!0,this.media.trackingEvents.mute&&this.trackingEvents(this.media.trackingEvents.mute),this.currentVolume=0,e&&this.onEvent("advolumechanged"),t&&this.broadcast("mute"),this.sendMoatEvent("AdVolumeChange")}},{key:"unmute",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.adUnit&&(this.adUnit._videoEl.muted=!1,this.currentVolume=this.parent.getVolumeState(),this.media.trackingEvents.unmute&&this.trackingEvents(this.media.trackingEvents.unmute),e&&(this.onEvent("advolumechanged"),this.sendMoatEvent("AdVolumeChange")),t&&this.broadcast("unmute"))}},{key:"forceMuteAfterPlay",value:function(){this.adUnit._videoEl.muted=!0,this.currentVolume=0;var e=new CustomEvent("playererror",{detail:{message:"sound on",canContinuePlay:!0},bubbles:!1,cancelable:!0});this.videoContainer.elm.dispatchEvent(e)}},{key:"volume",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];try{this.adUnit?(this.adUnit.setAdVolume(e),this.currentVolume=e,t&&(this.broadcast("volume"),this.sendMoatEvent("AdVolumeChange"))):this.delayedEvents.volume.val=e}catch(e){this.onError(e)}}},{key:"seek",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.adUnit?(this.adUnit._videoEl.currentTime=e,t&&this.broadcast("seek")):this.delayedEvents.seek.val=e}},{key:"fullscreen",value:function(){var e=this.videoContainer.elm;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}},{key:"collapse",value:function(){document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement?document.webkitExitFullscreen():document.mozFullScreenElement?document.mozCancelFullScreen():document.msFullscreenElement&&document.msExitFullscreen()}},{key:"resize",value:function(e,t){this.adUnit&&0<t&&0<e?this.adUnit.resizeAd(e,t,"normal"):this.delayedEvents.resize={w:e,h:t}}},{key:"destroy",value:function(){var e=new CustomEvent("destroycompleted",{bubbles:!1,cancelable:!0});this.videoContainer.elm.dispatchEvent(e)}},{key:"isMuted",value:function(){try{return this.adUnit._videoEl.muted}catch(e){return null}}},{key:"getVolume",value:function(){return this.currentVolume}},{key:"getAdPaused",value:function(){try{return this.adUnit._videoEl.paused}catch(e){return null}}},{key:"getAdErrorCode",value:function(){return this.error.errorCode}},{key:"getAdErrorMessage",value:function(){return this.error.message}},{key:"getAdMediaHeight",value:function(){try{return this.adUnit._videoEl.videoHeight}catch(e){return 0}}},{key:"getAdMediaWidth",value:function(){try{return this.adUnit._videoEl.videoWidth}catch(e){return 0}}},{key:"getAdMediaUrl",value:function(){try{return this.adUnit._videoEl.src}catch(e){return null}}},{key:"getAdTagUrl",value:function(){return this.media.fileURL}},{key:"getAdDuration",value:function(){try{var e=this.adUnit._creative.getAdDuration();return e&&0<e?e:this.media.duration}catch(e){return 0}}},{key:"getAdCurrentTime",value:function(){try{var e=this.adUnit._creative.getAdRemainingTime();return e<0&&(e=0),this.adUnit._creative.getAdDuration()-e||this.adUnit._videoEl.currentTime}catch(e){return 0}}},{key:"getAdSystem",value:function(){return this.media.system}},{key:"getVideoBitrate",value:function(){return this.media.bitrate}},{key:"getAdMediaBitrateArray",value:function(){return null}},{key:"getHeavyAdStatus",value:function(){return"vpaid"}},{key:"getAdDeliveryType",value:function(){return this.media.deliveryType}},{key:"getVastWidth",value:function(){try{return this.media.width}catch(e){return 0}}},{key:"getVastHeight",value:function(){try{return this.media.height}catch(e){return 0}}},{key:"getVideoClickThroughURL",value:function(){try{return this.media.videoClickThroughURLTemplate}catch(e){return 0}}},{key:"getVideoClickTrackingURL",value:function(){try{return this.media.videoClickTrackingURLTemplates}catch(e){return 0}}},{key:"getCompanionAds",value:function(){try{return this.companionAds}catch(e){return 0}}},{key:"updateMacros",value:function(e){try{this.recData.obClickId=e.clickId}catch(e){}}}]),ne);function ne(e,t,i){_classCallCheck(this,ne),this.parent=t,this.media=e,this.id=this.parent.id,this.recData=this.parent.options?this.parent.options.adData:void 0,this.companionAds=this.parent.video&&this.parent.video&&this.parent.video.parser&&this.parent.video.parser.companionAds?this.parent.video.parser.companionAds:void 0,this.adUnit=null,this.bridge=null,this.error=null,this.playing=!1,this.started=!1,this.shouldTrackMoat=this.parent.shouldTrackMoat,this.options=this.parent.options,this.moatTracker=null,this.videoStartedPlaying=!1,this.currentVolume=this.parent.options.muted?0:1,this.delayedEvents={resize:{w:null,h:null},mute:!1,unmute:!1,volume:{val:null},seek:{val:null},play:!1,stop:!1,pause:!1,resume:!1},this.subscriptions={ready:[],adstarted:[],adstopped:[],adpaused:[],adresumed:[],adcomplete:[],advolumechanged:[],volume:[],mute:[],unmute:[],seek:[],progress:[],enterfullscreen:[],exitfullscreen:[],fullscreenerror:[],aduseracceptinvitation:[]},this.videoContainer=i,this.initializing=!1,this.style={vpaidClass:"obp-vpaid"}}var ae=(_createClass(re,[{key:"sortMedias",value:function(){for(var e,t,i,s=this,n=0,a=this.medias.length,r=function(e){var t=(e.width/e.height).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0],i=e.width+"*"+e.height;s.sortedMedias.hasOwnProperty(t)||(s.sortedMedias[t]={}),s.sortedMedias[t].hasOwnProperty(i)||(s.sortedMedias[t][i]=[]),s.sortedAspects.indexOf(i)<0&&s.sortedAspects.push(i),s.sortedMedias[t][i].push(e)};n<a;n++)"VPAID"!==this.medias[n].apiFramework&&(e=this.medias[n].mimeType,t=this.medias[n].fileURL.split(".").pop(),e?"video/mp4"!==e&&"video/quicktime"!==e&&"application/x-mpegURL"!==e&&"application/vnd.apple.mpegurl"!==e||(this.medias[n].isSlh="application/x-mpegURL"===e||"application/vnd.apple.mpegurl"===e||"m3u8"===t.substring(0,4).toLowerCase(),r(this.medias[n])):"mp4"!==t.toLowerCase()&&"mov"!==t.toLowerCase()&&"m3u8"!==t.toLowerCase()||(this.medias[n].isSlh="m3u8"===t.toLowerCase(),r(this.medias[n])));for(i in this.sortedAspects.sort(function(e,t){var i=e.split("*"),s=t.split("*"),e=parseInt(i[0]),t=parseInt(i[1]),i=parseInt(s[0]),s=parseInt(s[1]);return e<i||t<s?1:i<e||s<t?-1:0}),this.sortedMedias)if(this.sortedMedias.hasOwnProperty(i))for(var o in this.sortedMedias[i])this.sortedMedias[i].hasOwnProperty(o)&&this.sortedMedias[i][o].sort(function(e,t){return e.hasOwnProperty("bitrate")&&t.hasOwnProperty("bitrate")?e.bitrate<t.bitrate?1:-1:0})}},{key:"setMedia",value:function(){if(this.sortedMedias&&Object.keys(this.sortedMedias).length){for(var e,t=this.sortedAspects[0],i=0;i<Object.keys(this.sortedMedias).length;i++){var s=this.sortedMedias[Object.keys(this.sortedMedias)[i]];s.hasOwnProperty(t)&&(e=s)}this.media=e[t][0]}}},{key:"setMediaByBitrate",value:function(){var s=this,n=0,a=this.getHeavyAdStatus(),r=this.getAdMediaBitrateArray();if(this.sortedMedias&&Object.keys(this.sortedMedias).length){for(var o=void 0,e=0;e<Object.keys(this.sortedMedias).length;e++)!function(e){var t,i=s.sortedMedias[Object.keys(s.sortedMedias)[e]];"reducedLarge"===a||"reducedMed"===a?(t="reducedLarge"===a?1200:800,r.some(function(e){return e<t&&n<e})&&(n=Math.max.apply(Math,_toConsumableArray(r.filter(function(e){return e<t&&n<e})))),Object.keys(i).forEach(function(e){i[e].some(function(e){return e.bitrate===n})&&(o=i[e].find(function(e){return e.bitrate===n}))})):(e=s.sortedAspects[0],i.hasOwnProperty(e)&&(o=i[e][0]))}(e);this.media=o}}},{key:"getMedia",value:function(){return this.media}},{key:"setIcons",value:function(){if(this.parser&&this.parser.vast&&this.parser.vast.ads&&this.parser.vast.ads[0]&&this.parser.vast.ads[0].creatives&&this.parser.vast.ads[0].creatives[0]&&this.parser.vast.ads[0].creatives[0].icons&&Array.isArray(this.parser.vast.ads[0].creatives[0].icons))for(var e=0;e<this.parser.vast.ads[0].creatives[0].icons.length;e++)try{this.icons.push({iconData:this.parser.vast.ads[0].creatives[0].icons[e],endTime:0<parseInt(this.parser.vast.ads[0].creatives[0].icons[e].duration)?Math.max(0,parseInt(this.parser.vast.ads[0].creatives[0].icons[e].offset))+parseInt(this.parser.vast.ads[0].creatives[0].icons[e].duration):-1,visible:!1})}catch(e){}}},{key:"init",value:function(){var s=this,n=this;return this.initializing=!0,new Promise(function(e,t){var i=n.videoContainer;i.video.elm.src=s.media.fileURL,s.media.isSlh&&!i.video.elm.canPlayType("application/vnd.apple.mpegurl")?s.loadHlsForStream(e,t):s.addListeners(e,t)})}},{key:"loadHlsForStream",value:function(e,t){var i,s,n,a,r=this;"undefined"==typeof Hls?(i="https://libs.sphere.com/video/outbrain-player/hls.min.js",s=this,"undefined"!=typeof require?(require([i],function(e){window.Hls=e,window.Date=Date}),n=20,this.hlsInterval=setInterval(function(){"undefined"!=typeof Hls&&(clearInterval(r.hlsInterval),s.loadHlsMedia(e,t)),--n<1&&(clearInterval(r.hlsInterval),t("require has not loaded hls on page"))},500)):((a=document.createElement("script")).src=i,a.onload=this.loadHlsMedia.bind(this,e,t),document.getElementsByTagName("head")[0].appendChild(a))):this.loadHlsMedia(e,t)}},{key:"loadHlsMedia",value:function(e,t){try{var i,s=this.videoContainer.video.elm;Hls.isSupported()&&((i=new Hls).loadSource(this.media.fileURL),i.attachMedia(s),s.preload="metadata",this.addListeners(e,t)),t("Could not find HLS script")}catch(e){t(e)}}},{key:"addListeners",value:function(e,t){var i=this;try{var s=this.videoContainer.video.elm;s.addEventListener("progress",this.onProgress.bind(this)),s.addEventListener("ended",this.onComplete.bind(this)),s.addEventListener("click",this.onClick.bind(this)),["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"].forEach(function(e){document.addEventListener(e,i.onFullscreen.bind(i))}),["fullscreenerror","webkitfullscreenerror","mozfullscreenerror","MSFullscreenError"].forEach(function(e){document.addEventListener(e,i.onFullscreenError.bind(i))}),e(!0),setTimeout(function(){i.onInit()},500)}catch(e){t(e)}}},{key:"onInit",value:function(){this.initializing=!1,this.media&&this.media.jsTrackers&&this.jsTrackingEvent(this.media.jsTrackers),this.onEvent("ready")}},{key:"onProgress",value:function(e){var t=e.srcElement.buffered;t.length&&this.broadcast("progress",{start:e.srcElement.buffered.start(t.length-1),end:e.srcElement.buffered.end(t.length-1)})}},{key:"onComplete",value:function(){this.end(),this.playing=!1,this.started=!1,this.media.trackingEvents.complete&&this.trackingEvents(this.media.trackingEvents.complete),this.onEvent("adcomplete")}},{key:"onClick",value:function(e){e.preventDefault(),this.pause(),this.media.videoClickThroughURLTemplate&&(this.recData?(e=this.replaceMacros(this.media.videoClickThroughURLTemplate),window.open(e,"_blank")):window.open(this.media.videoClickThroughURLTemplate,"_blank"),this.media.videoClickTrackingURLTemplates&&this.trackingEvents(this.media.videoClickTrackingURLTemplates)),this.onEvent("adclick")}},{key:"onEvent",value:function(e){var t=new CustomEvent(e,{bubbles:!1,cancelable:!0});this.videoContainer.elm.dispatchEvent(t),this.broadcast(e),this.checkMoatEvent(e)}},{key:"checkMoatEvent",value:function(e){if(this.shouldTrackMoat)switch(e){case"ready":this.prepareMoatTracking();break;case"adstarted":this.sendMoatEvent("AdVideoStart");break;case"adstopped":this.sendMoatEvent("AdStopped");break;case"adfirstquartile":this.sendMoatEvent("AdVideoFirstQuartile");break;case"admidpoint":this.sendMoatEvent("AdVideoMidpoint");break;case"adthirdquartile":this.sendMoatEvent("AdVideoThirdQuartile");break;case"adcomplete":this.sendMoatEvent("AdVideoComplete");break;case"adpaused":this.sendMoatEvent("AdPaused");break;case"adresumed":this.sendMoatEvent("AdPlaying");break;case"advolumechanged":this.sendMoatEvent("AdVolumeChange")}}},{key:"sendMoatEvent",value:function(e){this.moatTracker&&(e={type:e,adVolume:this.getVolume()},this.moatTracker.dispatchEvent(e))}},{key:"onFullscreen",value:function(e){e.target.id===this.id&&((e=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen)?this.videoContainer.elm.classList.add("omp-expanded"):this.videoContainer.elm.classList.remove("omp-expanded"),e=e?"enterfullscreen":"exitfullscreen",this.media.trackingEvents.fullscreen&&this.trackingEvents(this.media.trackingEvents.fullscreen),this.onEvent(e))}},{key:"onFullscreenError",value:function(e){e=new CustomEvent("playererror",{detail:e,bubbles:!1,cancelable:!0});this.videoContainer.elm.dispatchEvent(e),this.broadcast("fullscreenerrror")}},{key:"onPlayingMediaError",value:function(e){e=new CustomEvent("playererror",{detail:e,bubbles:!1,cancelable:!0});this.videoContainer.elm.dispatchEvent(e),this.broadcast("playererror")}},{key:"hasFullscreen",value:function(){var e=this.videoContainer.elm;return e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen}},{key:"start",value:function(){var i=this;this.end(),this.started=!0,this.videoInterval=setInterval(function(){var e;i.playing&&(25<=(e=100*(e=i.videoContainer.video.elm).currentTime/e.duration)&&!i.quartiles.first?(i.quartiles.first=!0,i.media.trackingEvents.firstQuartile&&i.trackingEvents(i.media.trackingEvents.firstQuartile),i.onEvent("adfirstquartile")):50<=e&&!i.quartiles.second?(i.quartiles.second=!0,i.media.trackingEvents.midpoint&&i.trackingEvents(i.media.trackingEvents.midpoint),i.onEvent("admidpoint")):75<=e&&!i.quartiles.third&&(i.quartiles.third=!0,i.media.trackingEvents.thirdQuartile&&i.trackingEvents(i.media.trackingEvents.thirdQuartile),i.onEvent("adthirdquartile")))},1e3),this.iconInterval=setInterval(function(){if(i.playing&&0<i.icons.length)for(var e=i.videoContainer.video.elm,t=0;t<i.icons.length;t++)!i.icons[t].visible&&i.icons[t].iconData.offset<=e.currentTime&&(i.icons[t].endTime>=e.currentTime||-1===i.icons[t].endTime)&&i.displayIcon(i.icons[t],t),i.icons[t].visible&&(e.currentTime<=i.icons[t].iconData.offset||-1<i.icons[t].endTime&&i.icons[t].endTime<=e.currentTime)&&i.removeIcon(t)},300)}},{key:"displayIcon",value:function(e,t){var i=document.createElement("img");i.className="omp-vast-icons",i.id="omp-vast-icon-"+t,i.style.width=parseInt(e.iconData.width)/10+"%";var s=e.iconData.xPosition;"left"===s?i.style.left="0px":"right"===s?i.style.right="0px":"center"===s?(i.style.left="50%",i.style.transform="translate(-50%, 0)"):0<=parseInt(s)?i.style.left=s+"%":i.style.left="5%";t=e.iconData.yPosition;"top"===t?i.style.top="0px":"bottom"===t?i.style.bottom="50px":"middle"===t?(i.style.top="50%",i.style.transform?i.style.transform="translate(-50%, -50%)":i.style.transform="translate(0, -50%)"):0<=parseInt(t)?(i.style.setProperty("bottom",t+"%","important"),i.style.transform="translate(-"+s+"%, "+t+"%)"):i.style.bottom="0px",void 0!==e.iconData.iconViewTrackingURLTemplate&&i.addEventListener("load",this.onIconLoadPingTracking.bind(this,e.iconData)),void 0!==e.iconData.iconClickThroughURLTemplate&&(i.addEventListener("touchend",this.onIconClickThrough.bind(this,e.iconData)),i.addEventListener("click",this.onIconClickThrough.bind(this,e.iconData))),i.src=e.iconData.staticResource,this.videoContainer.elm.appendChild(i),e.visible=!0}},{key:"removeIcon",value:function(e){var t=document.getElementById("omp-vast-icon-"+e);t&&(this.videoContainer.elm.removeChild(t),this.icons[e].visible=!1)}},{key:"onIconLoadPingTracking",value:function(e){var t=document.createElement("img");t.style.width="1px",t.style.height="1px",t.style.opacity="0",t.src=e.iconViewTrackingURLTemplate,this.videoContainer.elm.appendChild(t)}},{key:"onIconClickThrough",value:function(e,t){t.preventDefault(),this.pause(),e.iconClickThroughURLTemplate&&(this.recData?(t=this.replaceMacros(e.iconClickThroughURLTemplate),window.open(t,"_blank")):window.open(e.iconClickThroughURLTemplate,"_blank"),e.iconClickTrackingURLTemplates&&this.trackingEvents(e.iconClickTrackingURLTemplates)),this.onEvent("adclick")}},{key:"checkQuality",value:function(){var e=this;this.qualityInterval=setInterval(function(){var t=document.createElement("img"),i=document.getElementsByTagName("body")[0],s=e,n=null;t.src="http://widgets.outbrain.com/images/widgetIcons/ob_logo_67x12@2x.png",t.style.position="absolute",t.style.opacity=0,t.onload=function(){var e=Date.now()-n;i.removeChild(t),e<500?s.higherQuality():s.lowerQuality()},i.appendChild(t),n=Date.now()},3e4)}},{key:"end",value:function(){this.videoInterval&&clearInterval(this.videoInterval),this.iconInterval&&clearInterval(this.iconInterval),this.qualityInterval&&clearInterval(this.qualityInterval),this.hlsInterval&&clearInterval(this.hlsInterval),this.quartiles={first:!1,second:!1,third:!1}}},{key:"subscribe",value:function(e,t){this.subscriptions.hasOwnProperty(e)&&this.subscriptions[e].push(t)}},{key:"broadcast",value:function(e){if(this.subscriptions.hasOwnProperty(e)){for(var t,i=this.subscriptions[e].length,s=0,n=arguments.length,a=Array(1<n?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];for(;s<i;s++)(t=this.subscriptions[e])[s].apply(t,[e].concat(a))}}},{key:"replaceMacros",value:function(e){return e.replace("{ivc_ad_id}",this.validateMacros(this.recData.adId)).replace("{ivc_widget_name}",this.validateMacros(this.recData.widgetID)).replace("{ivc_widget_id}",this.validateMacros(this.recData.widgetNumberId)).replace("{ivc_ad_title}",this.validateMacros(this.recData.title)).replace("{ivc_source_id}",this.validateMacros(this.recData.sourceId)).replace("{ivc_req_id}",this.validateMacros(this.recData.reqId)).replace("{ivc_campaign_id}",this.validateMacros(this.recData.campaignId)).replace("{ivc_publisher_id}",this.validateMacros(this.recData.publisherId)).replace("{ivc_publisher_name}",this.validateMacros(this.recData.publisherName)).replace("{ivc_adv_name}",this.validateMacros(this.recData.sourceName)).replace("{ivc_time_stamp}",this.validateMacros(this.recData.timestamp)).replace("{ivc_doc_id}",this.validateMacros(this.recData.did)).replace("{ivc_ext_ad_id}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.adId):"").replace("{ivc_ext_source_id}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.sourceId):"").replace("{ivc_ext_campaign_id}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.campaignId):"").replace("{ivc_ext_publisher_id}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.publisherId):"").replace("{ivc_ext_doc_id}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.did):"").replace("{{ad_id}}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.adId):"").replace("{{widget_name}}",this.validateMacros(this.recData.widgetID)).replace("{{widget_id}}",this.validateMacros(this.recData.widgetNumberId)).replace("{{ad_title}}",this.validateMacros(this.recData.title)).replace("{{section_id}}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.sourceId):"").replace("{{req_id}}",this.validateMacros(this.recData.reqId)).replace("{{campaign_id}}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.campaignId):"").replace("{{publisher_id}}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.publisherId):"").replace("{{publisher_name}}",this.validateMacros(this.recData.publisherName)).replace("{{adv_name}}",this.validateMacros(this.recData.sourceName)).replace("{{time_stamp}}",this.validateMacros(this.recData.timestamp)).replace("{{doc_id}}",this.recData.externalIds?this.validateMacros(this.recData.externalIds.did):"").replace("{ivc_ob_click_id}",this.validateMacros(this.recData.obClickId)).replace("{{ob_click_id}}",this.validateMacros(this.recData.obClickId)).replace("{{time_stamp}}",Date.now().toString())}},{key:"validateMacros",value:function(e){return e||""}},{key:"prepareMoatTracking",value:function(){var e=this.videoContainer.elm,t={level1:this.options.publisherId,level2:this.options.publisherName,level3:this.options.widgetId,level4:this.options.domain,slicer1:this.options.partnerId,slicer2:this.options.marketerName},i=this.getAdDuration();this.moatTracker=this.initMoatTracking(e,t,i,"zemantajsvideo256634828520")}},{key:"initMoatTracking",value:function(e,t,i,s,n,a){var r,o,l=document.createElement("script"),d=[],c={vidIntType:"3",vidIntVersion:"1.0",adData:{ids:t,duration:i,url:n},dispatchEvent:function(e){c.sendEvent?(d&&(d.push(e),e=d,d=!1),c.sendEvent(e)):d&&d.push(e)},clientCallback:a};t="_moatApi"+Math.floor(1e8*Math.random());try{o=(r=e.ownerDocument).defaultView||r.parentWindow}catch(e){r=document,o=window}return o[t]=c,l.type="text/javascript",e&&e.insertBefore(l,e.childNodes[0]||null),l.src="https://z.moatads.com/"+s+"/moatvideo.js#"+t,c}},{key:"trackingEvents",value:function(e){for(var t=0;t<e.length;t++){var i=this.recData?this.replaceMacros(e[t]):e[t];(new Image).src=i;i=new CustomEvent("pixelfired",{detail:i,bubbles:!1,cancelable:!0});this.videoContainer.elm.dispatchEvent(i),this.broadcast("pixelfired")}}},{key:"jsTrackingEvent",value:function(e){for(var t=this.videoContainer.video.elm.parentElement,i=0;i<e.length;i++){var s=document.createElement("script");s.setAttribute("type","text/javascript"),s.src=e[i],t.appendChild(s);s=new CustomEvent("jstrackeradded",{detail:e[i],bubbles:!1,cancelable:!0});this.videoContainer.elm.dispatchEvent(s),this.broadcast("jstrackeradded")}}},{key:"getOptimalSizeVideo",value:function(e){for(var t,i=0,s=this.sortedMedias[1.77],n=s.length,a=e.offsetHeight,r=e.offsetWidth,o=null;i<n;i++)"VPAID"!==s[i].apiFramework&&("video/mp4"!==(t=s[i].mimeType||s[i].fileURL.split(".").pop())&&"mp4"!==t||s[i].height>=a&&s[i].width>=r&&(!o||o.height>s[i].height&&o.width>s[i].width)&&(o=s[i]));return o=o||s[s.length-1]}},{key:"higherQuality",value:function(){var e=this.media.width+"*"+this.media.height,t=this.sortedAspects.indexOf(e);void 0!==this.sortedAspects[t+1]&&(e=this.sortedAspects[t+1],this.sortedMedias[1.77]&&this.sortedMedias[1.77].hasOwnProperty(e)&&(t=this.sortedMedias[1.77][e],this.switchMedia(t[t.length-1])),this.sortedMedias[1.91]&&this.sortedMedias[1.91].hasOwnProperty(e)&&(e=this.sortedMedias[1.91][e],this.switchMedia(e[e.length-1])))}},{key:"lowerQuality",value:function(){var e=this.media.width+"*"+this.media.height,t=this.sortedAspects.indexOf(e);void 0!==this.sortedAspects[t-1]&&(e=this.sortedAspects[t-1],this.sortedMedias[1.77]&&this.sortedMedias[1.77].hasOwnProperty(e)&&(t=this.sortedMedias[1.77][e],this.switchMedia(t[t.length-1])),this.sortedMedias[1.91]&&this.sortedMedias[1.91].hasOwnProperty(e)&&(e=this.sortedMedias[1.91][e],this.switchMedia(e[e.length-1])))}},{key:"switchMedia",value:function(s){var e,t,n,i,a;this.switching||(t=(e=this.videoContainer.video.elm).parentElement,i=e.currentTime,n=document.createElement("video"),i=parseInt(i)+1,a=this,i<e.duration&&(this.switching=1,n.style.position="absolute",n.style.visibility="hidden",n.style.zIndex="-1",n.src=s.fileURL+"#t="+i,n.onprogress=function(){var e,t,i;a.switching++,9<a.switching&&(n.onprogress=null,e=a.videoContainer.video.elm,t=this,a.media=s,this.style.visibility=null,this.style.zIndex=null,i=e.muted,a.playing&&this.play(),t.currentTime=e.currentTime,t.muted=i,e.muted=!0,a.videoContainer.video.elm=n,t.parentNode.removeChild(e),t.style.position=null,t.addEventListener("progress",a.onProgress.bind(a)),t.addEventListener("ended",a.onComplete.bind(a)),a.switching=0)},t.insertBefore(n,e)))}},{key:"play",value:function(){var t=this,e=this.videoContainer.video.elm;this.start(),e.play().then(function(){t.playing=!0,t.videoStartedPlaying=!0,t.media.impressions&&t.trackingEvents(t.media.impressions),t.media.trackingEvents.start&&t.trackingEvents(t.media.trackingEvents.start),setTimeout(function(){t.media.isSlh&&(t.media.duration=e.duration)},1e3),t.onEvent("adstarted")}).catch(function(e){t.onPlayingMediaError(new Error("Video did not start playing"))})}},{key:"stop",value:function(){var e=this.videoContainer.video.elm;this.end(),e.pause(),this.playing=!1,this.onEvent("adstopped")}},{key:"pause",value:function(){this.videoContainer.video.elm.pause(),this.playing=!1,this.media.trackingEvents.pause&&this.trackingEvents(this.media.trackingEvents.pause),this.onEvent("adpaused")}},{key:"resume",value:function(){this.videoContainer.video.elm.play(),this.playing=!0,this.media.trackingEvents.resume&&this.trackingEvents(this.media.trackingEvents.resume),this.onEvent("adresumed")}},{key:"mute",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.videoContainer.video.elm.muted=!0,this.currentVolume=0,this.media.trackingEvents.mute&&this.trackingEvents(this.media.trackingEvents.mute),e&&this.onEvent("advolumechanged"),t&&this.broadcast("mute")}},{key:"unmute",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.videoContainer.video.elm.muted=!1,0===this.lastPlayedVolume&&(this.lastPlayedVolume=1),this.currentVolume=this.lastPlayedVolume,this.media.trackingEvents.unmute&&this.trackingEvents(this.media.trackingEvents.unmute),e&&this.onEvent("advolumechanged"),t&&this.broadcast("unmute")}},{key:"volume",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=this.videoContainer.video.elm;this.lastPlayedVolume=this.currentVolume=i.volume=e,this.onEvent("advolumechanged"),t&&this.broadcast("volume")}},{key:"seek",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.videoContainer.video.elm.currentTime=e,t&&this.broadcast("seek")}},{key:"fullscreen",value:function(){var e=this.videoContainer.elm;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}},{key:"collapse",value:function(){document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement?document.webkitExitFullscreen():document.mozFullScreenElement?document.mozCancelFullScreen():document.msFullscreenElement&&document.msExitFullscreen()}},{key:"resize",value:function(e,t){}},{key:"destroy",value:function(){this.onEvent("destroycompleted")}},{key:"isMuted",value:function(){return this.videoContainer.video.elm.muted}},{key:"getVolume",value:function(){return this.currentVolume}},{key:"getAdPaused",value:function(){return this.videoContainer.video.elm.paused}},{key:"getAdErrorCode",value:function(){return this.error.errorCode}},{key:"getAdErrorMessage",value:function(){return this.error.message}},{key:"getAdSystem",value:function(){return this.media.system}},{key:"getVideoBitrate",value:function(){return this.media.bitrate}},{key:"getAdMediaBitrateArray",value:function(){var i=this,s=[];if(this.sortedMedias&&Object.keys(this.sortedMedias).length)for(var e=0;e<Object.keys(this.sortedMedias).length;e++)!function(e){var t=i.sortedMedias[Object.keys(i.sortedMedias)[e]];Object.keys(t).forEach(function(e){s.push.apply(s,_toConsumableArray(t[e].map(function(e){return e.bitrate})))})}(e);return s}},{key:"getHeavyAdStatus",value:function(){var e=this.options,t=this.getAdMediaBitrateArray(),i="void";return t&&(i="noBitrate",0<t.length&&t.some(function(e){return 0<e})&&(i="noMatchingTag",t.every(function(e){return e<800})?i="notNeeded":e.placementWidth&&e.placementHeight&&((600<e.placementHeight||600<e.placementWidth)&&t.some(function(e){return e<1200})?i="reducedLarge":e.placementHeight<=600&&e.placementWidth<=600&&t.some(function(e){return e<=800})&&(i="reducedMed")))),i}},{key:"getAdMediaHeight",value:function(){return this.videoContainer.video.elm.videoHeight}},{key:"getAdMediaWidth",value:function(){return this.videoContainer.video.elm.videoWidth}},{key:"getAdMediaUrl",value:function(){return this.videoContainer.video.elm.src}},{key:"getAdTagUrl",value:function(){return this.media.fileURL}},{key:"getAdDuration",value:function(){var e=this.videoContainer.video.elm.duration;return e&&0<e?e:this.media.duration}},{key:"getAdCurrentTime",value:function(){return this.videoContainer.video.elm.currentTime}},{key:"getAdDeliveryType",value:function(){return this.media.deliveryType}},{key:"getVastWidth",value:function(){return this.media.width}},{key:"getVastHeight",value:function(){return this.media.height}},{key:"getVideoClickThroughURL",value:function(){return this.media.videoClickThroughURLTemplate}},{key:"getVideoClickTrackingURL",value:function(){return this.media.videoClickTrackingURLTemplates}},{key:"getCompanionAds",value:function(){return this.companionAds}},{key:"updateMacros",value:function(e){try{this.recData.obClickId=e.clickId}catch(e){}}}]),re);function re(e,t,i){_classCallCheck(this,re),this.medias=t.medias,this.companionAds=t.companionAds,this.sortedMedias={},this.sortedAspects=[],this.media=null,this.icons=[],this.id=e.id,this.recData=e.options?e.options.adData:void 0,this.parser=t,this.shouldTrackMoat=e.shouldTrackMoat,this.options=e.options,this.moatTracker=null,this.error=null,this.playing=!1,this.started=!1,this.videoStartedPlaying=!1,this.videoInterval=0,this.qualityInterval=0,this.iconInterval=0,this.hlsInterval=0,this.switching=0,this.quartiles={first:!1,second:!1,third:!1},this.subscriptions={ready:[],adstarted:[],adstopped:[],adpaused:[],adresumed:[],adcomplete:[],advolumechanged:[],adclick:[],volume:[],mute:[],unmute:[],seek:[],progress:[],enterfullscreen:[],exitfullscreen:[],fullscreenerror:[]},this.videoContainer=i,this.initializing=!1,this.currentVolume=e.options.muted?0:1,this.lastPlayedVolume=this.currentVolume,this.sortMedias(),!0===e.options.bitrateEnabled?this.setMediaByBitrate():this.setMedia(),this.setIcons()}var oe=(_createClass(le,[{key:"init",value:function(){this.parser=new I(this.parent.vastXML,this.parent.pixels,this.parent.jsTrackers),d.waterfall([this.parser.read,this.parser.setAdsMedias],this.parser).then(this.onAdReady.bind(this)).catch(this.onError.bind(this))}},{key:"setUI",value:function(){this.setVideoUI(),this.setHeaderUI(),this.setFooterUI(),this.setUIFonts(),this.setUICustomControls();var e=document.getElementById(this.parent.id);e.addEventListener("mouseenter",this.onMouseEnter.bind(this)),e.addEventListener("mouseleave",this.onMouseLeave.bind(this)),this.parent.mobile?(this.elements.header.elm.addEventListener("click",this.onControlClick.bind(this),!0),this.elements.footer.elm.addEventListener("click",this.onControlClick.bind(this),!0)):(this.elements.header.elm.addEventListener("click",this.setFocus.bind(this),!0),this.elements.footer.elm.addEventListener("click",this.setFocus.bind(this),!0)),this.interpreter.subscribe("ready",this.onReady.bind(this)),this.interpreter.subscribe("adstarted",this.onPlay.bind(this)),this.interpreter.subscribe("adstopped",this.onStop.bind(this)),this.interpreter.subscribe("adpaused",this.onPause.bind(this)),this.interpreter.subscribe("adcomplete",this.onComplete.bind(this)),this.interpreter.subscribe("adresumed",this.onResume.bind(this)),this.interpreter.subscribe("mute",this.onVolume.bind(this)),this.interpreter.subscribe("unmute",this.onVolume.bind(this)),this.interpreter.subscribe("volume",this.onVolume.bind(this)),this.interpreter.subscribe("progress",this.onProgress.bind(this)),this.interpreter.subscribe("enterfullscreen",this.onFullscreen.bind(this)),this.interpreter.subscribe("exitfullscreen",this.onFullscreen.bind(this)),this.interpreter.subscribe("fullscreenerror",this.onFullscreenError.bind(this))}},{key:"setHeaderUI",value:function(){var e=this.parent.container,t=this.elements.header;this.setSettingsUI(),this.setCloseUI(),this.setDummyUI(),this.setExpandUI(),t.elm=document.createElement("div"),t.elm.id=t.id,t.elm.setAttribute("tabindex","100"),this.parent.options.outstream&&(t.elm.style.display="flex"),t.elm.appendChild(t.settings.elm),t.elm.appendChild(t.dummy.elm),t.elm.appendChild(t.close.elm),e.appendChild(t.elm)}},{key:"setVideoUI",value:function(){var e=this.parent.id,t=this.elements.videoContainer;t.elm=document.getElementById(e),t.content.elm=document.createElement("div"),t.video.elm=document.createElement("video"),t.video.elm.setAttribute("playsinline","true"),t.elm.appendChild(t.content.elm),t.elm.appendChild(t.video.elm)}},{key:"setSettingsUI",value:function(){var e=d.getElement("settings",this.elements),t=document.createElement("div"),i=document.createElement("i"),s=this.parent.options;t.classList.add(e.className),t.classList.add(this.elements.style.commonIconClassName),i.classList.add(e.settingsIcon.className),i.classList.add(this.elements.style.icons),!1!==s.showSettings&&!1!==s.showControls||t.classList.add(this.elements.style.invisible),i.appendChild(document.createTextNode(e.settingsIcon.iconClassName)),t.appendChild(i),e.elm=t,e.settingsIcon.elm=i,e.elm.style.zIndex="9999"}},{key:"setCloseUI",value:function(){var e=d.getElement("close",this.elements),t=document.createElement("div"),i=document.createElement("i"),s=this.parent.options;t.classList.add(e.className),t.classList.add(this.elements.style.commonIconClassName),i.classList.add(e.closeIcon.className),i.classList.add(this.elements.style.icons),!1!==s.showClose&&!1!==s.showControls||t.classList.add(this.elements.style.invisible),i.appendChild(document.createTextNode(e.closeIcon.closeIconClassName)),t.appendChild(i),e.elm=t,e.closeIcon.elm=i,e.closeIcon.elm.addEventListener("click",this.onClickClose.bind(this))}},{key:"setDummyUI",value:function(){var e=d.getElement("dummy",this.elements);e.elm=document.createElement("div"),e.elm.classList.add(e.className)}},{key:"setExpandUI",value:function(){var e=d.getElement("expand",this.elements),t=document.createElement("div"),i=document.createElement("i"),s=this.parent.options;t.classList.add(e.className),t.classList.add(this.elements.style.commonIconClassName),i.classList.add(e.expandIcon.className),i.classList.add(e.expandIcon.collapseClassName),i.classList.add(this.elements.style.icons),!1!==s.showExpand&&!1!==s.showControls||t.classList.add(this.elements.style.invisible),i.appendChild(document.createTextNode(e.expandIcon.expandIconClassName)),t.appendChild(i),e.elm=t,e.expandIcon.elm=i,this.interpreter.hasFullscreen()?e.expandIcon.elm.addEventListener("click",this.onClickExpand.bind(this)):e.expandIcon.elm.classList.add(this.elements.style.hidden)}},{key:"setFooterUI",value:function(){var e=this.parent.container,t=this.elements.footer;this.setPlayUI(),this.setSeekUI(),this.setTimeBoxUI(),this.setVolumeUI(),t.elm=document.createElement("div"),t.elm.id=t.id,t.elm.setAttribute("tabindex","101"),t.elm.appendChild(t.play.elm),t.elm.appendChild(t.seek.elm),t.elm.appendChild(t.timeBox.elm),t.elm.appendChild(t.volume.elm),t.elm.appendChild(t.expand.elm),e.appendChild(t.elm)}},{key:"setPlayUI",value:function(){var e=d.getElement("play",this.elements),t=document.createElement("div"),i=document.createElement("i"),s=this.parent.options;t.classList.add(e.className),t.classList.add(this.elements.style.commonIconClassName),i.classList.add(e.playIcon.className),i.classList.add(this.elements.style.icons),!1!==s.showPlay&&!1!==s.showControls||t.classList.add(this.elements.style.invisible),i.appendChild(document.createTextNode(e.playIcon.playIconClassName)),t.appendChild(i),e.elm=t,e.playIcon.elm=i,e.playIcon.elm.addEventListener("click",this.onClickPlay.bind(this)),window.addEventListener("keydown",this.onPress)}},{key:"setSeekUI",value:function(){var e=d.getElement("seek",this.elements),t=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div"),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("i"),o=this.parent.options;t.classList.add(e.className),i.classList.add(e.bar.className),s.classList.add(e.bar.loadBar.className),n.classList.add(e.bar.progressBar.className),r.classList.add(e.bar.handler.className),r.classList.add(this.elements.style.icons),a.classList.add(e.bar.time.className),a.classList.add(this.elements.style.hidden),!1!==o.showSeekBar&&!1!==o.showControls||t.classList.add(this.elements.style.invisible),r.appendChild(document.createTextNode(e.bar.handler.iconClassName)),i.appendChild(s),i.appendChild(n),i.appendChild(r),i.appendChild(a),t.appendChild(i),e.elm=t,e.bar.elm=i,e.bar.loadBar.elm=s,e.bar.progressBar.elm=n,e.bar.handler.elm=r,e.bar.time.elm=a,this.parent.mobile||(this.parent.seek&&i.addEventListener("click",this.onClickSeekBar.bind(this)),e.elm.addEventListener("mousemove",this.onMouseSeekBar.bind(this)),e.elm.addEventListener("mouseleave",this.onMouseSeekBar.bind(this)))}},{key:"updateSeek",value:function(){var e=d.getElement("bar",this.elements);e&&!this.parent.mobile&&e.elm.addEventListener("click",this.onClickSeekBar.bind(this))}},{key:"setTimeBoxUI",value:function(){var e=d.getElement("timeBox",this.elements),t=document.createElement("div"),i=document.createElement("div"),s=this.parent.options;t.classList.add(e.className),i.classList.add(e.timeBoxDisplay.className),i.appendChild(document.createTextNode(e.timeBoxDisplay.className)),t.appendChild(i),!1!==s.showTimeBox&&!1!==s.showControls||t.classList.add(this.elements.style.invisible),e.elm=t,e.timeBoxDisplay.elm=i,e.timeBoxDisplay.elm.innerHTML=""}},{key:"setVolumeUI",value:function(){var e=d.getElement("volume",this.elements),t=e.volumeWrapper,i=document.createElement("div"),s=document.createElement("i"),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div"),l=this.parent.options;i.classList.add(e.className),i.classList.add(this.elements.style.commonIconClassName),s.classList.add(e.volumeIcon.className),n.classList.add(t.className),a.classList.add(t.volumeBar.className),r.classList.add(t.volumeSeekBar.className),o.classList.add(t.volumeHandler.className),s.classList.add(e.volumeIcon.highClassName),s.classList.add(this.elements.style.icons),!1!==l.showVolume&&!1!==l.showControls||i.classList.add(this.elements.style.invisible),s.appendChild(document.createTextNode(e.volumeIcon.highIconClassName)),n.appendChild(a),n.appendChild(r),n.appendChild(o),i.appendChild(s),i.appendChild(n),e.elm=i,e.volumeIcon.elm=s,t.elm=n,t.volumeBar.elm=a,t.volumeSeekBar.elm=r,t.volumeHandler.elm=o,e.volumeIcon.elm.addEventListener("click",this.onClickVolume.bind(this)),this.parent.mobile||(e.volumeIcon.elm.addEventListener("mouseenter",this.onEnterVolumeSeek.bind(this)),e.volumeIcon.elm.addEventListener("mouseleave",this.onLeaveVolumeSeek.bind(this)),t.elm.addEventListener("click",this.onClickVolumeSeek.bind(this)),t.elm.addEventListener("mouseenter",this.onEnterVolumeSeek.bind(this)),t.elm.addEventListener("mouseleave",this.onLeaveVolumeSeek.bind(this)))}},{key:"setUIFonts",value:function(e){for(var t=document.getElementsByClassName(this.elements.style.commonIconClassName),i=e||this.parent.container.offsetWidth,e=t.length,s=e;s--;)t[s].classList.remove(this.elements.style.smallIconClassName),t[s].classList.remove(this.elements.style.mediumIconClassName);if(this.elements.footer.seek.elm.classList.remove(this.elements.style.smallSeekClassName),this.elements.footer.seek.elm.classList.remove(this.elements.style.mediumSeekClassName),this.elements.header.dummy.elm.classList.remove(this.elements.style.smallSeekClassName),this.elements.header.dummy.elm.classList.remove(this.elements.style.mediumSeekClassName),i<500){for(var n=e;n--;)t[n].classList.add(this.elements.style.smallIconClassName);this.elements&&this.elements.footer&&this.elements.footer.seek&&this.elements.footer.seek.elm&&this.elements.footer.seek.elm.classList.add(this.elements.style.smallSeekClassName),this.elements&&this.elements.header&&this.elements.header.dummy&&this.elements.header.dummy.elm&&this.elements.header.dummy.elm.classList.add(this.elements.style.smallSeekClassName)}else if(i<700){for(var a=e;a--;)t[a].classList.add(this.elements.style.mediumIconClassName);this.elements&&this.elements.footer&&this.elements.footer.seek&&this.elements.footer.seek.elm&&this.elements.footer.seek.elm.classList.add(this.elements.style.mediumSeekClassName),this.elements&&this.elements.header&&this.elements.header.dummy&&this.elements.header.dummy.elm&&this.elements.header.dummy.elm.classList.add(this.elements.style.mediumSeekClassName)}}},{key:"setUICustomControls",value:function(){if(this.parent.options.customControls)try{var e=JSON.parse(this.parent.options.customControls);e.adIcon&&this.setAdIconUI(e),e.playerBackgroundColor&&this.setBackgroundColor(e)}catch(e){console.log("JsonParse error - "+e)}}},{key:"setCustomPlaybackButtonsUI",value:function(e){var t=d.getElement("footer",this.elements).play.playIcon.elm;try{var i=JSON.parse(this.parent.options.customControls);t.style.backgroundImage="url("+i.playbackButtons.play+")",t.style.backgroundSize="contain",t.style.backgroundRepeat="no-repeat",t.style.backgroundPosition="center",t.style.color="transparent"}catch(e){console.log("JsonParse error - "+e)}}},{key:"setCustomSoundButtonsUI",value:function(e){}},{key:"setBackgroundColor",value:function(e){var t=document.getElementById("mp");t&&e.playerBackgroundColor&&(t.style.background=e.playerBackgroundColor,t.style.boxShadow="unset");t=document.getElementById(this.parent.options.containerId+"_omp");t&&e.playerBackgroundColor&&(t.style.background=e.playerBackgroundColor,t.style.boxShadow="unset")}},{key:"setAdIconUI",value:function(e){var t,i=this.parent.container,s=this,n=d.getElement("adIcon",this.elements);n.elm=document.createElement("div"),e&&e.adIcon&&e.adIcon.link&&((t=new Image).onload=function(){var t;s.customControls.adIcon.src=this.src,s.customControls.adIcon.width=this.width,s.customControls.adIcon.height=this.height,n.elm.style.height=e.adIcon.height,n.elm.style.width=e.adIcon.width,n.elm.style.fontSize=e.adIcon.fontSize,n.elm.style.lineHeight=n.elm.style.height,n.elm.style.color=e.adIcon.color,n.elm.innerHTML=e.adIcon.text||"",n.elm.style.fontFamily=e.adIcon.font,n.elm.style.backgroundImage="url("+this.src+")",e.adIcon.clickthrough&&(n.elm.style.cursor="pointer",t=e.adIcon.clickthrough,n.elm.addEventListener("click",function(e){e.preventDefault(),s.pause(),window.open(t,"_blank")})),n.elm.classList.add(n.className)},t.src=e.adIcon.link),i.appendChild(n.elm)}},{key:"showVolumeSeekBar",value:function(){d.getElement("volumeWrapper",this.elements).elm.classList.add(this.elements.style.active)}},{key:"hideVolumeSeekBar",value:function(){d.getElement("volumeWrapper",this.elements).elm.classList.remove(this.elements.style.active)}},{key:"startProgress",value:function(){var a=this;this.progressInterval=setInterval(function(){var e,t,i,s,n;a.interpreter.playing&&(e=d.getElement("bar",a.elements),n=d.getElement("timeBox",a.elements),t=a.interpreter.getAdCurrentTime(),i=a.interpreter.getAdDuration(),s=n.timeBoxDisplay.elm,e.progressBar.elm.style.width=(n=100<(n=100*t/i)?100:n)+"%",e.handler.elm.style.left=e.progressBar.elm.offsetWidth+"px",s.innerHTML="",s.appendChild(document.createTextNode(d.humanTime(i-t))))},1e3)}},{key:"startViewabilityInterval",value:function(){var t=this,i=Math.random();this.viewabiltyEventInterval[i]=window.setInterval(function(){var e=t.getCurrentViewability();!t.getAdPaused()&&e&&e>=t.viewabilityPercentageThreshold?t.totalContinuosViewTime+=t.viewabiltyIntervalTime:t.totalContinuosViewTime=0,t.totalContinuosViewTime>=t.viewabiltyEventTime&&(window.clearInterval(t.viewabiltyEventInterval[i]),t.onVideoInView())},this.viewabiltyIntervalTime)}},{key:"getCurrentViewability",value:function(){var e=document.getElementById(this.parent.id);if(!e)return 0;var t=e.getBoundingClientRect(),i=this.getViewportSizeGlobal().height,s=e.clientHeight;if(!s)return 0;var n=t.top,e=t.top+s,t=0;if(0<n){if(i<n)return 0;if(e<i)return 100;t=i-n}else{if(e<0)return 0;t=i<e?i:e}return Math.round(100*t/s)}},{key:"getViewportSizeGlobal",value:function(){var e={height:0,width:0},t=void 0!==window.innerWidth,i=void 0!==document.documentElement&&void 0!==document.documentElement.clientWidth&&0!==document.documentElement.clientWidth,s=!1==t&&!1==i;return t?(e.height=window.innerHeight,e.width=window.innerWidth):i?(e.height=document.documentElement.clientHeight,e.width=document.documentElement.clientWidth):s&&(e.height=document.getElementsByTagName("body")[0].clientHeight,e.width=document.getElementsByTagName("body")[0].clientWidth),e}},{key:"onVideoInView",value:function(){this.videoWasViewed=!0;var e=this.interpreter.media.viewableImpressions;e&&e.viewable&&this.interpreter.trackingEvents(e.viewable);e=new CustomEvent("playerInView",{bubbles:!1,cancelable:!0});this.parent.container.dispatchEvent(e)}},{key:"onAdReady",value:function(e){e&&this.onError(e);var t=this.checkForVpaid()||this.parser.medias[0];this.framework=t.apiFramework||"VAST";e="VPAID"===this.framework.toUpperCase()&&/imasdk/.test(t.fileURL)&&1<this.parser.medias.length;e&&(t=this.parser.medias[1]),this.duration=t.duration,this.interpreter="VPAID"!==t.apiFramework||e?new ae(this.parent,this.parser,this.elements.videoContainer):new ee(t,this.parent,this.elements.videoContainer),this.setLoaderUI(),!0===this.interpreter.streaming&&(this.parent.options.twoStepsLoad=!1),!0!==this.parent.options.twoStepsLoad||"VPAID"===this.framework.toUpperCase()||this.ctwAdDataAutoPlayEnabled?(this.setUI(),this.interpreter.init().catch(this.onError.bind(this))):(this.setUI(),this.onPlayerReady())}},{key:"checkForVpaid",value:function(){if(!(this.parser.medias.length<=1)){for(var e=this.parser.medias,s=[],n=[],t=function(e){var t=(e.width/e.height).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0],i=e.width+"*"+e.height;s.hasOwnProperty(t)||(s[t]={}),s[t].hasOwnProperty(i)||(s[t][i]=[]),n.indexOf(i)<0&&n.push(i),s[t][i].push(e)},i=0,a=e.length;i<a;i++){"VPAID"===e[i].apiFramework&&t(e[i]);var r=e[i].mimeType,o=e[i].fileURL.split(".").pop();r?"video/mp4"!==r&&"video/quicktime"!==r||t(e[i]):"mp4"!==o.toLowerCase()&&"mov"!==o.toLowerCase()||t(e[i])}if(n.sort(function(e,t){var i=e.split("*"),s=t.split("*"),e=parseInt(i[0]),t=parseInt(i[1]),i=parseInt(s[0]),s=parseInt(s[1]);return e<i||t<s?1:i<e||s<t?-1:0}),s&&Object.keys(s).length&&n.length){for(var l,d=n[0],c=0;c<Object.keys(s).length;c++){var u=s[Object.keys(s)[c]];u.hasOwnProperty(d)&&(l=u)}for(var h=0,m=l[d].length;h<m;h++)if("VPAID"===l[d][h].apiFramework)return l[d][h];return l[d][0]}}}},{key:"setLoaderUI",value:function(){var e=this.parent.container,t=d.getElement("loader",this.elements),i=d.getElement("style",this.elements),s=document.createElement("div");s.classList.add(i.hidden),s.classList.add(t.className),t.elm=s,e.appendChild(t.elm)}},{key:"showLoader",value:function(){var e=d.getElement("loader",this.elements),t=d.getElement("style",this.elements);e.elm.classList.remove(t.hidden)}},{key:"hideLoader",value:function(){var e=d.getElement("loader",this.elements),t=d.getElement("style",this.elements);e.elm.classList.add(t.hidden)}},{key:"onKeyPress",value:function(e){this.isChild(this.elements.videoContainer.elm,document.activeElement)&&(e.preventDefault(),this.interpreter.started&&32===(e||window.event).keyCode&&this.onClickPlay(e))}},{key:"onPlayerReady",value:function(){var e=new CustomEvent("playerReady",{bubbles:!1,cancelable:!0});this.parent.container.dispatchEvent(e)}},{key:"onControlClick",value:function(e){var t=this;this.elements.videoContainer.elm.focus(),this.onMouseEnter(e),setTimeout(function(){t.onMouseLeave(e)},1e3)}},{key:"setFocus",value:function(){this.elements.videoContainer.elm.focus()}},{key:"onMouseEnter",value:function(e){e.preventDefault(),this.uiTimeout&&clearTimeout(this.uiTimeout);var t=this.elements.header,e=this.elements.footer;t.elm.classList.add(this.elements.style.active),e.elm.classList.add(this.elements.style.active)}},{key:"onMouseLeave",value:function(e){var i=this;e.preventDefault(),this.uiTimeout&&clearTimeout(this.uiTimeout),this.uiTimeout=setTimeout(function(){var e=i.elements.header,t=i.elements.footer;i.parent.mobile||(e.elm.classList.remove(i.elements.style.active),t.elm.classList.remove(i.elements.style.active)),i.hideVolumeSeekBar()},this.parent.options.controlsDelay)}},{key:"onClickClose",value:function(e){e.preventDefault(),e.stopPropagation(),this.destroy();e=new CustomEvent("aduserclose",{bubbles:!1,cancelable:!0});this.parent.container.dispatchEvent(e)}},{key:"onClickPlay",value:function(e){e.preventDefault(),e.stopPropagation(),this.interpreter.playing?this.pause():this.interpreter.started?this.resume():this.interpreterReady?this.play():this.interpreter.initializing||(this.showLoader(),this.interpreter.init())}},{key:"onClickExpand",value:function(e){e.preventDefault();e=d.getElement("expandIcon",this.elements);e.elm.classList.contains(e.collapseClassName)?this.interpreter.fullscreen():this.interpreter.collapse()}},{key:"onClickSeekBar",value:function(e){e.preventDefault();var t=d.getElement("bar",this.elements),i=t.elm.offsetWidth,e=parseInt(100*e.offsetX/i),i=e*this.interpreter.getAdDuration()/100;t.progressBar.elm.style.width=e+"%",t.handler.elm.style.left=t.progressBar.elm.offsetWidth+"px",this.interpreter.seek(i);i=new CustomEvent("userseek",{detail:i,bubbles:!1,cancelable:!0});this.parent.container.dispatchEvent(i)}},{key:"onMouseSeekBar",value:function(e){var t,i=this,s=this.elements.footer.seek,n=s.bar.time;e.target.classList.contains(n.className)||(s=s.elm,t=n.elm,this.timeInfoTimeout&&clearTimeout(this.timeInfoTimeout),"mousemove"===e.type?(n=this.getAdDuration(),s=s.offsetWidth,s=parseInt(e.offsetX*n/s),t.innerHTML="",t.appendChild(document.createTextNode(d.humanTime(s))),t.classList.remove(this.elements.style.hidden),t.style.left=e.offsetX-20+"px"):this.timeInfoTimeout=setTimeout(function(){t.classList.add(i.elements.style.hidden)},1e3))}},{key:"onClickVolume",value:function(e){e.preventDefault();d.getElement("volumeIcon",this.elements);e=void 0;this.parent.mobile&&this.hideVolumeSeekBar();e=0<this.volumeState?(this.volumeState=0,this.interpreter.mute(),"mute"):(0===this.lastPlayedVolume&&(this.lastPlayedVolume=1),this.volumeState=this.lastPlayedVolume,this.interpreter.unmute(),"unmute"),e=new CustomEvent(e,{bubbles:!1,cancelable:!0});this.parent.container.dispatchEvent(e)}},{key:"onClickVolumeSeek",value:function(e){e.preventDefault();var t=d.getElement("volumeWrapper",this.elements),i=t.elm.offsetHeight,i=parseInt(100*(i-e.offsetY)/i);t.volumeSeekBar.elm.style.height=i+"%",t.volumeHandler.elm.style.bottom=t.volumeSeekBar.elm.offsetHeight+"px";i/=100;this.lastPlayedVolume=this.volumeState=i,this.interpreter.volume(i)}},{key:"onEnterVolumeSeek",value:function(){this.volumeTimer&&clearTimeout(this.volumeTimer),this.showVolumeSeekBar()}},{key:"onLeaveVolumeSeek",value:function(){var e=this;this.volumeTimer=setTimeout(function(){e.hideVolumeSeekBar()},2e3)}},{key:"onReady",value:function(){var e=this;this.interpreterReady=!0,this.parent.options.muted&&(this.setMute(!0),this.volumeState=0),this.parent.options.autoplay&&setTimeout(function(){e.play()},100),this.interpreter.media.adVerifications&&0<this.interpreter.media.adVerifications.length&&this.interpreter.jsTrackingEvent(this.interpreter.media.adVerifications)}},{key:"onProgress",value:function(e,t){var i=this.interpreter.getAdDuration(),s=d.getElement("loadBar",this.elements),i=100*t.end/i;s.elm.style.width=(i=100<i?100:i)+"%"}},{key:"onPlay",value:function(){var e=d.getElement("playIcon",this.elements);e.elm.innerHTML="",e.elm.appendChild(document.createTextNode(e.pauseIconClassName)),this.startProgress(),this.startViewabilityInterval()}},{key:"onStop",value:function(){var e=d.getElement("playIcon",this.elements);e.elm.innerHTML="",e.elm.appendChild(document.createTextNode(e.playIconClassName)),clearInterval(this.progressInterval)}},{key:"onComplete",value:function(){var e=d.getElement("bar",this.elements),t=d.getElement("playIcon",this.elements);t.elm.innerHTML="",t.elm.appendChild(document.createTextNode(t.playIconClassName)),e.progressBar.elm.style.width="100%"}},{key:"onPause",value:function(){var e=d.getElement("playIcon",this.elements);e.elm.innerHTML="",e.elm.appendChild(document.createTextNode(e.playIconClassName))}},{key:"onResume",value:function(){var e=d.getElement("playIcon",this.elements);e.elm.innerHTML="",e.elm.appendChild(document.createTextNode(e.pauseIconClassName))}},{key:"onVolume",value:function(e){var t,i=d.getElement("volumeIcon",this.elements);"mute"===e?(i.elm.classList.remove(i.highClassName),i.elm.classList.remove(i.lowClassName),i.elm.classList.add(i.muteClassName),i.elm.innerHTML="",i.elm.appendChild(document.createTextNode(i.muteIconClassName))):(e=(t=this.interpreter.getVolume())<.5?i.lowClassName:i.highClassName,t=t<.5?i.lowIconClassName:i.highIconClassName,this.interpreter.unmute(!1,!1),i.elm.classList.remove(i.muteClassName),i.elm.classList.add(e),i.elm.innerHTML="",i.elm.appendChild(document.createTextNode(t)))}},{key:"onFullscreen",value:function(e){var t=this,i=d.getElement("expandIcon",this.elements);i.elm.innerHTML="";var s=this.elements.header,n=this.elements.footer;"enterfullscreen"===e?(i.elm.appendChild(document.createTextNode(i.collapseIconClassName)),i.elm.classList.remove(i.collapseClassName),i.elm.classList.add(i.expandClassName),this.parent.mobile&&(s.elm.classList.remove(this.elements.style.active),n.elm.classList.remove(this.elements.style.active))):(i.elm.appendChild(document.createTextNode(i.expandIconClassName)),i.elm.classList.add(i.collapseClassName),i.elm.classList.remove(i.expandClassName),this.parent.mobile&&(s.elm.classList.add(this.elements.style.active),n.elm.classList.add(this.elements.style.active))),setTimeout(function(){t.parent.resize()},100)}},{key:"onFullscreenError",value:function(e){console.error(e)}},{key:"onError",value:function(e){e&&this.parent.onError(e)}},{key:"isChild",value:function(e,t){for(var i=t.parentNode;null!=i;){if(i==e)return!0;i=i.parentNode}return!1}},{key:"calculateBitRate",value:function(){var t,i,s,n=this,a=this.elements.videoContainer.video.elm;a&&void 0!==a.webkitVideoDecodedByteCount&&(s=i=t=0,this.bitrateInterval=setInterval(function(){var e;n.interpreter.playing&&(e=Math.round(a.webkitVideoDecodedByteCount/1e6/(a.currentTime/60*.0075)),a.webkitVideoDecodedByteCount,0<t&&(i=(s+=e)/t,n.interpreter.media.bitrate=i),10===++t&&clearInterval(n.bitrateInterval))},1e3))}},{key:"play",value:function(){this.interpreter.started||(this.parent.options.twoStepsLoad&&"VPAID"!==this.framework.toUpperCase()&&!this.ctwAdDataAutoPlayEnabled?(this.showLoader(),this.interpreter.init().then(this.hideLoader.bind(this)).then(this.parent.resize.bind(this.parent)).then(this.interpreterPlay()).catch(this.onError.bind(this))):this.interpreterPlay()),this.calculateBitRate()}},{key:"interpreterPlay",value:function(){var e=this;this.interpreter&&(this.hideLoader(),this.interpreter.play(),setTimeout(function(){e.parent.resize()},300))}},{key:"pause",value:function(){this.interpreter&&this.interpreter.pause()}},{key:"resume",value:function(){this.interpreter&&this.interpreter.resume()}},{key:"stop",value:function(){this.interpreter&&this.interpreter.stop()}},{key:"isMuted",value:function(){return this.interpreter?this.interpreter.isMuted():null}},{key:"getVolume",value:function(){return this.interpreter?this.interpreter.getVolume():null}},{key:"resize",value:function(e,t){this.interpreter&&this.interpreter.resize(e,t),this.setUIFonts(e)}},{key:"setMute",value:function(e){this.interpreter&&(e?this.interpreter.mute():this.interpreter.unmute())}},{key:"setVideoMute",value:function(e){this.interpreter&&(e?this.interpreter.mute(!1):this.interpreter.unmute(!1))}},{key:"setControls",value:function(e){var t=this,i=this.elements.header,s=this.elements.footer;this.uiTimeout&&clearTimeout(this.uiTimeout),e?(i.elm.classList.add(this.elements.style.active),s.elm.classList.add(this.elements.style.active),this.uiTimeout=setTimeout(function(){t.parent.mobile||(i.elm.classList.remove(t.elements.style.active),s.elm.classList.remove(t.elements.style.active))},this.parent.options.controlsDelay)):(i.elm.classList.remove(this.elements.style.active),s.elm.classList.remove(this.elements.style.active))}},{key:"destroy",value:function(){var e;this.stop(),this.interpreter&&this.interpreter.videoStartedPlaying&&(e=this.interpreter.media.viewableImpressions,!1===this.videoWasViewed&&e&&e.notViewable?this.interpreter.trackingEvents(e.notViewable):void 0===this.videoWasViewed&&e&&e.viewUndetermined&&this.interpreter.trackingEvents(e.viewUndetermined),this.interpreter.destroy()),this.progressInterval&&clearInterval(this.progressInterval),this.bitrateInterval&&clearInterval(this.bitrateInterval),window.removeEventListener("keypress",this.onPress),window.removeEventListener("keydown",this.onPress),this.parent.elements.container.elm.innerHTML=""}},{key:"getAdPaused",value:function(){return this.interpreter?this.interpreter.getAdPaused():null}},{key:"getAdErrorCode",value:function(){return this.interpreter?this.interpreter.getAdErrorCode():null}},{key:"getAdErrorMessage",value:function(){return this.interpreter?this.interpreter.getAdErrorMessage():null}},{key:"getAdSystem",value:function(){return this.interpreter?this.interpreter.getAdSystem():null}},{key:"getVideoBitrate",value:function(){return this.interpreter?this.interpreter.getVideoBitrate():null}},{key:"getAdMediaBitrateArray",value:function(){return this.interpreter?this.interpreter.getAdMediaBitrateArray():null}},{key:"getHeavyAdStatus",value:function(){return this.interpreter?this.interpreter.getHeavyAdStatus():null}},{key:"getAdMediaHeight",value:function(){return this.interpreter?this.interpreter.getAdMediaHeight():null}},{key:"getAdMediaWidth",value:function(){return this.interpreter?this.interpreter.getAdMediaWidth():null}},{key:"getAdMediaUrl",value:function(){return this.interpreter?this.interpreter.getAdMediaUrl():null}},{key:"getAdTagUrl",value:function(){return this.interpreter?this.interpreter.getAdTagUrl():null}},{key:"getAdDuration",value:function(){return this.interpreter?this.interpreter.getAdDuration():null}},{key:"getAdCurrentTime",value:function(){return this.interpreter?this.interpreter.getAdCurrentTime():null}},{key:"getAdDeliveryType",value:function(){return this.interpreter?this.interpreter.getAdDeliveryType():null}},{key:"getVastWidth",value:function(){return this.interpreter?this.interpreter.getVastWidth():null}},{key:"getVastHeight",value:function(){return this.interpreter?this.interpreter.getVastHeight():null}},{key:"getVideoClickThroughURL",value:function(){return this.interpreter?this.interpreter.getVideoClickThroughURL():null}},{key:"getVideoClickTrackingURL",value:function(){return this.interpreter?this.interpreter.getVideoClickTrackingURL():null}},{key:"getCompanionAds",value:function(){return this.interpreter?this.interpreter.getCompanionAds():null}},{key:"seek",value:function(e){0<=e&&e<=this.interpreter.getAdDuration()&&this.interpreter.seek(e)}},{key:"getVolumeState",value:function(){return this.volumeState}}]),le);function le(e){_classCallCheck(this,le),this.parent=e,this.framework=null,this.parser=null,this.interpreter=null,this.uiTimeout=0,this.timeInfoTimeout=0,this.volumeState=this.parent.options.muted?0:1,this.lastPlayedVolume=this.volumeState,this.volumeTimer=0,this.duration=0,this.progressInterval=0,this.interpreterReady=!1,this.viewabiltyEventInterval={},this.totalContinuosViewTime=0,this.viewabiltyEventTime=2e3,this.viewabiltyIntervalTime=100,this.viewabilityPercentageThreshold=50,this.videoWasViewed=!1,this.bitrateInterval=null,this.ctwAdData=this.parent.options&&this.parent.options.adData&&this.parent.options.adData.adExtraData&&this.parent.options.adData.adExtraData[this.parent.options.adData.adId]?this.parent.options.adData.adExtraData[this.parent.options.adData.adId]:void 0,this.ctwAdDataAutoPlayEnabled=!(!this.ctwAdData||"true"!==this.ctwAdData.autoPlayEnabled),this.onPress=this.onKeyPress.bind(this),this.customControls={data:null,adIcon:{src:null,width:0,height:0}},this.elements={header:{elm:null,id:"omp-header",settings:{elm:null,className:"omp-settings",settingsIcon:{elm:null,className:"omp-settings-btn",iconClassName:"settings"}},close:{elm:null,className:"omp-close",closeIcon:{elm:null,className:"omp-close-btn",closeIconClassName:"clear"}},dummy:{elm:null,className:"omp-dummy"}},footer:{elm:null,id:"omp-footer",play:{elm:null,className:"omp-play-pause",playIcon:{elm:null,className:"omp-play-pause-btn",playIconClassName:"play_arrow",pauseIconClassName:"pause"}},seek:{elm:null,className:"omp-seek-bar-wrapper",bar:{elm:null,className:"omp-seek-bar",loadBar:{elm:null,className:"omp-load-bar"},progressBar:{elm:null,className:"omp-progress-bar"},handler:{elm:null,className:"omp-progress-handler",iconClassName:"fiber_manual_record"},time:{elm:null,className:"omp-time-info"}}},timeBox:{elm:null,className:"omp-time-box-wrapper",timeBoxDisplay:{elm:null,className:"omp-time-box"}},volume:{elm:null,className:"omp-volume",volumeIcon:{elm:null,className:"omp-volume-btn",highClassName:"high",lowClassName:"low",muteClassName:"mute",highIconClassName:"volume_up",lowIconClassName:"volume_down",muteIconClassName:"volume_off"},volumeWrapper:{elm:null,className:"omp-volume-wrapper",volumeBar:{elm:null,className:"omp-volume-bar"},volumeSeekBar:{elm:null,className:"omp-volume-seek-bar"},volumeHandler:{elm:null,className:"omp-volume-handler"}}},expand:{elm:null,className:"omp-fullscreen",expandIcon:{className:"omp-expand-btn",expandClassName:"fullscreen",collapseClassName:"collapse",expandIconClassName:"fullscreen",collapseIconClassName:"fullscreen_exit"}}},loader:{elm:null,className:"omp-loader"},videoContainer:{elm:null,content:{elm:null,className:"obp-vpaid"},video:{elm:null}},style:{icons:"material-icons",active:"active",hidden:"omp-hidden",invisible:"omp-invisible",commonIconClassName:"omp-ui-btn",smallIconClassName:"omp-small-ui",mediumIconClassName:"omp-medium-ui",smallSeekClassName:"omp-small-seek",mediumSeekClassName:"omp-medium-seek"},adIcon:{elm:null,className:"omp-ad-icon"}},this.init()}_createClass(de,[{key:"init",value:function(t){var i=this;return console.log("OMP init: "+Date.now()),new Promise(function(e){d.waterfall([i.setPlayerContainer],i).catch(i.onError.bind(i)).then(function(){if(!t.hasOwnProperty("vastXML"))throw new Error("Invalid vast xml source");i.mobile=t.hasOwnProperty("mobile")?t.mobile:i.isMobile(),i.container.classList.add(i.mobile?"omp-mobile":"omp-desktop"),i.vastXML=t.vastXML,i.seek=t.seek||!1,i.pixels=t.pixels||[],i.jsTrackers=t.jsTrackers||[],i.shouldTrackMoat=t.trackMoat||!1,i.options=t,i.setDefaultOpts(),i.setCustomOpts(),i.options.hasOwnProperty("promisedInit")&&i.options.promisedInit&&i.elements.container.elm.addEventListener("ready",function(){e("ready-promise")}),document.getElementById(i.elements.parser.id)?i.video=new oe(i):d.waterfall([i.insertWasm,i.detectAdBlocker,i.insertVideoTag],i).catch(i.onError.bind(i)),window.addEventListener("resize",i.events.resize),i.options.promisedInit||e(!0)})})}},{key:"updateMacros",value:function(e){try{this.video.interpreter.updateMacros(e)}catch(e){}}},{key:"setPlayerContainer",value:function(){var e,t;this.container=document.getElementById(this.id),this.elements.container.elm=this.container,this.container?(e=document.getElementsByTagName("head")[0],document.getElementById("omp-style")||((t=document.createElement("link")).href=i,t.id="omp-style",t.rel="stylesheet",t.type="text/css",e.appendChild(t)),this.container.classList.add("omp")):this.onError(new Error("Cannot retrieve DOM element with ID "+this.id))}},{key:"isMobile",value:function(){return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))}},{key:"setDefaultOpts",value:function(){this.options.hasOwnProperty("controlsDelay")||(this.options.controlsDelay=3e3),this.options.hasOwnProperty("twoStepsLoad")||(this.options.twoStepsLoad=!1),this.options.autoplay&&(this.options.twoStepsLoad=!1)}},{key:"setCustomOpts",value:function(){this.options.relativeSize&&this.container.classList.add(this.elements.container.className)}},{key:"insertWasm",value:function(){var i=this;return new Promise(function(e,t){i.wasm.active?(document.getElementsByTagName("head")[0],document.createElement("script").src=i.wasm.url):e(!0)})}},{key:"detectAdBlocker",value:function(){var n=this;return new Promise(function(t){var e,i,s;n.options.adBlockerDetection&&!document.getElementById("obad")?(e=document.getElementsByTagName("body")[0],(i=document.createElement("script")).id="obad",i.src=a,s=setTimeout(function(){var e=document.getElementById("iSsVFRmjlhBx");e?e.parentNode.removeChild(e):(n.adBlocker=!0,console.log("Adblocker detected")),t(!0)},6e3),i.onload=function(){clearTimeout(s),n.adBlocker=!1;var e=document.getElementById("iSsVFRmjlhBx");e&&e.parentNode.removeChild(e),t(!0)},e.appendChild(i)):t(!0)})}},{key:"insertVideoTag",value:function(){this.adBlocker||(this.video=new oe(this))}},{key:"onResize",value:function(e){var t=this;this.resizeId&&clearTimeout(this.resizeId),this.resizeId=setTimeout(function(){t.resize()},200)}},{key:"play",value:function(){this.video.play()}},{key:"pause",value:function(){this.video.pause()}},{key:"resume",value:function(){this.video.resume()}},{key:"stop",value:function(){this.video.stop()}},{key:"stopAds",value:function(){this.video.stop()}},{key:"resize",value:function(){this.video.resize(this.container.offsetWidth,this.container.offsetHeight)}},{key:"setMute",value:function(e){this.video.setMute(e)}},{key:"setVideoMute",value:function(e){this.video.setVideoMute(e)}},{key:"setControls",value:function(e){this.video.setControls(e)}},{key:"destroy",value:function(){this.video.destroy()}},{key:"isMuted",value:function(){return this.video.isMuted()}},{key:"getVolume",value:function(){return this.video.getVolume()}},{key:"getAdPaused",value:function(){return this.video.getAdPaused()}},{key:"getAdErrorCode",value:function(){return this.video.getAdErrorCode()}},{key:"getAdErrorMessage",value:function(){return this.video.getAdErrorMessage()}},{key:"getAdSystem",value:function(){return this.video.getAdSystem()}},{key:"getVideoBitrate",value:function(){return this.video.getVideoBitrate()}},{key:"getAdMediaBitrateArray",value:function(){return this.video.getAdMediaBitrateArray()}},{key:"getHeavyAdStatus",value:function(){return this.video.getHeavyAdStatus()}},{key:"getAdMediaHeight",value:function(){return this.video.getAdMediaHeight()}},{key:"getAdMediaWidth",value:function(){return this.video.getAdMediaWidth()}},{key:"getAdMediaUrl",value:function(){return this.video.getAdMediaUrl()}},{key:"getAdTagUrl",value:function(){return this.video.getAdTagUrl()}},{key:"getAdDuration",value:function(){return 1e3*this.video.getAdDuration()}},{key:"getAdCurrentTime",value:function(){return 1e3*this.video.getAdCurrentTime()}},{key:"getDuration",value:function(){return 1e3*this.video.duration}},{key:"getAdUnit",value:function(){return this.video.interpreter.adUnit}},{key:"getAdMedias",value:function(){return this.video.parser.medias}},{key:"getAdDeliveryType",value:function(){return this.video.getAdDeliveryType()}},{key:"getVastWidth",value:function(){return this.video.getVastWidth()}},{key:"getVastHeight",value:function(){return this.video.getVastHeight()}},{key:"getVideoClickThroughURL",value:function(){return this.video.getVideoClickThroughURL()}},{key:"getVideoClickTrackingURL",value:function(){return this.video.getVideoClickTrackingURL()}},{key:"getCompanionAds",value:function(){return this.video.getCompanionAds()}},{key:"onSeek",value:function(e){this.video.seek(e)}},{key:"updateSeek",value:function(){this.video.updateSeek()}},{key:"getVolumeState",value:function(){return this.video.getVolumeState()}},{key:"onError",value:function(e){e=new CustomEvent("playererror",{detail:e,bubbles:!1,cancelable:!0});this.container.dispatchEvent(e)}}]),L=de;function de(e){if(_classCallCheck(this,de),this.id=e,this.mobile=!1,this.vastXML=null,this.pixels=null,this.jsTrackers=null,this.container=null,this.video=null,this.seek=!1,this.shouldTrackMoat=!1,this.options=null,this.adBlocker=!1,this.resizeId=0,this.wasm={active:!1,url:"https://localhost:8084/outbrain-media-player/wasm/vast.js"},this.elements={container:{elm:null,className:"omp-full"},parser:{id:"omp-parser"},interpreter:{id:"omp-vast"}},this.events={resize:this.onResize.bind(this)},!this.id)return this.onError(new Error("Invalid ID attribute provided"))}"function"!=typeof window.CustomEvent&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}),window.OutbrainMP=L}();